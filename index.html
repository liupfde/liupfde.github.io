<!DOCTYPE html>



  


<html class="theme-next mist use-motion" lang="zh-Hans">
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT">










<meta property="og:type" content="website">
<meta property="og:title" content="liupf&#39;s blog">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="liupf&#39;s blog">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="liupf&#39;s blog">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: 'åšä¸»'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/">





  <title>liupf's blog</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">liupf's blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            é¦–é¡µ
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br>
            
            æ ‡ç­¾
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br>
            
            åˆ†ç±»
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            å½’æ¡£
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/07/10/Spring-Securityç®€è¿°/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="liupf">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="liupf's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/07/10/Spring-Securityç®€è¿°/" itemprop="url">Spring Securityç®€è¿°</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2019-07-10T14:45:33+08:00">
                2019-07-10
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h3><hr>
<p><strong>Spring Security</strong>æ˜¯Springæä¾›çš„æƒé™ç®¡ç†æ¡†æ¶ã€‚<u>ä¸€èˆ¬ï¼Œèµ„æºçš„åˆ†é…æ˜¯åŸºäºè§’è‰²(èµ„æºè®¿é—®æƒé™èµ‹ç»™è§’è‰²ï¼Œç”¨æˆ·é€šè¿‡è§’è‰²è¿›è€Œæ‹¥æœ‰æƒé™);è€Œè®¿é—®èµ„æºçš„æ—¶å€™æ˜¯åŸºäºèµ„æºæƒé™å»è¿›è¡Œæˆæƒåˆ¤æ–­ã€‚</u></p>
<p>åŒ…æ‹¬Securityåœ¨å†…ï¼Œå¤§éƒ¨åˆ†å®‰å…¨æ¡†æ¶éƒ½å¯ä»¥ç®€å•ç†è§£ä¸ºä¸¤ä¸ªæ ¸å¿ƒ: ä¸€ä¸ª<strong>è®¤è¯</strong>ï¼Œå³åˆ¤æ–­è¯¥ç”¨æˆ·æ˜¯å¦å­˜åœ¨ï¼Œå¯†ç æ˜¯å¦æ­£ç¡®ï¼›å¦ä¸€ä¸ªå°±æ˜¯<strong>é‰´æƒ</strong>ï¼Œå³çœ‹çœ‹å½“å‰è®¿é—®çš„èµ„æºæœ‰æ²¡æœ‰æƒé™ï¼Œè¿™ä¸ªç”¨æˆ·èƒ½åšä»€ä¹ˆã€ä¸èƒ½åšä»€ä¹ˆã€‚</p>
<h3 id="è®¤è¯"><a href="#è®¤è¯" class="headerlink" title="è®¤è¯"></a>è®¤è¯</h3><hr>
<p>Securityçš„è®¤è¯ä¸»è¦æ˜¯é€šè¿‡ä»¥ä¸‹æ¥å£å®ç°çš„: <strong>UserDetailsã€UserDetailsServiceã€AuthenticationProviderã€‚</strong><u><em>UserDetailsæ˜¯ç”¨æ¥å°è£…ç”¨æˆ·çš„è´¦å·ä¿¡æ¯ã€æƒé™ç­‰ä¿¡æ¯ï¼Œä»æ•°æ®åº“ä¸­å–å‡ºçš„ä¿¡æ¯é¦–å…ˆè¦å°è£…æˆUserDetailsæ‰èƒ½åœ¨Spring Securityæ¡†æ¶ä¸­ä½¿ç”¨</em></u>ï¼›UserDetailsçš„ä½œç”¨å°±æ˜¯å¤„ç†UserDetailsï¼Œä»–æä¾›æŸ¥è¯¢è´¦å·ä¿¡æ¯å¹¶å°è£…æˆUserDetailsçš„æœåŠ¡ï¼›AuthenticationProviderçš„ä¸»è¦å·¥ä½œå°±æ˜¯è´Ÿè´£è®¤è¯ï¼Œä»ç™»é™†è¯·æ±‚é‚£é‡Œæ‹¿åˆ°è´¦å·å¯†ç ç­‰ï¼Œç„¶åå†è·Ÿä»æ•°æ®åº“é‚£é‡Œå¾—åˆ°çš„UserDetailsè¿›è¡Œæ¯”å¯¹ï¼Œè‹¥ä¸æ­£ç¡®åˆ™è¿”å›ä¿¡æ¯ï¼Œè‹¥æ­£ç¡®åˆ™æŠŠè¿™äº›ä¿¡æ¯æ•´åˆäº¤ç»™Securityæ¡†æ¶ï¼Œä¾›ä»¥åä½¿ç”¨ã€‚</p>
<h3 id="é‰´æƒ"><a href="#é‰´æƒ" class="headerlink" title="é‰´æƒ"></a>é‰´æƒ</h3><hr>
<p>Securityçš„é‰´æƒæ–¹å¼æœ‰å¤šç§ï¼Œè¿™é‡Œè®°å½•é€šè¿‡è‡ªå®šä¹‰è¿‡æ»¤å™¨çš„é‰´æƒæ–¹å¼ã€‚ä¸»è¦ä¸ä»¥ä¸‹æ¥å£ç›¸å…³:<strong>AbstractSecurityInterceptor(Filter)ã€FilterInvocationSecurityMetadataSourceã€AccessDecisionManager</strong>ã€‚FilterInvocationSecurityMetadataSourceæ˜¯æƒé™èµ„æºç®¡ç†å™¨ï¼Œä»–çš„ä¸»è¦å·¥ä½œå°±æ˜¯æ ¹æ®è¯·æ±‚çš„èµ„æºè·¯å¾„ä»æ•°æ®åº“ä¸­å–å‡ºç›¸åº”çš„æƒé™ä¿¡æ¯ï¼›AccessDecisionManagerç±»ä¼¼äºæƒé™èµ„æºç®¡ç†åˆ¤æ–­å™¨ï¼Œè´Ÿè´£è®¤è¯å½“å‰ç”¨æˆ·çš„æƒé™æ˜¯å¦å¯ä»¥è®¿é—®ï¼›AbstractSecurityInterceptorå°±æ˜¯å‰è¾¹ä¸¤ä¸ªç±»æ¯”è¾ƒçš„åœ°æ–¹ã€‚</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/06/12/å­˜å‚¨ç®¡ç†/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="liupf">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="liupf's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/06/12/å­˜å‚¨ç®¡ç†/" itemprop="url">å­˜å‚¨ç®¡ç†</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2019-06-12T16:27:49+08:00">
                2019-06-12
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="å†…å­˜ç®¡ç†åŠŸèƒ½"><a href="#å†…å­˜ç®¡ç†åŠŸèƒ½" class="headerlink" title="å†…å­˜ç®¡ç†åŠŸèƒ½"></a>å†…å­˜ç®¡ç†åŠŸèƒ½</h3><h4 id="å­˜å‚¨ç®¡ç†çš„åŠŸèƒ½"><a href="#å­˜å‚¨ç®¡ç†çš„åŠŸèƒ½" class="headerlink" title="å­˜å‚¨ç®¡ç†çš„åŠŸèƒ½"></a>å­˜å‚¨ç®¡ç†çš„åŠŸèƒ½</h4><ul>
<li><p><strong>1)ã€åœ°å€æ˜ å°„</strong></p>
<ul>
<li><p>å°†ç¨‹åºä¸­çš„åœ°å€(<strong>è™šæ‹Ÿåœ°å€ã€è™šåœ°å€ã€é€»è¾‘åœ°å€</strong>)å˜åŒ–æˆå†…å­˜ä¸­çš„çœŸå®åœ°å€(<strong>CPUèƒ½å¤Ÿç›´æ¥è®¿é—®çš„å®åœ°å€ã€ç‰©ç†åœ°å€</strong>)çš„è¿‡ç¨‹ã€‚</p>
</li>
<li><p>æ–¹å¼:</p>
<ol>
<li><p><strong>å›ºå®šåœ°å€æ˜ å°„</strong></p>
<p>åœ¨ç¼–ç¨‹æˆ–è€…ç¼–è¯‘æ—¶ç¡®å®šé€»è¾‘åœ°å€å’Œç‰©ç†åœ°å€æ˜ å°„å…³ç³»ã€‚ä¹Ÿå°±æ˜¯åœ¨ç¨‹åºçš„<strong>æºä»£ç é‡Œé¢ç›´æ¥æŒ‡æ˜ç‰©ç†åœ°å€</strong>æˆ–è€…åœ¨ç¼–è¯‘çš„æ—¶å€™<strong>ç”±ç¼–è¯‘å™¨å¸®æˆ‘ä»¬è½¬åŒ–æˆç‰©ç†åœ°å€</strong></p>
<ul>
<li><p>ç‰¹ç‚¹</p>
<ul>
<li><p><strong>ç¨‹åºåŠ è½½æ—¶å¿…é¡»æ”¾åœ¨æŒ‡å®šçš„å†…å­˜åŒºåŸŸ</strong></p>
<p>å› ä¸ºç‰©ç†åœ°å€æ˜¯æŒ‡å®šçš„ï¼Œæ‰€ä»¥ç¨‹åºå¿…é¡»æ”¾åœ¨æŒ‡å®šçš„å†…å­˜åŒºåŸŸ</p>
</li>
<li><p><strong>å®¹æ˜“äº§ç”Ÿåœ°å€å†²çª,è¿è¡Œå¤±è´¥</strong></p>
<p>å¦‚æœå¤šä¸ªç¨‹åºçš„ç¨‹åºåœ°å€æ˜¯åŒä¸€ä¸ªï¼Œé‚£ä¹ˆåœ¨è½¬æ¢æˆç‰©ç†åœ°å€æ—¶å°±ä¼šäº§ç”Ÿå†²çª</p>
</li>
</ul>
</li>
</ul>
</li>
<li><p><strong>é™æ€åœ°å€æ˜ å°„</strong></p>
<p>ç¨‹åº<strong>è£…å…¥(ä¾‹å¦‚åŒå‡»ç¨‹åºå›¾æ ‡)</strong>æ—¶ç”±<strong>æ“ä½œç³»ç»Ÿ</strong>å®Œæˆé€»è¾‘åœ°å€åˆ°ç‰©ç†åœ°å€çš„æ˜ å°„ã€‚</p>
<p>åŒ…å«ä»¥ä¸‹æ¦‚å¿µ:</p>
<ul>
<li><p><strong>é€»è¾‘åœ°å€: VA(Virtual Addr.)</strong></p>
</li>
<li><p><strong>è£…å…¥åŸºå€: BA(Base Addr.)</strong></p>
<p>æŒ‡çš„æ˜¯ç¨‹åºè£…åœ¨å†…å­˜é‡Œé¢çš„èµ·å§‹åœ°å€</p>
</li>
<li><p><strong>ç‰©ç†åœ°å€: MA(Memory Addr.)</strong></p>
<p>MA = BA  + VA</p>
</li>
</ul>
<p><img src="https://blog-1257300108.cos.ap-beijing.myqcloud.com/OS/os3.png" alt></p>
<p>å¦‚ä¸Šå›¾æœ‰ä¸€ä¸ªç¨‹åº, è¿™ä¸ªç¨‹åºæœ‰ä¸€ä¸ªè™šæ‹Ÿåœ°å€x, xå­˜å‚¨çš„å†…å®¹æ˜¯1234, (x)å»è·å–è¿™ä¸ªåœ°å€ã€‚<strong>è™šæ‹Ÿåœ°å€ä»0å¼€å§‹å¾€ä¸Šå¢åŠ ï¼Œè¿™ä¸ªåœ°å€å±äºçº¿å½¢åœ°å€ç©ºé—´ã€‚</strong></p>
<p><img src="https://blog-1257300108.cos.ap-beijing.myqcloud.com/OS/os4.png" alt></p>
<p><strong>ç¨‹åºè¢«è£…å…¥å†…å­˜åï¼Œå¦‚ä¸Šå›¾æ‰€ç¤º: æœ‰ä¸€ä¸ªçœŸå®çš„xå·åœ°å€å•å…ƒï¼Œè¿™æ˜¯æœªçŸ¥çš„å¹¶ä¸æ˜¯æˆ‘ä»¬æƒ³æ‰¾çš„,æœ‰ä¸€ä¸ªåŸºå€ï¼ŒåŸºå€å¾€ä¸Šæ‰æ˜¯çœŸå®çš„è¦æ‰¾çš„xå·å•å…ƒMAå†…å®¹(1234)</strong></p>
<ul>
<li><strong>ç‰¹ç‚¹</strong><ul>
<li>ç¨‹åºè¿è¡Œä¹‹å‰ç¡®å®šæ˜ å°„å…³ç³»</li>
<li>ç¨‹åºè£…å…¥åä¸èƒ½ç§»åŠ¨ï¼Œå¦‚æœç§»åŠ¨å¿…é¡»æ”¾å›åŸæ¥çš„ä½ç½®</li>
<li><strong>ç¨‹åºå ç”¨è¿ç»­çš„å†…å­˜ç©ºé—´</strong></li>
</ul>
</li>
</ul>
</li>
<li><p><strong>åŠ¨æ€åœ°å€æ˜ å°„</strong></p>
<p>åœ¨ç¨‹åºçš„è¿è¡Œè¿‡ç¨‹ä¸­æŠŠé€»è¾‘åœ°å€è½¬æ¢ä¸ºç‰©ç†åœ°å€ã€‚ä¾‹å¦‚:</p>
<p>MOV AX, [500] ; åœ¨ç¨‹åºè®¿é—®åˆ°500å·åœ°å€æ—¶æ‰è®²é€»è¾‘åœ°å€æ˜ å°„åˆ°ç‰©ç†åœ°å€ã€‚</p>
<p>æ˜ å°„è¿‡ç¨‹å’Œé™æ€åœ°å€æ˜ å°„çš„è¿‡ç¨‹ç›¸åŒã€‚éƒ½æ˜¯<strong>MA = BA + VA</strong>ï¼Œå¦‚æœç¨‹åºæœ‰ç§»åŠ¨ï¼Œé‚£ä¹ˆ<strong>BAå¯èƒ½ä¼šæ”¹å˜</strong>ï¼Œæ“ä½œç³»ç»Ÿå°†<strong>è‡ªåŠ¨è®¡ç®—æ–°çš„MAã€‚</strong></p>
<ul>
<li><p><strong>ç‰¹ç‚¹</strong></p>
<ul>
<li>ç¨‹åºå ç”¨çš„å†…å­˜ç©ºé—´å¯ä»¥åŠ¨æ€å˜åŒ–ï¼Œ<strong>è¦æ±‚åŠæ—¶æ›´æ–°æ–°çš„BA</strong></li>
<li>ç¨‹åºä¸å ç”¨è¿ç»­çš„å†…å­˜åœ°å€ç©ºé—´ï¼Œå¯ä»¥åˆ†æˆå‡ æ®µï¼Œä½†æ˜¯<strong>æ¯æ®µçš„åŸºå€BAç³»ç»Ÿåº”è¯¥çŸ¥é“ã€‚</strong></li>
<li>ä¾¿äºå¤šä¸ªè¿›ç¨‹å…±äº«ä»£ç ï¼Œå…±äº«çš„ä»£ç ä½œä¸ºç‹¬ç«‹çš„ä¸€æ®µå­˜æ”¾</li>
<li><strong>æ®µå¼ç³»ç»Ÿã€é¡µå¼ç³»ç»ŸåŸºæœ¬éƒ½æ˜¯é‡‡ç”¨çš„åŠ¨æ€åœ°å€æ˜ å°„æ–¹å¼</strong></li>
</ul>
</li>
</ul>
</li>
</ol>
</li>
</ul>
</li>
</ul>
<ul>
<li><p><strong>2)ã€è™šæ‹Ÿå­˜å‚¨</strong></p>
<ul>
<li><p><strong>è§£å†³çš„é—®é¢˜:</strong></p>
<ul>
<li>ç¨‹åºè¿‡å¤§æˆ–è€…è¿‡å¤šæ—¶å†…å­˜ä¸å¤Ÿï¼Œç¨‹åºä¸èƒ½è¿è¡Œ</li>
<li>å¤šä¸ªç¨‹åºå¹¶å‘è¿è¡Œæ—¶å®¹æ˜“äº§ç”Ÿåœ°å€å†²çªï¼Œä¸èƒ½è¿è¡Œ</li>
</ul>
</li>
<li><p><strong>æ¦‚å¿µ</strong></p>
<p><img src="https://blog-1257300108.cos.ap-beijing.myqcloud.com/OS/os5.png" alt></p>
<ul>
<li>ä»–æ˜¯<strong>çº¿æ€§</strong>çš„åœ°å€ç©ºé—´ï¼Œä»0å¼€å§‹å¢åŠ åˆ°æœ€å¤§</li>
<li>åœ¨32ä½çš„é‡Œå®ƒçš„å®¹é‡æ˜¯<strong>$2^{32}$Byte = 4GB</strong></li>
<li><strong>æ¯ä¸€ä¸ªè¿›ç¨‹éƒ½æ˜¯ä¸€ä¸ªå°é—­çš„ç©ºé—´ï¼Œéƒ½æœ‰ä¸€å¥—è‡ªå·±çš„åœ°å€ï¼Œäº’ä¸å†²çªï¼Œå¹¶ä¸”å’Œç‰©ç†åœ°å€åˆ†ç¦»</strong></li>
<li><strong>ç¨‹åºå‘˜åœ¨ç¼–ç¨‹æ—¶å°±æ˜¯ä½¿ç”¨è¿™ç§çº¿æ€§çš„è™šæ‹Ÿåœ°å€</strong>    </li>
</ul>
</li>
</ul>
</li>
<li><p><strong>3)ã€å†…å­˜ä¿æŠ¤</strong></p>
</li>
<li><p><strong>4)ã€å­˜å‚¨ä¿æŠ¤</strong></p>
</li>
</ul>
<h4 id="ç‰©ç†å†…å­˜ç®¡ç†"><a href="#ç‰©ç†å†…å­˜ç®¡ç†" class="headerlink" title="ç‰©ç†å†…å­˜ç®¡ç†"></a>ç‰©ç†å†…å­˜ç®¡ç†</h4><h5 id="ä¸€ã€åˆ†åŒºå†…å­˜ç®¡ç†"><a href="#ä¸€ã€åˆ†åŒºå†…å­˜ç®¡ç†" class="headerlink" title="ä¸€ã€åˆ†åŒºå†…å­˜ç®¡ç†"></a>ä¸€ã€åˆ†åŒºå†…å­˜ç®¡ç†</h5><p>æŠŠç‰©ç†å†…å­˜åˆ†æˆè‹¥å¹²ä¸ªåŒºåŸŸæ¥åˆ†é…ç»™ç”¨æˆ·ä½¿ç”¨ã€‚æ ¹æ®åˆ†åŒºçš„å½¢å¼å’Œåˆ†åŒºçš„æ—¶æœºå¯ä»¥åˆ†æˆä»¥ä¸‹åˆ†åŒºæ–¹å¼:</p>
<ul>
<li><p><strong>å•ä¸€åŒºå­˜å‚¨ç®¡ç†(ä¸åˆ†åŒº)</strong></p>
<p>ç”¨æˆ·åŒºä¸åˆ†åŒºï¼Œå®Œå…¨è¢«ä¸€ä¸ªç¨‹åºä½¿ç”¨ã€‚ä¾‹å¦‚DOS</p>
</li>
<li><p><strong>åˆ†åŒºå­˜å‚¨ç®¡ç†</strong></p>
<p>æŠŠç”¨æˆ·å†…å­˜åˆ’åˆ†æˆè‹¥å¹²ä¸ªå¤§å°ä¸ç­‰çš„åˆ†åŒºå…±ä¸åŒçš„ç¨‹åºä½¿ç”¨</p>
<ul>
<li><p><strong>å›ºæ€åˆ†åŒº</strong></p>
<p>æŠŠå†…å­˜<strong>å›ºå®šåœ°</strong>åˆ’åˆ†ä¸ºè‹¥å¹²ä¸ªå¤§å°ä¸ç­‰çš„åˆ†åŒºä¾›å„ä¸ªç¨‹åºä½¿ç”¨ã€‚æ¯ä¸ªåˆ†åŒºçš„å¤§å°å’Œä½ç½®éƒ½å›ºå®šï¼Œç³»ç»Ÿè¿è¡ŒæœŸé—´ä¸å†é‡æ–°åˆ’åˆ†ã€‚</p>
<p><strong>æ“ä½œç³»ç»Ÿä¼šç”Ÿæˆä¸€ä¸ªåˆ†åŒºè¡¨ï¼Œç”¨æ¥è®°å½•åˆ†åŒºçš„å¤§å°ã€ä½ç½®å’Œä½¿ç”¨æ ‡å¿—ã€‚</strong></p>
<p>å›ºå®šåˆ†åŒºçš„ä¾‹å­:</p>
<p><img src="https://blog-1257300108.cos.ap-beijing.myqcloud.com/OS/os6.png" alt></p>
</li>
</ul>
</li>
</ul>
<ul>
<li><p><strong>åŠ¨æ€åˆ†åŒº</strong></p>
<p><strong>åœ¨ç¨‹åºè£…å…¥æ—¶åˆ›å»ºåˆ†åŒº</strong>ï¼Œä½¿åˆ†åŒºçš„å¤§å°åˆšå¥½ä¸ç¨‹åºçš„å¤§å°ç›¸åŒ¹é…</p>
<p><img src="https://blog-1257300108.cos.ap-beijing.myqcloud.com/OS/os7.png" alt></p>
<p><strong>ç¨‹åºåŠ¨æ€çš„åˆ†é…åˆ°å†…å­˜ä¸­ï¼Œå½“æ‰§è¡Œå®Œåï¼Œæ’¤å‡ºå†…å­˜ã€‚è¿™æ ·å¯¼è‡´äº†å†…å­˜ç¢ç‰‡åŒ–çš„é—®é¢˜ï¼Œåæ¥çš„ç¨‹åºä¸èƒ½å……åˆ†åˆ©ç”¨ç¢ç‰‡å†…å­˜ç©ºé—´ã€‚</strong></p>
<ul>
<li><strong>åŠ¨æ€åˆ†åŒºåœ¨å®é™…åº”ç”¨ä¸­è¦è§£å†³çš„é—®é¢˜</strong><ol>
<li>åˆ†åŒºçš„åˆ†é…</li>
<li>åˆ†åŒºçš„é€‰æ‹©</li>
<li>åˆ†åŒºçš„å›æ”¶</li>
<li><strong>è§£å†³å†…å­˜ç¢ç‰‡åŒ–é—®é¢˜</strong></li>
</ol>
</li>
</ul>
</li>
</ul>
<h5 id="äºŒã€åˆ†åŒºçš„æ”¾ç½®ç­–ç•¥"><a href="#äºŒã€åˆ†åŒºçš„æ”¾ç½®ç­–ç•¥" class="headerlink" title="äºŒã€åˆ†åŒºçš„æ”¾ç½®ç­–ç•¥"></a>äºŒã€åˆ†åŒºçš„æ”¾ç½®ç­–ç•¥</h5><ul>
<li><p><strong>ç©ºé—²åˆ†åŒºè¡¨</strong></p>
<p>åœ¨å†…å­˜åˆ†é…ä¹‹å‰ï¼Œéœ€è¦ä¸€ä¸ª<strong>ç©ºé—²åˆ†åŒºè¡¨</strong>æ¥è®°å½•å†…å­˜ç©ºé—²åŒºçš„ä½ç½®å¤§å°ã€‚</p>
<p><img src="https://blog-1257300108.cos.ap-beijing.myqcloud.com/OS/os8.png" alt></p>
</li>
<li><p><strong>åˆ†é…è¿‡ç¨‹(å‡å®šç”¨æˆ·è¦æ±‚çš„ç©ºé—²åŒºå¤§å°ä¸ºs)</strong></p>
<ul>
<li>1)ã€ä»ç©ºé—²åŒºè¡¨çš„ç¬¬ä¸€ä¸ªåˆ†åŒºå¼€å§‹éå†å¯»æ‰¾å¤§äºç­‰äºsçš„åˆ†åŒº</li>
<li>2)ã€æ‰¾åˆ°åˆ†åŒºåä»åˆ†åŒºä¸­åˆ†å‰²å‡ºå¤§å°ä¸ºsçš„éƒ¨åˆ†ç»™ç”¨æˆ·ä½¿ç”¨</li>
<li>3)ã€åˆ†å‰²åçš„å‰©ä½™éƒ¨åˆ†ä»ç„¶ç™»è®°åœ¨ç©ºé—²åŒºè¡¨ä¸­</li>
<li><strong>æ³¨æ„:</strong> ç©ºé—²åŒºçš„åˆ†å‰²ä¸€èˆ¬æ˜¯ä»åº•éƒ¨å¼€å§‹åˆ†å‰²ï¼Œè¿™æ ·åšçš„ç›®çš„æ˜¯ç©ºé—²åˆ†åŒºåœ¨åˆ†åŒºè¡¨ä¸­çš„ä½ç½®ä¸å˜èµ·å§‹åœ°å€ä¸å˜ã€‚åªæ”¹å˜å¤§å°ï¼Œæ–¹ä¾¿æ›´æ–°ç©ºé—²åŒºè¡¨ã€‚</li>
</ul>
</li>
<li><p><strong>ç©ºé—²åŒºè¡¨å¦‚ä½•æ’åº</strong></p>
<p>ç©ºé—²åŒºè¡¨çš„æ’åºä¸åŒç”¨æˆ·æœ€ç»ˆé€‰æ‹©åˆ°çš„ç©ºé—²åŒºå°±ä¸åŒï¼Œè¿™å°±æ˜¯åˆ†åŒºçš„<strong>æ”¾ç½®ç­–ç•¥</strong>ã€‚</p>
</li>
<li><p><strong>æ”¾ç½®ç­–ç•¥</strong></p>
<ul>
<li><strong>æŒ‰ç©ºé—²åŒºä½ç½®(é¦–åœ°å€)é€’å¢æ’åº (é¦–æ¬¡é€‚åº”æ³•)</strong></li>
<li><strong>æŒ‰ç©ºé—²åŒºä½ç½®(é¦–åœ°å€)é€’å‡æ’åº (å®é™…ä¸Šä¸ç”¨è¿™ç§æ–¹å¼)</strong></li>
<li><strong>æŒ‰ç©ºé—²åŒºå¤§å°é€’å¢æ’åº(æœ€ä½³é€‚åº”æ³•)</strong></li>
<li><strong>æŒ‰ç©ºé—²åŒºå¤§å°é€’å‡æ’åº(æœ€åé€‚åº”æ³•)</strong></li>
</ul>
</li>
</ul>
<h5 id="ä¸‰ã€å†…å­˜è¦†ç›–æŠ€æœ¯"><a href="#ä¸‰ã€å†…å­˜è¦†ç›–æŠ€æœ¯" class="headerlink" title="ä¸‰ã€å†…å­˜è¦†ç›–æŠ€æœ¯"></a>ä¸‰ã€å†…å­˜è¦†ç›–æŠ€æœ¯</h5><ul>
<li><p><strong>ç›®çš„</strong></p>
<p>åœ¨è¾ƒå°çš„å†…å­˜ç©ºé—´ä¸­ä½¿ç”¨è¾ƒå¤§çš„ç¨‹åº</p>
</li>
<li><p><strong>å†…å­˜åˆ†åŒº</strong></p>
<ul>
<li><p><strong>å¸¸é©»åŒº</strong></p>
<p>è¢«æŸæ®µç¨‹åºå•ç‹¬å›ºå®šçš„å ç”¨ï¼Œå¯ä»¥åˆ’åˆ†å¤šä¸ª</p>
</li>
<li><p><strong>è¦†ç›–åŒº</strong></p>
<p>èƒ½è¢«å¤šæ®µå…±ç”¨å¯ä»¥åˆ’åˆ†å¤šä¸ª</p>
</li>
</ul>
<p><img src="https://blog-1257300108.cos.ap-beijing.myqcloud.com/OS/os9.png" alt></p>
<p>å¦‚ä¸Šå›¾å†…å­˜110Kï¼Œç¨‹åº190Kï¼Œåº”ç”¨å±‚æ˜¯ç”¨æˆ·å¯ä»¥ç›´æ¥è°ƒç”¨çš„ï¼ŒDã€Eæ¨¡å—ä¼šè°ƒç”¨åˆ°Bæ¨¡å—ï¼ŒBæ¨¡å—ä¼šç”¨åˆ°Aæ¨¡å—</p>
<p>Aæ¨¡å—æ˜¯æ ¸å¿ƒå±‚ã€‚è¿™æ ·ï¼Œå¯ä»¥æŠŠAæ¨¡å—æ”¾è¿›å¸¸é©»åŒºï¼Œå½“ç”¨æˆ·è°ƒç”¨Dæˆ–è€…Eæ¨¡å—æ—¶å°±æŠŠDæˆ–è€…Eæ”¾å…¥è¦†ç›–åŒºï¼ŒBä¹Ÿæ”¾å…¥è¦†ç›–åŒºï¼Œå½“ç”¨æˆ·è°ƒç”¨Fæ—¶ï¼Œå°±æŠŠFå’ŒCæ”¾å…¥è¦†ç›–åŒºã€‚</p>
<p><strong>å‰æ:</strong> æ¨¡å—çš„åˆ’åˆ†å¤§å°è¦ä¿è¯æ”¾å…¥æ¨¡å—çš„ç¨‹åºå¤Ÿç”¨ã€‚</p>
</li>
<li><p><strong>ç¼ºç‚¹</strong></p>
<p>æ¨¡å—çš„åˆ’åˆ†å’Œç¨‹åºé€»è¾‘è¦æ±‚å¾ˆé«˜ï¼Œæ‰§è¡Œé€Ÿåº¦å˜æ…¢</p>
</li>
</ul>
<h5 id="å››ã€å†…å­˜äº¤æ¢æŠ€æœ¯"><a href="#å››ã€å†…å­˜äº¤æ¢æŠ€æœ¯" class="headerlink" title="å››ã€å†…å­˜äº¤æ¢æŠ€æœ¯"></a>å››ã€å†…å­˜äº¤æ¢æŠ€æœ¯</h5><ul>
<li><p><strong>åŸç†</strong></p>
<p>å†…å­˜ä¸å¤Ÿæ—¶å°†è¿›ç¨‹å†™åˆ°ç£ç›˜(<strong>æ¢å‡º/Swap Out</strong>)ï¼Œå½“è¿›ç¨‹è¦è¿è¡Œæ—¶é‡æ–°å†™å›åˆ°å†…å­˜(<strong>æ¢å…¥/Swap In</strong>)</p>
<p><img src="https://blog-1257300108.cos.ap-beijing.myqcloud.com/OS/os10.png" alt></p>
</li>
<li><p><strong>ä¼˜ç‚¹</strong></p>
<p>å¢åŠ è¿›ç¨‹å¹¶å‘æ•°ï¼Œä¸éœ€è¦è€ƒè™‘ç¨‹åºçš„æ¨¡å—ç»“æ„</p>
</li>
<li><p>ç¼ºç‚¹</p>
<p>I/Oé¢‘ç¹ï¼Œä»¥è¿›ç¨‹ä¸ºå•ä½æ“ä½œå¤ªå¤§ï¼Œå¢åŠ èµ„æºå¼€é”€</p>
</li>
<li><p><strong>æ¢å…¥æ¢å‡ºåçš„åœ°å€é‡å®šä½é—®é¢˜</strong></p>
</li>
</ul>
<h5 id="äº”ã€å†…å­˜ç¢ç‰‡"><a href="#äº”ã€å†…å­˜ç¢ç‰‡" class="headerlink" title="äº”ã€å†…å­˜ç¢ç‰‡"></a>äº”ã€å†…å­˜ç¢ç‰‡</h5><p><u>åŠ¨æ€åˆ†åŒºå®¹æ˜“äº§ç”Ÿç¢ç‰‡é—®é¢˜</u>ã€‚<strong>æœ€ä½³é€‚åº”æ³•</strong>çš„å†…å­˜åˆ†é…ç­–ç•¥æœ€å®¹æ˜“äº§ç”Ÿç¢ç‰‡ã€‚</p>
<ul>
<li><p><strong>è§£å†³ç¢ç‰‡çš„åŠæ³•ä¸€</strong></p>
<p>è§„å®šé—¨é™åˆ¶ï¼Œåˆ†å‰²ç©ºé—²åŒºæ—¶ï¼Œè‹¥å‰©ä½™çš„ç©ºé—²åŒºå°äºé—¨çº¿å€¼åˆ™æŠŠå‰©ä½™çš„åˆ†åŒºä¹Ÿåˆ†é…ç»™ç”¨æˆ·ã€‚</p>
</li>
<li><p><strong>è§£å†³ç¢ç‰‡çš„åŠæ³•äºŒ: å†…å­˜æ‹¼æ¥æŠ€æœ¯</strong></p>
<p>å°†æ‰€æœ‰çš„ç©ºé—²åŒºæ‹¼æ¥æˆä¸€ä¸ªå¤§çš„åˆ†åŒºã€‚</p>
<p><strong>æ‹¼æ¥çš„æ—¶æœº:</strong></p>
<ul>
<li>é‡Šæ”¾åŒºå›æ”¶çš„æ—¶å€™ã€‚é—®é¢˜: æ‹¼æ¥é¢‘ç‡è¿‡å¤§ï¼Œç³»ç»Ÿå¼€é”€å¤§ã€‚</li>
<li>ç³»ç»Ÿæ‰¾ä¸åˆ°è¶³å¤Ÿå¤§çš„ç©ºé—²åŒºæ—¶ã€‚é—®é¢˜: ç©ºé—²åŒºçš„ç®¡ç†å¤æ‚ã€‚</li>
<li>å®šæœŸæ‹¼æ¥ã€‚é—®é¢˜: ç©ºé—²åŒºçš„ç®¡ç†å¤æ‚ã€‚</li>
</ul>
</li>
<li><p><strong>è§£å†³ç¢ç‰‡çš„åŠæ³•ä¸‰: è®©ç¨‹åºå¯ä»¥è¿è¡Œåœ¨ä¸è¿ç»­çš„å†…å­˜ç©ºé—´</strong></p>
<p>å¦‚æœè§£å†³äº†è¿™ä¸ªé™åˆ¶ï¼Œé‚£ä¹ˆå°±ç›¸å½“äºä¸å­˜åœ¨ç¢ç‰‡è¿™ä¸€æ¦‚å¿µï¼Œç¢ç‰‡é—®é¢˜ä¹Ÿå°±ä¸å­˜åœ¨äº†ã€‚</p>
<p><strong>é¡µå¼å­˜å‚¨ç®¡ç†</strong>å’Œ<strong>æ®µå¼å­˜å‚¨ç®¡ç†</strong>ä¸€å®šç¨‹åº¦ä¸Šåº”ç”¨äº†è¿™ç§æ€æƒ³ã€‚</p>
</li>
</ul>
<h4 id="è™šæ‹Ÿå†…å­˜ç®¡ç†"><a href="#è™šæ‹Ÿå†…å­˜ç®¡ç†" class="headerlink" title="è™šæ‹Ÿå†…å­˜ç®¡ç†"></a>è™šæ‹Ÿå†…å­˜ç®¡ç†</h4><h5 id="ä¸€ã€é¡µå¼è™šæ‹Ÿå†…å­˜ç®¡ç†çš„æ¦‚å¿µ"><a href="#ä¸€ã€é¡µå¼è™šæ‹Ÿå†…å­˜ç®¡ç†çš„æ¦‚å¿µ" class="headerlink" title="ä¸€ã€é¡µå¼è™šæ‹Ÿå†…å­˜ç®¡ç†çš„æ¦‚å¿µ"></a>ä¸€ã€é¡µå¼è™šæ‹Ÿå†…å­˜ç®¡ç†çš„æ¦‚å¿µ</h5><ul>
<li><p><strong>è™šæ‹Ÿå†…å­˜ç®¡ç†çš„ç›®æ ‡</strong></p>
<ul>
<li>ä½¿å¾—å¤§ç¨‹åºèƒ½åœ¨è¾ƒå°çš„å†…å­˜ä¸­è¿è¡Œ</li>
<li>ä½¿å¾—å¤šä¸ªç¨‹åºèƒ½åœ¨è¾ƒå°çš„å†…å­˜ä¸­è¿è¡Œ</li>
<li>ä½¿å¾—å¤šä¸ªç¨‹åºå¹¶å‘è¿è¡Œæ—¶åœ°å€ä¸å†²çª</li>
<li>ä½¿å¾—å†…å­˜åˆ©ç”¨ç‡æé«˜: æ— ç¢ç‰‡ï¼Œå…±äº«æ–¹ä¾¿</li>
</ul>
</li>
<li><p><strong>è™šæ‹Ÿå†…å­˜çš„å®ç°æ€è·¯</strong></p>
<p>åœ¨ç¨‹åºè¿è¡Œæ—¶ï¼ŒåªæŠŠå½“å‰å¿…è¦çš„å¾ˆå°ä¸€éƒ¨åˆ†ä»£ç æ”¾å…¥å†…å­˜ä¸­ã€‚å…¶ä½™çš„ä»£ç éœ€è¦æ—¶å†è£…å…¥ï¼Œå·²ç»è£…å…¥çš„ä»£ç ä¸éœ€è¦æ—¶å†åŠæ—¶åˆ é™¤ã€‚</p>
</li>
<li><p><strong>ç¨‹åºè¿è¡Œçš„å±€éƒ¨æ€§</strong></p>
<p>ç¨‹åºåœ¨ä¸€ä¸ªæœ‰é™çš„æ—¶é—´æ®µå†…ï¼Œè®¿é—®çš„ä»£ç å’Œæ•°æ®å¾€å¾€é›†ä¸­åœ¨æœ‰é™çš„èŒƒå›´å†…ã€‚</p>
<p>æŠŠç¨‹åºä¸€éƒ¨åˆ†è£…å…¥å†…å­˜åœ¨è¾ƒå¤§æ¦‚ç‡ä¸Šä¹Ÿè¶³å¤Ÿè®©å…¶è¿è¡Œä¸€å°æ®µæ—¶é—´</p>
</li>
<li><p><strong>å…¸å‹è™šæ‹Ÿå†…å­˜ç®¡ç†æ–¹å¼</strong></p>
<ul>
<li><strong>é¡µå¼</strong>è™šæ‹Ÿå­˜å‚¨ç®¡ç†</li>
<li><strong>æ®µå¼</strong>è™šæ‹Ÿå­˜å‚¨ç®¡ç†</li>
<li><strong>æ®µé¡µå¼</strong>è™šæ‹Ÿå­˜å‚¨ç®¡ç†</li>
</ul>
</li>
<li><p><strong>é¡µå¼è™šæ‹Ÿå†…å­˜ç®¡ç†çš„æ¦‚å¿µ: æŠŠ<em><u>è¿›ç¨‹ç©ºé—´</u></em> å’Œ <em><u>å†…å­˜ç©ºé—´</u></em>åˆ’åˆ†æˆç­‰å¤§å°çš„å°ç‰‡</strong></p>
<ul>
<li><p>å°ç‰‡çš„å…¸å‹å¤§å°: 1Kã€2Kæˆ–4K</p>
</li>
<li><p><strong>è¿›ç¨‹çš„å°ç‰‡: é¡µã€è™šæ‹Ÿé¡µæˆ–é¡µé¢</strong></p>
</li>
<li><p><strong>å†…å­˜çš„å°ç‰‡: é¡µæ¡†ã€ç‰©ç†é¡µ</strong></p>
</li>
</ul>
<p><img src="https://blog-1257300108.cos.ap-beijing.myqcloud.com/OS/os11.png" alt></p>
<p>å†…å­˜ä»¥<strong>é¡µæ¡†</strong>ä¸ºå•ä½åˆ†é…ä½¿ç”¨ï¼Œè¿›ç¨‹ä»¥é¡µä¸ºå•ä½è£…å…¥å†…å­˜ã€‚å› ä¸ºé¡µåœ¨å†…å­˜ä¸­å ç”¨çš„é¡µæ¡†ä¸å¿…ç›¸é‚»ï¼Œæ‰€ä»¥å°±<strong>è§£å†³äº†åŠ¨æ€åˆ†åŒºäº§ç”Ÿç¢ç‰‡çš„é—®é¢˜</strong>ã€‚</p>
<p><strong>Windowsç³»ç»Ÿä¸­ä»»åŠ¡ç®¡ç†å™¨ä¸­çš„é¡µé¢é”™è¯¯é€‰é¡¹æŒ‡çš„å°±æ˜¯è¿›ç¨‹ä¸­çš„é¡µé¢ã€‚</strong></p>
<p><img src="https://blog-1257300108.cos.ap-beijing.myqcloud.com/OS/os12.png" alt></p>
</li>
</ul>
<h5 id="äºŒã€é¡µè¡¨å’Œé¡µå¼åœ°å€çš„æ˜ å°„"><a href="#äºŒã€é¡µè¡¨å’Œé¡µå¼åœ°å€çš„æ˜ å°„" class="headerlink" title="äºŒã€é¡µè¡¨å’Œé¡µå¼åœ°å€çš„æ˜ å°„"></a>äºŒã€é¡µè¡¨å’Œé¡µå¼åœ°å€çš„æ˜ å°„</h5><ul>
<li><p><strong>é¡µå¼ç³»ç»Ÿä¸­çš„åœ°å€</strong></p>
<p>è™šæ‹Ÿåœ°å€(VA)å¯ä»¥åˆ†è§£æˆé¡µå·På’Œé¡µå†…åç§»W</p>
<ul>
<li><p><strong>é¡µå·(P)</strong></p>
<p><strong>VAæ‰€å¤„é¡µçš„ç¼–å· = VA / é¡µçš„å¤§å°</strong></p>
</li>
<li><p><strong>é¡µå†…åç§»(W)</strong></p>
<p><strong>VAåœ¨æ‰€å¤„é¡µä¸­çš„åç§» = VA % é¡µçš„å¤§å°</strong></p>
</li>
<li><p>ğŸŒ°</p>
<p>VA = 2500; é¡µé¢å¤§å°1k($10^{12}$); P = 2500 / 1024 = 2; W = 2500 % 1024 = 452;</p>
</li>
</ul>
</li>
<li><p><strong>é¡µé¢æ˜ å°„è¡¨</strong></p>
<p><strong>è®°å½•é¡µä¸é¡µæ¡†ä¹‹é—´çš„å¯¹åº”å…³ç³»</strong>ã€‚ä¹Ÿå«<strong>é¡µè¡¨</strong>ã€‚</p>
<p><img src="https://blog-1257300108.cos.ap-beijing.myqcloud.com/OS/os13.png" alt></p>
<ul>
<li><p><strong>é¡µå·</strong></p>
<p>ç™»è®°ç¨‹åºåœ°å€çš„é¡µå·</p>
</li>
<li><p><strong>é¡µæ¡†å·</strong></p>
<p>ç™»è®°é¡µæ‰€åœ¨çš„ç‰©ç†é¡µå·</p>
</li>
<li><p>é¡µé¢å…¶ä»–ç‰¹æ€§</p>
<p>ç™»è®°å«<strong>å­˜å–æƒé™</strong>åœ¨å†…çš„å…¶ä»–ç‰¹æ€§</p>
</li>
<li><p>ä¾‹å­</p>
<p><img src="https://blog-1257300108.cos.ap-beijing.myqcloud.com/OS/os14.png" alt></p>
<p>å†…å­˜ä¸­çš„é¡µæ¡†å·å¯¹åº”ç¨‹åºä¸­çš„é¡µå·</p>
</li>
</ul>
</li>
<li><p><strong>é¡µå¼åœ°å€æ˜ å°„çš„è¿‡ç¨‹</strong></p>
<ol>
<li><p>ä»<strong>VA</strong>ä¸­åˆ†ç¦»<strong>é¡µå·P</strong>å’Œ<strong>é¡µåç§»W</strong>;</p>
</li>
<li><p><strong>æŸ¥é¡µè¡¨:</strong> ä»¥<strong>P</strong>ä¸ºç´¢å¼•æŸ¥<strong>é¡µæ¡†å·Pâ€™;</strong></p>
</li>
<li><p>è®¡ç®—<strong>ç‰©ç†åœ°å€MA;</strong></p>
<p><strong>MA = Pâ€™ * é¡µå¤§å° + W</strong></p>
</li>
<li><p><strong>ä¾‹å­</strong></p>
<p><strong>MOV R1, [2500]</strong> è®¡ç®—ç‰©ç†åœ°å€æ˜ å°„è¿‡ç¨‹</p>
<ul>
<li><p>åˆ†ç¦»<strong>é¡µå·P</strong>å’Œ<strong>é¡µåç§»W</strong></p>
<p>P = 2500 / 1024 = 2; W = 2500 % 1024 = 452;</p>
</li>
<li><p><strong>æŸ¥æ‰¾é¡µè¡¨</strong></p>
<p>å‡å®šé¡µå·2å¯¹åº”çš„é¡µæ¡†å·æ˜¯7ï¼Œé‚£ä¹ˆ MA = 7 * 1024 + 452 = 7620;</p>
</li>
</ul>
</li>
</ol>
</li>
</ul>
<h5 id="ä¸‰ã€å¿«è¡¨æŠ€æœ¯å’Œé¡µé¢å…±äº«æŠ€æœ¯"><a href="#ä¸‰ã€å¿«è¡¨æŠ€æœ¯å’Œé¡µé¢å…±äº«æŠ€æœ¯" class="headerlink" title="ä¸‰ã€å¿«è¡¨æŠ€æœ¯å’Œé¡µé¢å…±äº«æŠ€æœ¯"></a>ä¸‰ã€å¿«è¡¨æŠ€æœ¯å’Œé¡µé¢å…±äº«æŠ€æœ¯</h5><ul>
<li><p><strong>å¿«è¡¨æ¦‚å¿µ</strong></p>
<p>æ…¢è¡¨: é¡µè¡¨æ”¾åœ¨å†…å­˜ä¸­;  å¿«è¡¨: é¡µè¡¨æ”¾åœ¨Cacheä¸­</p>
<p>åœ°å€æ˜ å°„æ—¶å…ˆè®¿é—®å¿«è¡¨ï¼Œè‹¥æ²¡æœ‰å†è®¿é—®æ…¢è¡¨ï¼ŒåŒæ—¶æ›´æ–°Cacheã€‚</p>
</li>
<li><p><strong>é¡µé¢å…±äº«åŸç†</strong></p>
<p>åœ¨ä¸åŒè¿›ç¨‹çš„é¡µè¡¨ä¸­<strong>å¡«ä¸Šç›¸åŒçš„é¡µæ¡†å·</strong>ï¼Œå¤šä¸ªè¿›ç¨‹èƒ½è®¿é—®ç›¸åŒçš„å†…å­˜ç©ºé—´ä»è€Œå®ç°é¡µé¢å…±äº«ã€‚</p>
<p>å…±äº«é¡µé¢åœ¨å†…å­˜ä¸­åªæœ‰ä¸€ä»½å­˜å‚¨ï¼ŒèŠ‚çœå†…å­˜ã€‚</p>
</li>
</ul>
<h5 id="å››ã€ç¼ºé¡µä¸­æ–­"><a href="#å››ã€ç¼ºé¡µä¸­æ–­" class="headerlink" title="å››ã€ç¼ºé¡µä¸­æ–­"></a>å››ã€ç¼ºé¡µä¸­æ–­</h5><p><img src="https://blog-1257300108.cos.ap-beijing.myqcloud.com/OS/os15.png" alt></p>
<ul>
<li><p><strong>é¡µè¡¨æ‰©å……-å¸¦ä¸­æ–­ä½çš„é¡µè¡¨</strong></p>
<p><img src="https://blog-1257300108.cos.ap-beijing.myqcloud.com/OS/os16.png" alt></p>
<p><strong>ä¸­æ–­ä½I</strong>â€”&gt;1:è¡¨ç¤ºé¡µé¢ä¸åœ¨å†…å­˜é‡Œ; 0: è¡¨ç¤ºé¡µé¢åœ¨å†…å­˜é‡Œ</p>
</li>
<li><p><strong>é¡µè¡¨æ‰©å……-å¸¦è®¿é—®ä½å’Œä¿®æ”¹ä½çš„é¡µè¡¨</strong>ã€</p>
<p><img src="https://blog-1257300108.cos.ap-beijing.myqcloud.com/OS/os17.png" alt></p>
<ul>
<li><p>è®¿é—®ä½-<strong>æ ‡è¯†è¯¥é¡µæœ€è¿‘æ˜¯å¦è¢«è®¿é—®</strong>:</p>
<p>0:æœ€è¿‘æ²¡æœ‰è¢«è®¿é—®; 1:æœ€è¿‘è¢«è®¿é—®</p>
</li>
<li><p>ä¿®æ”¹ä½-<strong>æ ‡è¯†è¯¥é¡µæ•°æ®æœ€è¿‘æ˜¯å¦è¢«ä¿®æ”¹</strong>: </p>
<p>0: æœªè¢«ä¿®æ”¹; 1: è¢«ä¿®æ”¹</p>
</li>
</ul>
</li>
<li><p><strong>ç¼ºé¡µä¸­æ–­ç¨‹åº</strong></p>
<p>ä¸­æ–­å¤„ç†ç¨‹åºæŠŠæ‰€ç¼ºçš„é¡µ<strong>ä»é¡µè¡¨æŒ‡å‡ºçš„è¾…å­˜åœ°å€è°ƒå…¥å†…å­˜</strong>çš„æŸä¸ªé¡µæ¡†ä¸­ï¼Œå¹¶<strong>æ›´æ–°</strong>é¡µè¡¨ä¸­è¯¥é¡µå¯¹åº”çš„<strong>é¡µæ¡†å·</strong>ï¼Œå¹¶å°†<strong>ä¸­æ–­ä½Iä¿®æ”¹ä¸º0</strong>ã€‚</p>
</li>
</ul>
<h5 id="äº”ã€é¡µé¢æ·˜æ±°ç­–ç•¥"><a href="#äº”ã€é¡µé¢æ·˜æ±°ç­–ç•¥" class="headerlink" title="äº”ã€é¡µé¢æ·˜æ±°ç­–ç•¥"></a>äº”ã€é¡µé¢æ·˜æ±°ç­–ç•¥</h5><ul>
<li><p><strong>é¡µé¢æŠ–åŠ¨</strong></p>
<p>é¡µé¢åœ¨å†…å­˜å’Œè¾…å­˜ä¸­é¢‘ç¹äº¤æ¢ã€‚é¡µé¢æŠ–åŠ¨ä¼šå¯¼è‡´ç³»ç»Ÿæ•ˆç‡ä¸‹é™ã€‚</p>
</li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/06/03/SpringBootè‡ªåŠ¨é…ç½®åŸç†/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="liupf">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="liupf's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/06/03/SpringBootè‡ªåŠ¨é…ç½®åŸç†/" itemprop="url">SpringBootè‡ªåŠ¨é…ç½®åŸç†</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2019-06-03T16:32:35+08:00">
                2019-06-03
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">åˆ†ç±»äº</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Spring/" itemprop="url" rel="index">
                    <span itemprop="name">Spring</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><strong>è‡ªåŠ¨é…ç½®åŸç†</strong></p>
<ol>
<li><p>åœ¨SpringBootå¯åŠ¨ç±»ä¸­æœ‰<strong>@SpringBootApplication</strong>æ³¨è§£ã€‚è¿›å…¥è¯¥æ³¨è§£çœ‹åˆ°è¯¥ç±»ä¸Šæœ‰<strong>@EnableAutoConfiguration</strong>æ³¨è§£ï¼Œè¿™ä¸ªæ³¨è§£å°±æ˜¯SpringBootè‡ªåŠ¨é…ç½®çš„å…¥å£ã€‚</p>
</li>
<li><p><strong>@EnableAutoConfiguration</strong>åˆ©ç”¨é€‰æ‹©å™¨<a href="mailto:**@AutoConfigurationImportSelector.class" target="_blank" rel="noopener">**@AutoConfigurationImportSelector.class</a>**ç»™å®¹å™¨å¯¼å…¥ä¸€äº›ç»„ä»¶</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Target</span>(&#123;ElementType.TYPE&#125;)</span><br><span class="line"><span class="meta">@Retention</span>(RetentionPolicy.RUNTIME)</span><br><span class="line"><span class="meta">@Documented</span></span><br><span class="line"><span class="meta">@Inherited</span></span><br><span class="line"><span class="meta">@AutoConfigurationPackage</span></span><br><span class="line"><span class="comment">//ä»è¿™é‡Œå¯¼å…¥ä¸€äº›ç»„ä»¶</span></span><br><span class="line"><span class="meta">@Import</span>(&#123;AutoConfigurationImportSelector.class&#125;)</span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> EnableAutoConfiguration &#123;</span><br><span class="line">    String ENABLED_OVERRIDE_PROPERTY = <span class="string">"spring.boot.enableautoconfiguration"</span>;</span><br><span class="line"></span><br><span class="line">    Class&lt;?&gt;[] exclude() <span class="keyword">default</span> &#123;&#125;;</span><br><span class="line"></span><br><span class="line">    String[] excludeName() <span class="keyword">default</span> &#123;&#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ç„¶åè¿›å…¥<strong>AutoConfigurationImportSelector</strong>ç±»ï¼Œå…¶ä¸­æœ‰ä¸€ä¸ª<strong>selectImports(AnnotationMetadata annotationMetadata)</strong>æ–¹æ³•ï¼Œè¯¥æ–¹æ³•å†…<strong>this.getAutoConfigurationEntry(autoConfigurationMetadata, annotationMetadata);</strong>æ–¹æ³•æœ€ç»ˆä¼šè°ƒç”¨åˆ°ä»¥ä¸‹æ–¹æ³•</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> AutoConfigurationImportSelector.<span class="function">AutoConfigurationEntry <span class="title">getAutoConfigurationEntry</span><span class="params">(AutoConfigurationMetadata autoConfigurationMetadata, AnnotationMetadata annotationMetadata)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (!<span class="keyword">this</span>.isEnabled(annotationMetadata)) &#123;</span><br><span class="line">        <span class="keyword">return</span> EMPTY_ENTRY;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        AnnotationAttributes attributes = <span class="keyword">this</span>.getAttributes(annotationMetadata);</span><br><span class="line">      <span class="comment">//è·å–å€™é€‰çš„é…ç½®</span></span><br><span class="line">        List&lt;String&gt; configurations = <span class="keyword">this</span>.getCandidateConfigurations(annotationMetadata, attributes);</span><br><span class="line">        configurations = <span class="keyword">this</span>.removeDuplicates(configurations);</span><br><span class="line">        Set&lt;String&gt; exclusions = <span class="keyword">this</span>.getExclusions(annotationMetadata, attributes);</span><br><span class="line">        <span class="keyword">this</span>.checkExcludedClasses(configurations, exclusions);</span><br><span class="line">        configurations.removeAll(exclusions);</span><br><span class="line">        configurations = <span class="keyword">this</span>.filter(configurations, autoConfigurationMetadata);</span><br><span class="line">        <span class="keyword">this</span>.fireAutoConfigurationImportEvents(configurations, exclusions);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> AutoConfigurationImportSelector.AutoConfigurationEntry(configurations, exclusions);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å…¶ä¸­<strong>List<string> configurations = this.getCandidateConfigurations(annotationMetadata, attributes);</string></strong>æ˜¯è·å–å€™é€‰çš„é…ç½®ã€‚</p>
<ul>
<li><p>è¿›å…¥<strong>getCandidateConfigurations(annotationMetadata, attributes)</strong>æ–¹æ³•</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> List&lt;String&gt; <span class="title">getCandidateConfigurations</span><span class="params">(AnnotationMetadata metadata, AnnotationAttributes attributes)</span> </span>&#123;</span><br><span class="line">    List&lt;String&gt; configurations = SpringFactoriesLoader.loadFactoryNames(<span class="keyword">this</span>.getSpringFactoriesLoaderFactoryClass(), <span class="keyword">this</span>.getBeanClassLoader());</span><br><span class="line">    Assert.notEmpty(configurations, <span class="string">"No auto configuration classes found in META-INF/spring.factories. If you are using a custom packaging, make sure that file is correct."</span>);</span><br><span class="line">    <span class="keyword">return</span> configurations;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä»è¿™è¡Œä»£ç <strong><code>List&lt;String&gt; configurations = SpringFactoriesLoader.loadFactoryNames(this.getSpringFactoriesLoaderFactoryClass(), this.getBeanClassLoader());</code></strong>è¿›å…¥ï¼Œå®ƒä¼šä»ç±»è·¯å¾„ä¸‹å¾—åˆ°ä¸€ä¸ªèµ„æº: ç„¶åæ‰«æç±»è·¯å¾„ä¸‹è¿™ä¸¤ä¸ªé…ç½®æ–‡ä»¶</p>
<p><strong>â€œMETA-INF/spring.factoriesâ€ â€œMETA-INF/spring.factoriesâ€</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//ä»ç±»è·¯å¾„å¾—åˆ°ä¸¤ä¸ªé…ç½®æ–‡ä»¶  ä¹‹åæ‰«æå…¶ä¸­çš„å†…å®¹</span></span><br><span class="line">Enumeration&lt;URL&gt; urls = classLoader != <span class="keyword">null</span> ? classLoader.getResources(<span class="string">"META-INF/spring.factories"</span>) : ClassLoader.getSystemResources(<span class="string">"META-INF/spring.factories"</span>);</span><br><span class="line"></span><br><span class="line">LinkedMultiValueMap result = <span class="keyword">new</span> LinkedMultiValueMap();</span><br><span class="line"></span><br><span class="line">                <span class="keyword">while</span>(urls.hasMoreElements()) &#123;</span><br><span class="line">                    URL url = (URL)urls.nextElement();</span><br><span class="line">                    UrlResource resource = <span class="keyword">new</span> UrlResource(url);</span><br><span class="line">                  <span class="comment">//æŠŠæ‰«æåˆ°çš„å†…å®¹å°è£…åˆ°Propertieså¯¹è±¡</span></span><br><span class="line">                    Properties properties = PropertiesLoaderUtils.loadProperties(resource);</span><br><span class="line">                    Iterator var6 = properties.entrySet().iterator();</span><br><span class="line"></span><br><span class="line">                    <span class="keyword">while</span>(var6.hasNext()) &#123;</span><br><span class="line">                        Entry&lt;?, ?&gt; entry = (Entry)var6.next();</span><br><span class="line">                        String factoryClassName = ((String)entry.getKey()).trim();</span><br><span class="line">                        String[] var9 = StringUtils.commaDelimitedListToStringArray((String)entry.getValue());</span><br><span class="line">                        <span class="keyword">int</span> var10 = var9.length;</span><br><span class="line"></span><br><span class="line">                        <span class="keyword">for</span>(<span class="keyword">int</span> var11 = <span class="number">0</span>; var11 &lt; var10; ++var11) &#123;</span><br><span class="line">                            String factoryName = var9[var11];</span><br><span class="line">                            result.add(factoryClassName, factoryName.trim());</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line"><span class="keyword">return</span> result;</span><br></pre></td></tr></table></figure>
<p>æœ€åæŠŠè¿™ä¸ªé…ç½®æ–‡ä»¶ä¸­æ‰«æåˆ°çš„å†…å®¹å°è£…åˆ°ä¸€ä¸ª<strong><code>Properties</code></strong>å¯¹è±¡ä¸­</p>
<p>é…ç½®æ–‡ä»¶ä¸­æ‰€æœ‰çš„<strong>EnableAutoConfiguration</strong>å€¼è¢«åŠ å…¥åˆ°å®¹å™¨ä¸­ï¼Œè¿™äº›ä»¥<strong>AutoConfiguration</strong>ç»“å°¾çš„å°±æ˜¯è¦åŠ å…¥åˆ°å®¹å™¨çš„ç»„ä»¶ï¼Œä»è€Œå®ç°è‡ªåŠ¨é…ç½®</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"># Auto Configure</span><br><span class="line">org.springframework.boot.autoconfigure.EnableAutoConfiguration=\</span><br><span class="line">org.springframework.boot.autoconfigure.admin.SpringApplicationAdminJmxAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.aop.AopAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.amqp.RabbitAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.batch.BatchAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.cache.CacheAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.cassandra.CassandraAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.cloud.CloudServiceConnectorsAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.context.ConfigurationPropertiesAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.context.MessageSourceAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.context.PropertyPlaceholderAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.couchbase.CouchbaseAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.dao.PersistenceExceptionTranslationAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.data.cassandra.CassandraDataAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.data.cassandra.CassandraReactiveDataAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.data.cassandra.CassandraReactiveRepositoriesAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.data.cassandra.CassandraRepositoriesAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.data.couchbase.CouchbaseDataAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.data.couchbase.CouchbaseReactiveDataAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.data.couchbase.CouchbaseReactiveRepositoriesAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.data.couchbase.CouchbaseRepositoriesAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.data.elasticsearch.ElasticsearchAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.data.elasticsearch.ElasticsearchDataAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.data.elasticsearch.ElasticsearchRepositoriesAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.data.jdbc.JdbcRepositoriesAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.data.jpa.JpaRepositoriesAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.data.ldap.LdapRepositoriesAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.data.mongo.MongoDataAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.data.mongo.MongoReactiveDataAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.data.mongo.MongoReactiveRepositoriesAuto</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>æ¯ä¸€ä¸ªè‡ªåŠ¨é…ç½®ç±»è¿›è¡Œè‡ªåŠ¨é…ç½®åŠŸèƒ½</p>
<ul>
<li><p>ä»¥<strong>HttpEncodingAutoConfiguration</strong>è§£é‡Šè‡ªåŠ¨é…ç½®åŸç†</p>
<p>åœ¨<strong>@EnableConfigurationProperties({HttpProperties.class})</strong>æ³¨è§£ä¸­è¿›å…¥<strong>HttpProperties</strong>ç±»ä¸­</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//è¡¨ç¤ºè¿™æ˜¯ä¸€ä¸ªé…ç½®ç±»</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="comment">//å¯åŠ¨æŒ‡å®šç±»çš„ConfigurationPropertiesåŠŸèƒ½</span></span><br><span class="line"><span class="meta">@EnableConfigurationProperties</span>(&#123;HttpProperties.class&#125;)</span><br><span class="line"><span class="comment">/*@Conditionalæ˜¯Springåº•å±‚æ³¨è§£ï¼Œå®ƒçš„ä½œç”¨æ˜¯æ ¹æ®ä¸åŒçš„æ¡ä»¶ï¼Œå¦‚æœæŒ‡å®šçš„æ¡ä»¶æ»¡è¶³åˆ™æ•´ä¸ªé…ç½®ç±»é‡Œçš„é…ç½®å°±ä¼šç”Ÿæ•ˆ*/</span></span><br><span class="line"><span class="comment">//è¿™ä¸ªConditionalæ³¨è§£çš„ä½œç”¨å°±æ˜¯åˆ¤æ–­è¿™ä¸ªç±»æ˜¯ä¸æ˜¯Webç±»</span></span><br><span class="line"><span class="meta">@ConditionalOnWebApplication</span>(</span><br><span class="line">    type = Type.SERVLET</span><br><span class="line">)</span><br><span class="line"><span class="comment">//åˆ¤æ–­å½“å‰é¡¹ç›®æœ‰æ²¡æœ‰è¿™ä¸ªç±»  Filteræ˜¯SpringMvcè§£å†³ä¹±ç çš„è¿‡æ»¤å™¨</span></span><br><span class="line"><span class="meta">@ConditionalOnClass</span>(&#123;CharacterEncodingFilter.class&#125;)</span><br><span class="line"><span class="comment">//åˆ¤æ–­é…ç½®æ–‡ä»¶ä¸­æ˜¯å¦å­˜åœ¨æŸä¸ªé…ç½® spring.http.encoding.enabled</span></span><br><span class="line"><span class="comment">//matchIfMissing = true è¡¨ç¤ºä¸é…ç½®ä¹Ÿå¯ä»¥ é»˜è®¤æ˜¯true</span></span><br><span class="line"><span class="meta">@ConditionalOnProperty</span>(</span><br><span class="line">    prefix = <span class="string">"spring.http.encoding"</span>,</span><br><span class="line">    value = &#123;<span class="string">"enabled"</span>&#125;,</span><br><span class="line">    matchIfMissing = <span class="keyword">true</span></span><br><span class="line">)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HttpEncodingAutoConfiguration</span> </span>&#123;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">final</span> Encoding properties;</span><br><span class="line">  <span class="comment">//åªæœ‰ä¸€ä¸ªæœ‰å‚æ„é€ å™¨ï¼Œé‚£ä¹ˆå‚æ•°çš„å€¼å°±ä¼šä»iocå®¹å™¨ä¸­è·å–  è€Œè¿™è¡Œä»£ç å®é™…ä¸Šå°±æ˜¯		 @EnableConfigurationProperties(&#123;HttpProperties.class&#125;)ç”Ÿæ•ˆåäº§ç”Ÿ</span></span><br><span class="line">  <span class="meta">@Bean</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="title">HttpEncodingAutoConfiguration</span><span class="params">(HttpProperties properties)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.properties = properties.getEncoding();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//ç»™å®¹å™¨æ·»åŠ ä¸€ä¸ªç»„ä»¶  è¿™ä¸ªç»„ä»¶çš„ä¸€äº›å€¼å°±æ˜¯ä»HttpPropertiesç±»ä¸­è·å–çš„  å°±æ˜¯æœ€ä¸Šè¾¹é‚£ä¸ªæ³¨è§£</span></span><br><span class="line">  <span class="comment">//@EnableConfigurationProperties(&#123;HttpProperties.class&#125;)</span></span><br><span class="line">  <span class="meta">@Bean</span></span><br><span class="line">  <span class="meta">@ConditionalOnMissingBean</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> CharacterEncodingFilter <span class="title">characterEncodingFilter</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        CharacterEncodingFilter filter = <span class="keyword">new</span> OrderedCharacterEncodingFilter();</span><br><span class="line">        filter.setEncoding(<span class="keyword">this</span>.properties.getCharset().name());</span><br><span class="line">        		  filter.setForceRequestEncoding(<span class="keyword">this</span>.properties.shouldForce(org.springframework.boot.autoconfigure.http.HttpProperties.Encoding.Type.REQUEST));</span><br><span class="line">        filter.setForceResponseEncoding(<span class="keyword">this</span>.properties.shouldForce(org.springframework.boot.autoconfigure.http.HttpProperties.Encoding.Type.RESPONSE));</span><br><span class="line">        <span class="keyword">return</span> filter;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ç»¼ä¸Šæ‰€è¿°ä»¥<strong>*AutoConfiguration</strong>ç»“å°¾çš„è¿™ç§ç±»å°±æ˜¯åˆ¤æ–­æ ¹æ®ä¸åŒçš„æ¡ä»¶åˆ¤æ–­é…ç½®ç±»æ˜¯å¦ç”Ÿæ•ˆï¼Œå¦‚æœç”Ÿæ•ˆ:</p>
<p>é‚£ä¹ˆè¿™ä¸ªé…ç½®ç±»å°±ä¼šç»™å®¹å™¨ä¸­æ·»åŠ ç»„ä»¶ã€‚æ‰€æ·»åŠ ç»„ä»¶çš„å±æ€§å°±æ˜¯ä»<strong>properties</strong>é…ç½®æ–‡ä»¶ä¸­è·å–çš„  <strong>å‚è€ƒä¸‹ä¸€æ­¥</strong></p>
</li>
<li><p>è¿›å…¥<strong>HttpProperties</strong>ç±»ä¸­ï¼Œä»<strong>ConfigurationProperties</strong>æ³¨è§£å¯ä»¥çœ‹å‡ºï¼Œè¿™ä¸ªç±»ä»é…ç½®æ–‡ä»¶ä¸­è·å–æŒ‡å®šçš„å€¼å’Œ<strong>bean</strong>å±æ€§è¿›è¡Œç»‘å®š</p>
<p>æ‰€ä»¥æ‰€æœ‰èƒ½åœ¨é…ç½®æ–‡ä»¶ä¸­è¿›è¡Œé…ç½®çš„å±æ€§éƒ½æ˜¯åœ¨ä»¥<strong>*Properties</strong>çš„ç±»ä¸­å°è£…ç€</p>
</li>
<li><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//å°†é…ç½®æ–‡ä»¶å¯¹åº”çš„å€¼å’ŒHttpPropertiesç»‘å®šèµ·æ¥</span></span><br><span class="line"><span class="meta">@ConfigurationProperties</span>(</span><br><span class="line">    prefix = <span class="string">"spring.http"</span></span><br><span class="line">)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HttpProperties</span> </span>&#123;</span><br><span class="line">  <span class="comment">/*å…¶ä¸­çš„ä¸€äº›å±æ€§*/</span></span><br><span class="line">  			<span class="keyword">private</span> Charset charset;</span><br><span class="line">        <span class="keyword">private</span> Boolean force;</span><br><span class="line">        <span class="keyword">private</span> Boolean forceRequest;</span><br><span class="line">        <span class="keyword">private</span> Boolean forceResponse;</span><br><span class="line">        <span class="keyword">private</span> Map&lt;Locale, Charset&gt; mapping;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ol>
<p><strong>æ€»ç»“:</strong></p>
<ul>
<li><p><strong>ä»å¯åŠ¨ç±»SpringBootApplication</strong>æ³¨è§£<strong>@EnableAutoConfiguration</strong>è¿›å…¥</p>
</li>
<li><p><strong>EnableAutoConfiguration</strong>ç±»ä¸­çš„<strong>@Importæ³¨è§£å¯¼å…¥AutoConfigurationImportSelector</strong>ç±»</p>
</li>
<li><p><strong>AutoConfigurationImportSelector</strong>ä¸­çš„<strong>selectImports</strong>æ–¹æ³•è°ƒç”¨ <strong>getAutoConfigurationEntry(AutoConfigurationMetadata autoConfigurationMetadata, AnnotationMetadata annotationMetadata)</strong>æ–¹æ³•ï¼Œ</p>
</li>
<li><p>è¿™ä¸ªæ–¹æ³•é‡Œçš„</p>
<p><strong>List<string> configurations = this.getCandidateConfigurations(annotationMetadata, attributes)</string></strong>è¿™è¡Œä»£ç é‡Œçš„æ–¹æ³•åˆå»è°ƒç”¨<strong>SpringFactoriesLoader.loadFactoryNames(this.getSpringFactoriesLoaderFactoryClass(), this.getBeanClassLoader())</strong>æ–¹æ³•</p>
</li>
<li><p>æœ€ç»ˆ<strong>loadSpringFactories()</strong>æ–¹æ³•å°†æ‰«æç±»è·¯å¾„ä¸‹çš„<strong>META-INF/spring.factories</strong>ç³»ç»Ÿè‡ªåŠ¨é…ç½®æ–‡ä»¶</p>
</li>
<li><p>é…ç½®æ–‡ä»¶ä¸­çš„æ‰€æœ‰ä»¥<strong>*AutoConfiguration</strong>ç»“å°¾çš„ç±»éƒ½ä¼šè¢«åŠ è½½å®¹å™¨ä¸­</p>
</li>
<li><p>æ¯ä¸ªä»¥<strong>*AutoConfiguration</strong>ç»“å°¾çš„ç±»éƒ½ä¼šè¿›è¡Œè‡ªåŠ¨é…ç½®åŠŸèƒ½ï¼Œåœ¨è¿™ç§ç±»çš„ä¸Šé¢éƒ½ä¼šæœ‰<strong>@EnableConfigurationProperties({xxxxxProperties.class})</strong>æ³¨è§£ï¼Œå»åŠ è½½ä»¥<strong>Properties</strong>ç»“å°¾çš„é…ç½®ç±»</p>
</li>
<li><p>ä»¥<strong>Properties</strong>ç»“å°¾çš„é…ç½®ç±»å°±ä¼šå»æ ¹æ®**@ConfigurationProperties(</p>
<pre><code>prefix = &quot;spring.http&quot;)**æ³¨è§£å»ç»‘å®šé…ç½®æ–‡ä»¶ä¸­æˆ‘ä»¬ç»™å‡ºçš„å±æ€§å€¼ 
</code></pre></li>
</ul>
<p>è‡³æ­¤ï¼Œè‡ªåŠ¨é…ç½®å®Œæˆã€‚</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/06/01/process-scheduling/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="liupf">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="liupf's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/06/01/process-scheduling/" itemprop="url"> process scheduling</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2019-06-01T21:38:44+08:00">
                2019-06-01
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">åˆ†ç±»äº</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/æ“ä½œç³»ç»Ÿ/" itemprop="url" rel="index">
                    <span itemprop="name">æ“ä½œç³»ç»Ÿ</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><strong>è¿›ç¨‹è°ƒåº¦: åœ¨åˆé€‚çš„æ—¶å€™é€‰æ‹©ä»¥ä¸€å®šçš„ç­–ç•¥é€‰æ‹©ä¸€ä¸ªå°±ç»ªè¿›ç¨‹è¿è¡Œ</strong></p>
<p>ä¸¤ä¸ªå¯ä»¥é‡åŒ–çš„è¡¡é‡æŒ‡æ ‡:</p>
<ul>
<li><strong>å‘¨è½¬æ—¶é—´/å¹³å‡å‘¨è½¬æ—¶é—´</strong></li>
<li><strong>å¸¦æƒå‘¨è½¬æ—¶é—´/å¸¦æƒå¹³å‡å‘¨è½¬æ—¶é—´</strong></li>
</ul>
<p><strong>å‘¨è½¬æ—¶é—´:</strong></p>
<p>â€‹    è¿›ç¨‹æäº¤ç»™è®¡ç®—æœºåˆ°æœ€åå®Œæˆæ‰€èŠ±è´¹çš„æ—¶é—´(t)</p>
<p>â€‹    t = tc - ts   ts:è¿›ç¨‹çš„æäº¤æ—¶é—´(Start);   tc:è¿›ç¨‹çš„å®Œæˆæ—¶é—´(Complete)     </p>
<p>â€‹    <strong>æ„ä¹‰: tè¯´æ˜äº†è¿›ç¨‹åœ¨ç³»ç»Ÿä¸­åœç•™çš„æ—¶é—´é•¿çŸ­</strong></p>
<p><strong>å¹³å‡å‘¨è½¬æ—¶é—´:</strong></p>
<p>t = (t1 +  t2 + t3â€¦. + tn) / n</p>
<p>â€‹    <strong>æ„ä¹‰:å¹³å‡å‘¨è½¬æ—¶é—´è¶ŠçŸ­ï¼Œæ„å‘³ç€è¿›ç¨‹åœ¨ç³»ç»Ÿä¸­çš„åœç•™çš„æ—¶é—´è¶ŠçŸ­ï¼Œå› è€Œç³»ç»Ÿçš„ååé‡å°±è¶Šå¤§ï¼Œèµ„æºåˆ©ç”¨ç‡å°±</strong>          <strong>è¶Šé«˜</strong></p>
<p><strong>å¸¦æƒå‘¨è½¬æ—¶é—´w:</strong></p>
<p>â€‹    å°çš„è¿›ç¨‹æ‰€èŠ±è´¹çš„å‘¨è½¬æ—¶é—´è‚¯å®šå°ï¼Œå¤§çš„è¿›ç¨‹èŠ±è´¹çš„æ—¶é—´è‚¯å®šå¤§ï¼Œæ‰€ä»¥å¼•å…¥å¸¦æƒå‘¨è½¬æ—¶é—´ã€‚</p>
<p>â€‹    <strong>w = t / tr</strong>        t:è¿›ç¨‹çš„å‘¨è½¬æ—¶é—´;    tr:è¿›ç¨‹çš„è¿è¡Œæ—¶é—´</p>
<p>â€‹    æ„ä¹‰:è¿›ç¨‹åœ¨ç³»ç»Ÿä¸­<strong>ç›¸å¯¹</strong>åœç•™æ—¶é—´</p>
<p><strong>å¹³å‡å¸¦æƒå‘¨è½¬æ—¶é—´</strong></p>
<p>â€‹    w = (w1 + w2 + w3 + â€¦ + wn) / n</p>
<hr>
<h3 id="å…¸å‹çš„è°ƒåº¦ç®—æ³•"><a href="#å…¸å‹çš„è°ƒåº¦ç®—æ³•" class="headerlink" title="å…¸å‹çš„è°ƒåº¦ç®—æ³•"></a>å…¸å‹çš„è°ƒåº¦ç®—æ³•</h3><h4 id="å…ˆæ¥å…ˆæœåŠ¡-First-Come-First-Serve"><a href="#å…ˆæ¥å…ˆæœåŠ¡-First-Come-First-Serve" class="headerlink" title="å…ˆæ¥å…ˆæœåŠ¡(First Come First Serve)"></a>å…ˆæ¥å…ˆæœåŠ¡(First Come First Serve)</h4><ul>
<li><p><strong>ç®—æ³•</strong></p>
<p>æŒ‰ç…§ä½œä¸šè¿›å…¥ç³»ç»Ÿçš„æ—¶é—´å…ˆåæ¥æŒ‘é€‰ä½œä¸šï¼Œ<strong>å…ˆè¿›å…¥ç³»ç»Ÿçš„ä½œä¸šä¼˜å…ˆè¢«è¿è¡Œ</strong></p>
</li>
<li><p><strong>ç‰¹ç‚¹</strong></p>
<ul>
<li>å®¹æ˜“å®ç° æ•ˆç‡ä¸é«˜</li>
<li><strong>åªè€ƒè™‘äº†ä½œä¸šçš„ç­‰å€™æ—¶é—´ï¼Œæ²¡æœ‰è€ƒè™‘ä½œä¸šè¿è¡Œæ—¶é—´çš„é•¿çŸ­ã€‚</strong>å› æ­¤ä¸€ä¸ªæ™šæ¥çš„ä½†æ˜¯è¿è¡Œæ—¶é—´å¾ˆçŸ­çš„ä½œä¸šå¯èƒ½éœ€è¦ç­‰å¾…å¾ˆé•¿æ—¶é—´æ‰èƒ½è¢«è¿è¡Œã€‚<strong>ä¸åˆ©äºçŸ­ä½œä¸šæ‰§è¡Œã€‚</strong></li>
</ul>
</li>
</ul>
<h4 id="çŸ­ä½œä¸šä¼˜å…ˆè°ƒåº¦ç®—æ³•-Short-Job-First"><a href="#çŸ­ä½œä¸šä¼˜å…ˆè°ƒåº¦ç®—æ³•-Short-Job-First" class="headerlink" title="çŸ­ä½œä¸šä¼˜å…ˆè°ƒåº¦ç®—æ³•(Short Job First)"></a>çŸ­ä½œä¸šä¼˜å…ˆè°ƒåº¦ç®—æ³•(Short Job First)</h4><ul>
<li><p><strong>ç®—æ³•</strong></p>
<p>å‚è€ƒè¿è¡Œæ—¶é—´ã€‚é€‰å–è¿è¡Œæ—¶é—´æœ€çŸ­çš„ä½œä¸šæŠ•å…¥è¿è¡Œ</p>
</li>
<li><p><strong>ç‰¹ç‚¹</strong></p>
<ul>
<li>å®¹æ˜“å®ç° æ•ˆç‡ä¸é«˜</li>
<li><strong>å¿½è§†äº†ä½œä¸šçš„ç­‰å¾…æ—¶é—´</strong>ï¼Œä¸€ä¸ªæ—©æ¥ä½†æ˜¯å¾ˆé•¿çš„ä½œä¸šå°†ä¼šé•¿æ—¶é—´å¾—ä¸åˆ°è¿è¡Œï¼Œæ˜“å‡ºç°èµ„æºé¥¥é¥¿ç°è±¡ã€‚</li>
</ul>
</li>
</ul>
<h4 id="å“åº”æ¯”ä¼˜å…ˆè°ƒåº¦ç®—æ³•"><a href="#å“åº”æ¯”ä¼˜å…ˆè°ƒåº¦ç®—æ³•" class="headerlink" title="å“åº”æ¯”ä¼˜å…ˆè°ƒåº¦ç®—æ³•"></a>å“åº”æ¯”ä¼˜å…ˆè°ƒåº¦ç®—æ³•</h4><ul>
<li><p><strong>å“åº”æ¯”å®šä¹‰: </strong> ä½œä¸šçš„<strong>å“åº”æ—¶é—´å’Œ</strong>ä¸<strong>è¿è¡Œæ—¶é—´</strong>çš„æ¯”å€¼ã€‚</p>
<p>å“åº”æ¯” = å“åº”æ—¶é—´ / è¿è¡Œæ—¶é—´</p>
<p>â€‹            = (ç­‰å¾…æ—¶é—´ + è¿è¡Œæ—¶é—´) / è¿è¡Œæ—¶é—´</p>
<p>â€‹            = 1 + ç­‰å¾…æ—¶é—´ / è¿è¡Œæ—¶é—´</p>
</li>
<li><p><strong>ç®—æ³•</strong></p>
<p>è®¡ç®—æ¯ä¸ªä½œä¸šçš„å“åº”æ¯”ï¼Œé€‰æ‹©<strong>å“åº”æ¯”æœ€é«˜</strong>çš„ä½œä¸šä¼˜å…ˆæŠ•å…¥è¿è¡Œ</p>
</li>
<li><p><strong>ç‰¹ç‚¹(å…¼é¡¾äº†é•¿ä½œä¸šå’ŒçŸ­ä½œä¸š)</strong></p>
<p><strong>å“åº”æ¯” = 1 + ç­‰å¾…æ—¶é—´ / è¿è¡Œæ—¶é—´</strong></p>
<ul>
<li>å¦‚æœä½œä¸š<strong>ç­‰å¾…æ—¶é—´</strong>ç›¸åŒï¼Œåˆ™è¿è¡Œæ—¶é—´è¶ŠçŸ­çš„ä½œä¸šè¶Šå…ˆè¢«æ‰§è¡Œï¼Œæœ‰åˆ©äºçŸ­ä½œä¸š</li>
<li>å¦‚æœä½œä¸š<strong>è¿è¡Œæ—¶é—´</strong>ç›¸åŒï¼Œåˆ™ç­‰å¾…æ—¶é—´è¶Šé•¿çš„ä½œä¸šè¶Šå…ˆè¢«æ‰§è¡Œï¼Œç­‰å¾…æ—¶é—´é•¿çš„ä½œä¸š</li>
<li>å¯¹äºä¸€ä¸ªè¿è¡Œæ—¶é—´é•¿çš„ä½œä¸šï¼Œåªè¦ä»–ç­‰å¾…çš„æ—¶é—´è¶³å¤Ÿé•¿ï¼Œé‚£ä¹ˆå“åº”æ¯”å°±ä¼šå¢åŠ ï¼Œå¯èƒ½è·å–cpu</li>
</ul>
</li>
</ul>
<h4 id="ä¼˜å…ˆæ•°è°ƒåº¦ç®—æ³•"><a href="#ä¼˜å…ˆæ•°è°ƒåº¦ç®—æ³•" class="headerlink" title="ä¼˜å…ˆæ•°è°ƒåº¦ç®—æ³•"></a>ä¼˜å…ˆæ•°è°ƒåº¦ç®—æ³•</h4><ul>
<li><p><strong>ç®—æ³•</strong></p>
<ul>
<li>æ ¹æ®è¿›ç¨‹ä¼˜å…ˆæ•°ï¼ŒæŠŠCPUåˆ†é…ç»™ä¼˜å…ˆæ•°æœ€å¤§çš„è¿›ç¨‹</li>
<li><strong>ä¼˜å…ˆæ•° = é™æ€ä¼˜å…ˆæ•° + åŠ¨æ€ä¼˜å…ˆæ•°</strong></li>
</ul>
</li>
<li><p><strong>é™æ€ä¼˜å…ˆæ•°</strong></p>
<p>è¿›ç¨‹åˆ›å»ºæ—¶ç¡®å®šï¼Œæ•´ä¸ªè¿›ç¨‹è¿è¡ŒæœŸé—´ä¸æ”¹å˜</p>
<ul>
<li><strong>é™æ€ä¼˜å…ˆæ•°çš„ç¡®å®š</strong><ul>
<li><strong>åŸºäºè¿›ç¨‹æ‰€éœ€èµ„æºçš„å¤šå°‘</strong></li>
<li><strong>åŸºäºç¨‹åºè¿è¡Œæ—¶é—´çš„é•¿çŸ­</strong></li>
<li><strong>è¿›ç¨‹çš„ç±»å‹(IO/CPU,æ ¸å¿ƒ/ç”¨æˆ·,å‰ç«¯/åå°)</strong></li>
</ul>
</li>
</ul>
</li>
<li><p><strong>åŠ¨æ€ä¼˜å…ˆæ•°</strong></p>
<p>ä¼˜å…ˆæ•°åœ¨è¿›ç¨‹è¿è¡ŒæœŸé—´å¯ä»¥æ”¹å˜</p>
<ul>
<li><p><strong>åŠ¨æ€ä¼˜å…ˆæ•°çš„ç¡®å®š</strong></p>
<ul>
<li><p><strong>å½“ä½¿ç”¨CPUä½¿ç”¨è¶…è¿‡ä¸€å®šæ—¶é•¿æ—¶</strong></p>
<p>å¯ä»¥é€‚å½“é™ä½</p>
</li>
<li><p><strong>å½“è¿›è¡ŒI/Oæ“ä½œå</strong></p>
</li>
<li><p><strong>å½“è¿›ç¨‹ç­‰å¾…è¶…è¿‡ä¸€å®šæ—¶é•¿æ—¶</strong></p>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<h4 id="å¾ªç¯è®ºè½¬è°ƒåº¦ç®—æ³•-ROUND-ROBIN"><a href="#å¾ªç¯è®ºè½¬è°ƒåº¦ç®—æ³•-ROUND-ROBIN" class="headerlink" title="å¾ªç¯è®ºè½¬è°ƒåº¦ç®—æ³•(ROUND-ROBIN)"></a>å¾ªç¯è®ºè½¬è°ƒåº¦ç®—æ³•(ROUND-ROBIN)</h4><ul>
<li><p><strong>æ¦‚å¿µ</strong></p>
<ul>
<li><p>æŠŠæ‰€æœ‰å°±ç»ªè¿›ç¨‹<strong>æŒ‰å…ˆè¿›å…ˆå‡ºçš„åŸåˆ™æ’æˆé˜Ÿåˆ—</strong>ã€‚æ–°æ¥çš„è¿›ç¨‹åŠ åˆ°<strong>é˜Ÿåˆ—çš„æœ«å°¾</strong>ã€‚</p>
</li>
<li><p><strong>è¿›ç¨‹ä»¥æ—¶é—´ç‰‡qä¸ºå•ä½è½®æµä½¿ç”¨CPUã€‚</strong>åˆšåˆšè¿è¡Œå®Œçš„ä¸€ä¸ªæ—¶é—´ç‰‡è¿›ç¨‹æ’åˆ°é˜Ÿåˆ—æœ«å°¾ï¼Œç­‰å€™ä¸‹ä¸€è½®è¿è¡Œã€‚</p>
<p>å¦‚æœå½“å‰è¿›ç¨‹åœ¨æ—¶é—´ç‰‡på†…è¿è¡Œå®Œæˆåˆ™æ’¤å‡ºé˜Ÿåˆ—ï¼Œå¦åˆ™åŠ å…¥é˜Ÿåˆ—æœ«å°¾ã€‚</p>
</li>
<li><p>é˜Ÿåˆ—é€»è¾‘ä¸Šæ˜¯ç¯å½¢çš„ã€‚</p>
<p><img src="https://blog-1257300108.cos.ap-beijing.myqcloud.com/OS/os2.png" alt></p>
</li>
</ul>
</li>
<li><p><strong>ä¼˜ç‚¹</strong></p>
<ul>
<li><strong>å…¬å¹³æ€§:</strong> æ¯ä¸ªè¿›ç¨‹æœ‰å¹³ç­‰çš„æœºä¼šè·å–CPUã€‚</li>
<li><strong>äº¤äº’æ€§:</strong> æ¯ä¸ªè¿›ç¨‹ç­‰å¾… (N - 1) * q çš„æ—¶é—´å°±å¯ä»¥é‡æ–°è·å¾—CPU</li>
</ul>
</li>
<li><p>æ—¶é—´ç‰‡<strong>q</strong>çš„å¤§å°</p>
<ul>
<li><p>å¦‚æœqå¤ªå¤§</p>
<p>åˆ™ä¼šå¯¼è‡´äº¤äº’æ€§å˜å·®ï¼Œæ¯ä¸ªè¿›ç¨‹ç­‰å¾…çš„æ—¶é—´å˜é•¿ï¼Œç”šè‡³é€€åŒ–æˆ<strong>FCFS</strong>ç®—æ³•</p>
</li>
<li><p>å¦‚æœ<strong>q</strong>å¤ªå°</p>
<p>åˆ™è¿›ç¨‹åˆ‡æ¢é¢‘ç¹ï¼Œç³»ç»Ÿå¼€é”€å¢åŠ </p>
</li>
</ul>
</li>
<li><p><strong>ä¸¤ç§æ”¹è¿›æ–¹æ³•</strong></p>
<ul>
<li><strong>æ—¶é—´ç‰‡çš„å¤§å°å¯ä»¥æ”¹å˜</strong></li>
<li><strong>ç»„ç»‡å¤šä¸ªå°±ç»ªé˜Ÿåˆ—</strong></li>
</ul>
</li>
</ul>
<h4 id="Linuxè¿›ç¨‹è°ƒåº¦"><a href="#Linuxè¿›ç¨‹è°ƒåº¦" class="headerlink" title="Linuxè¿›ç¨‹è°ƒåº¦"></a>Linuxè¿›ç¨‹è°ƒåº¦</h4><ul>
<li><strong>æ™®é€šè¿›ç¨‹</strong><ul>
<li>é‡‡ç”¨<strong>åŠ¨æ€ä¼˜å…ˆçº§</strong>è°ƒåº¦</li>
<li>è°ƒåº¦ç¨‹åºå‘¨æœŸæ€§çš„ä¿®æ”¹ä¼˜å…ˆçº§(<strong>é¿å…é¥¥é¥¿</strong>)</li>
</ul>
</li>
<li><strong>å®æ—¶è¿›ç¨‹</strong><ul>
<li>é‡‡ç”¨<strong>é™æ€ä¼˜å…ˆçº§</strong>è°ƒåº¦</li>
<li>ç”±ç”¨æˆ·é¢„å…ˆæŒ‡å®šï¼Œä»¥åä¸ä¼šæ”¹å˜</li>
</ul>
</li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/05/28/process/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="liupf">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="liupf's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/05/28/process/" itemprop="url">process</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2019-05-28T15:01:11+08:00">
                2019-05-28
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">åˆ†ç±»äº</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/æ“ä½œç³»ç»Ÿ/" itemprop="url" rel="index">
                    <span itemprop="name">æ“ä½œç³»ç»Ÿ</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="è¿›ç¨‹æ¦‚å¿µ"><a href="#è¿›ç¨‹æ¦‚å¿µ" class="headerlink" title="è¿›ç¨‹æ¦‚å¿µ"></a>è¿›ç¨‹æ¦‚å¿µ</h3><h4 id="è¿›ç¨‹çš„åŸºæœ¬æ¦‚å¿µ"><a href="#è¿›ç¨‹çš„åŸºæœ¬æ¦‚å¿µ" class="headerlink" title="è¿›ç¨‹çš„åŸºæœ¬æ¦‚å¿µ"></a>è¿›ç¨‹çš„åŸºæœ¬æ¦‚å¿µ</h4><ul>
<li><p>è¿›ç¨‹æ˜¯ç¨‹åºåœ¨æŸä¸ª<strong>æ•°æ®é›†åˆ</strong>ä¸Šçš„<strong>ä¸€æ¬¡</strong>è¿è¡Œæ´»åŠ¨ã€‚</p>
<p>æ³¨æ„: â€œä¸€æ¬¡â€çš„æ„æ€å°±æ˜¯ç¨‹åºè¿è¡Œå¤šæ¬¡é‚£ä¹ˆå°±æœ‰å¤šä¸ªè¿›ç¨‹</p>
</li>
<li><p>æ•°æ®é›†åˆ: è½¯/ç¡¬ä»¶ç¯å¢ƒ,å¤šä¸ªè¿›ç¨‹å…±å­˜/å…±äº«çš„ç¯å¢ƒ </p>
</li>
</ul>
<h4 id="è¿›ç¨‹çš„ç‰¹å¾"><a href="#è¿›ç¨‹çš„ç‰¹å¾" class="headerlink" title="è¿›ç¨‹çš„ç‰¹å¾"></a>è¿›ç¨‹çš„ç‰¹å¾</h4><ul>
<li><p><strong>åŠ¨æ€æ€§</strong></p>
<p>è¿›ç¨‹æ˜¯ç¨‹åºçš„ä¸€æ¬¡æ‰§è¡Œè¿‡ç¨‹ï¼ŒåŠ¨æ€çš„äº§ç”Ÿ/æ¶ˆäº¡</p>
</li>
<li><p><strong>å¹¶å‘æ€§</strong></p>
<p>æŸä¸€ä¸ªè¿›ç¨‹åŒå…¶ä»–çš„è¿›ç¨‹å…±åŒå‘å‰æ¨è¿›</p>
</li>
<li><p><strong>å¼‚æ­¥æ€§</strong></p>
<p>æŸä¸€è¿›ç¨‹æŒ‰ç…§è‡ªèº«çš„é€Ÿåº¦å‘å‰æ¨è¿›</p>
</li>
<li><p><strong>ç‹¬ç«‹æ€§</strong></p>
<p>è¿›ç¨‹æ˜¯ç³»ç»Ÿåˆ†é…èµ„æºçš„åŸºæœ¬å•ä½(cpuè°ƒåº¦çš„åŸºæœ¬å•ä½æ˜¯çº¿ç¨‹)</p>
</li>
</ul>
<h4 id="è¿›ç¨‹åŒæ­¥æœºåˆ¶"><a href="#è¿›ç¨‹åŒæ­¥æœºåˆ¶" class="headerlink" title="è¿›ç¨‹åŒæ­¥æœºåˆ¶"></a>è¿›ç¨‹åŒæ­¥æœºåˆ¶</h4><h4 id="ä¿¡å·ç¯æœºåˆ¶"><a href="#ä¿¡å·ç¯æœºåˆ¶" class="headerlink" title="ä¿¡å·ç¯æœºåˆ¶"></a>ä¿¡å·ç¯æœºåˆ¶</h4><h5 id="åŸºæœ¬æ¦‚å¿µ"><a href="#åŸºæœ¬æ¦‚å¿µ" class="headerlink" title="åŸºæœ¬æ¦‚å¿µ"></a>åŸºæœ¬æ¦‚å¿µ</h5><p>è¿›ç¨‹åœ¨è¿è¡Œè¿‡ç¨‹ä¸­<strong>å—ä¿¡å·ç¯çŠ¶æ€æ§åˆ¶</strong>ï¼Œå¹¶èƒ½<strong>æ”¹å˜ä¿¡å·ç¯çŠ¶æ€</strong></p>
<ul>
<li><p><strong>è¿›ç¨‹å—æ§åˆ¶:</strong></p>
<p>ä¿¡å·ç¯çš„çŠ¶æ€å¯ä»¥é˜»å¡æˆ–è€…å”¤é†’è¿›ç¨‹</p>
</li>
<li><p><strong>æ”¹å˜ä¿¡å·ç¯:</strong></p>
<p>ä¿¡å·ç¯çš„çŠ¶æ€å¯ä»¥è¢«è¿›ç¨‹æ”¹å˜</p>
</li>
</ul>
<h5 id="ä¿¡å·ç¯çš„æ•°æ®ç»“æ„"><a href="#ä¿¡å·ç¯çš„æ•°æ®ç»“æ„" class="headerlink" title="ä¿¡å·ç¯çš„æ•°æ®ç»“æ„"></a>ä¿¡å·ç¯çš„æ•°æ®ç»“æ„</h5><p>ä¿¡å·ç¯å®šä¹‰ä¸ºä¸€ä¸ª<strong>äºŒå…ƒçŸ¢é‡(S,q)</strong></p>
<ul>
<li><strong>S: æ•´æ•°ï¼Œåˆå€¼éè´Ÿ(Såˆç§°ä¿¡å·é‡)</strong></li>
<li><strong>q: PCBé˜Ÿåˆ—ï¼Œåˆå€¼ä¸ºç©ºé›†</strong></li>
</ul>
<p>å¦‚ç”¨Cè¯­è¨€æ¥æè¿°ä¿¡å·ç¯çš„æ•°æ®ç»“æ„ä¸º:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">strut SEMAPHORE</span><br><span class="line">&#123;</span><br><span class="line">	<span class="comment">//æ•´æ•°ï¼Œåˆå§‹å€¼éè´Ÿ</span></span><br><span class="line">	<span class="keyword">int</span> S; </span><br><span class="line">	<span class="comment">//é˜Ÿåˆ—: è¿›ç¨‹PCBæŒ‡é’ˆ,åˆå§‹ç©ºé›†</span></span><br><span class="line">	pointer_PCB q;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="ä¿¡å·ç¯çš„æ“ä½œ"><a href="#ä¿¡å·ç¯çš„æ“ä½œ" class="headerlink" title="ä¿¡å·ç¯çš„æ“ä½œ"></a>ä¿¡å·ç¯çš„æ“ä½œ</h5><ul>
<li><strong>Pæ“ä½œ</strong> (å‡½æ•°æˆ–è€…è¿‡ç¨‹, P(S, q))</li>
<li><p><strong>Væ“ä½œ</strong>(å‡½æ•°æˆ–è¿‡ç¨‹, V(S, q))</p>
<p><strong>Pã€Væ˜¯è·å…°è¯­: Passeren(P: é€šè¿‡), Vrijgeven(V: é‡Šæ”¾)</strong></p>
</li>
</ul>
<p>ä¸‹é¢è§£é‡ŠPã€Vçš„å…·ä½“æ„ä¹‰ã€‚</p>
<h5 id="Pæ“ä½œçš„åŸç†-P-S-q-æˆ–è€…P-S"><a href="#Pæ“ä½œçš„åŸç†-P-S-q-æˆ–è€…P-S" class="headerlink" title="Pæ“ä½œçš„åŸç†(P(S, q)æˆ–è€…P(S))"></a>Pæ“ä½œçš„åŸç†(P(S, q)æˆ–è€…P(S))</h5><p>åˆ†ä¸‰æ­¥:</p>
<ol>
<li><strong>Så€¼å‡1</strong></li>
<li><strong>è‹¥å·®å€¼å¤§äºæˆ–ç­‰äº0,åˆ™è¯¥è¿›ç¨‹ç»§ç»­</strong></li>
<li><strong>è‹¥å·®å€¼å°äºé›¶,åˆ™è¯¥è¿›ç¨‹é˜»å¡å¹¶åŠ å…¥åˆ°é˜Ÿåˆ—qä¸­,å¹¶è½¬è°ƒåº¦å‡½æ•°</strong></li>
</ol>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">P(S, q)</span><br><span class="line">&#123;</span><br><span class="line">	S = S - <span class="number">1</span>;</span><br><span class="line">	<span class="keyword">if</span> (S &lt; <span class="number">0</span>) </span><br><span class="line">	&#123;</span><br><span class="line">    <span class="comment">//Caller è¡¨ç¤ºå½“å‰çš„è¿›ç¨‹ è¿™ä¸€æ­¥æŠŠå½“å‰çš„è¿›ç¨‹åŠ å…¥åˆ°é˜Ÿåˆ—q</span></span><br><span class="line">		Insert(Caller, q);</span><br><span class="line">    <span class="comment">//æŠŠå½“å‰è¿›ç¨‹é˜»å¡</span></span><br><span class="line">		Block(Caller);</span><br><span class="line">		è½¬è°ƒåº¦å‡½æ•°();</span><br><span class="line">	&#125;</span><br><span class="line">  <span class="comment">//å¦‚æœSå¤§äºç­‰äº0 é‚£ä¹ˆå½“å‰å‡½æ•°ç»§ç»­</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>é€šè¿‡ä»¥ä¸Šä»£ç å¾—å‡º:<strong>å¦‚æœä¸€ä¸ªè¿›ç¨‹è°ƒç”¨Pæ“ä½œå¯èƒ½ä¼šä½¿è‡ªå·±åœ¨è°ƒç”¨å¤„é˜»å¡ã€‚</strong></p>
<h5 id="Væ“ä½œçš„åŸç†-V-S-q-æˆ–è€…V-S"><a href="#Væ“ä½œçš„åŸç†-V-S-q-æˆ–è€…V-S" class="headerlink" title="Væ“ä½œçš„åŸç†(V(S, q)æˆ–è€…V(S))"></a>Væ“ä½œçš„åŸç†(V(S, q)æˆ–è€…V(S))</h5><p>åˆ†ä¸‰æ­¥:</p>
<ol>
<li><strong>Så€¼åŠ 1</strong></li>
<li><strong>å¦‚æœå½“å‰å’Œå¤§äº0,è¯¥è¿›ç¨‹ç»§ç»­</strong></li>
<li><strong>å¦‚æœå½“å‰å’Œå°äºæˆ–ç­‰äº0,è¯¥è¿›ç¨‹ç»§ç»­çš„åŒæ—¶ä»é˜Ÿåˆ—qä¸­å”¤é†’ä¸€ä¸ªè¿›ç¨‹</strong></li>
</ol>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">V(S, q)</span><br><span class="line">&#123;</span><br><span class="line">	S = S + <span class="number">1</span>;</span><br><span class="line">	<span class="keyword">if</span> (S &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">		Remove(q, pid);</span><br><span class="line">		Wakeup(pid);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="åˆ©ç”¨P-Væ“ä½œè§£å†³äº’æ–¥é—®é¢˜"><a href="#åˆ©ç”¨P-Væ“ä½œè§£å†³äº’æ–¥é—®é¢˜" class="headerlink" title="åˆ©ç”¨P-Væ“ä½œè§£å†³äº’æ–¥é—®é¢˜"></a>åˆ©ç”¨P-Væ“ä½œè§£å†³äº’æ–¥é—®é¢˜</h5><ul>
<li><p>å®è´¨ä¸Šæ˜¯å¯¹ä¸´ç•ŒåŒºçš„äº’æ–¥è®¿é—®</p>
<p>å…è®¸æœ€å¤šä¸€ä¸ªè¿›ç¨‹å¤„äºä¸´ç•ŒåŒº</p>
</li>
<li><p>åº”ç”¨è¿‡ç¨‹</p>
<ul>
<li><strong>è¿›å…¥ä¸´ç•ŒåŒºä¹‹å‰å…ˆæ‰§è¡ŒPæ“ä½œ</strong>(å¯èƒ½é˜»å¡å½“å‰è¿›ç¨‹)</li>
<li><strong>æ¨å‡ºä¸´ç•ŒåŒºä¹‹åå†è¿›è¡ŒVæ“ä½œ</strong>(å¯èƒ½å”¤é†’æŸä¸ªè¿›ç¨‹)</li>
</ul>
</li>
</ul>
<h5 id="åˆ©ç”¨P-Væ“ä½œè§£å†³åŒæ­¥é—®é¢˜"><a href="#åˆ©ç”¨P-Væ“ä½œè§£å†³åŒæ­¥é—®é¢˜" class="headerlink" title="åˆ©ç”¨P-Væ“ä½œè§£å†³åŒæ­¥é—®é¢˜"></a>åˆ©ç”¨P-Væ“ä½œè§£å†³åŒæ­¥é—®é¢˜</h5><ul>
<li><p><strong>åŒæ­¥æœºåˆ¶çš„å®è´¨</strong></p>
<ul>
<li>è¿è¡Œæ¡ä»¶ä¸æ»¡è¶³çš„æ—¶å€™ï¼Œèƒ½è®©è¿›ç¨‹æš‚åœ</li>
<li>è¿è¡Œæ¡ä»¶æ»¡è¶³çš„æ—¶ï¼Œèƒ½è®©ç¨‹åºç«‹å³ç»§ç»­è¿è¡Œ</li>
</ul>
</li>
<li><p><strong>P-Væ“ä½œåº”ç”¨äºè¿›ç¨‹åŒæ­¥çš„åŸºæœ¬æ€è·¯</strong></p>
<ul>
<li><p>æš‚åœå½“å‰è¿›ç¨‹: åœ¨å…³é”®æ“ä½œä¹‹å‰æ‰§è¡Œ <strong>P</strong> æ“ä½œ</p>
<p>å¿…è¦æ—¶å¯æš‚åœ</p>
</li>
<li><p>ç»§ç»­è¿›ç¨‹: åœ¨å…³é”®æ“ä½œä¹‹åæ‰§è¡Œ <strong>V</strong> æ“ä½œ</p>
<p>å¿…è¦æ—¶å”¤é†’ <strong>åˆä½œè¿›ç¨‹</strong></p>
</li>
<li><p>å®šä¹‰æœ‰æ„ä¹‰çš„ä¿¡å·é‡</p>
<p>ä¿¡å·é‡èƒ½æ˜ç¡®è¡¨ç¤º â€œè¿è¡Œæ¡ä»¶â€</p>
</li>
</ul>
</li>
<li><p><strong>å®ç°è¿›ç¨‹åŒæ­¥çš„ä¾‹å­</strong> (å…¬äº¤è½¦å¸æœºvså”®ç¥¨å‘˜)</p>
<ul>
<li><strong>å¸æœº(è¿›ç¨‹)è¿è¡Œè¿‡ç¨‹</strong><ul>
<li>èµ·æ­¥</li>
<li>è¡Œé©¶</li>
<li>åœè½¦</li>
</ul>
</li>
<li><strong>å”®ç¥¨å‘˜è¿è¡Œè¿‡ç¨‹</strong><ul>
<li>å…³é—¨</li>
<li>å”®ç¥¨</li>
<li>å¼€é—¨</li>
</ul>
</li>
<li><strong>åŒæ­¥è¦æ±‚</strong><ol>
<li>åªæœ‰ <strong>å”®ç¥¨å‘˜</strong> <strong>å…³é—¨</strong> å <strong>å¸æœº</strong> æ‰èƒ½ <strong>èµ·æ­¥</strong></li>
<li>åªæœ‰ <strong>å¸æœº</strong> <strong>åœè½¦</strong> å <strong>å”®ç¥¨å‘˜</strong> æ‰èƒ½ <strong>å¼€é—¨</strong></li>
</ol>
</li>
</ul>
</li>
<li><p>ä¼ªä»£ç </p>
<p>å¯¹å¦ä¸€ä¸ªè¿›ç¨‹æœ‰å½±å“çš„æ“ä½œç§°ä¸º <strong>å…³é”®æ“ä½œ</strong>,  ä¿¡å·é‡å°±å®šä¹‰åœ¨å…³é”®æ“ä½œä¸Š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//ä¿¡å·é‡1 é—¨æ˜¯å¦å…³å¥½ 0:æ²¡æœ‰		1:å…³å¥½</span></span><br><span class="line"><span class="keyword">int</span> S1 = <span class="number">0</span>;</span><br><span class="line"><span class="comment">//ä¿¡å·é‡2 è½¦æ˜¯å¦æŒºç¨³ 0:æ²¡æœ‰		1:åœç¨³</span></span><br><span class="line"><span class="keyword">int</span> S2 = <span class="number">0</span>;</span><br><span class="line">driver process:</span><br><span class="line"><span class="keyword">while</span> (<span class="literal">true</span>)</span><br><span class="line">&#123;</span><br><span class="line">  P(S1);</span><br><span class="line">	èµ·æ­¥;</span><br><span class="line">	è¡Œé©¶;</span><br><span class="line">	åœè½¦;</span><br><span class="line">  V(S2);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">conductor process:</span><br><span class="line"><span class="keyword">while</span> (<span class="literal">true</span>)</span><br><span class="line">&#123;</span><br><span class="line">  å…³é—¨;</span><br><span class="line">  V(S1);</span><br><span class="line">  å”®ç¥¨;</span><br><span class="line">  P(S2);</span><br><span class="line">  å¼€é—¨;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/05/20/CPUçš„æ€å’Œä¸­æ–­æœºåˆ¶/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="liupf">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="liupf's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/05/20/CPUçš„æ€å’Œä¸­æ–­æœºåˆ¶/" itemprop="url">CPUçš„æ€å’Œä¸­æ–­æœºåˆ¶</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2019-05-20T13:35:17+08:00">
                2019-05-20
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">åˆ†ç±»äº</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/æ“ä½œç³»ç»Ÿ/" itemprop="url" rel="index">
                    <span itemprop="name">æ“ä½œç³»ç»Ÿ</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="CPUçš„æ€"><a href="#CPUçš„æ€" class="headerlink" title="CPUçš„æ€"></a>CPUçš„æ€</h3><h4 id="æ”¯æŒæ“ä½œç³»ç»Ÿçš„æœ€åŸºæœ¬çš„ç¡¬ä»¶ç»“æ„"><a href="#æ”¯æŒæ“ä½œç³»ç»Ÿçš„æœ€åŸºæœ¬çš„ç¡¬ä»¶ç»“æ„" class="headerlink" title="æ”¯æŒæ“ä½œç³»ç»Ÿçš„æœ€åŸºæœ¬çš„ç¡¬ä»¶ç»“æ„"></a>æ”¯æŒæ“ä½œç³»ç»Ÿçš„æœ€åŸºæœ¬çš„ç¡¬ä»¶ç»“æ„</h4><ul>
<li><strong>CPU</strong></li>
<li><strong>å†…å­˜</strong></li>
<li><strong>ä¸­æ–­</strong></li>
<li><strong>æ—¶é’Ÿ</strong></li>
</ul>
<h4 id="CPUçš„æ€-Model"><a href="#CPUçš„æ€-Model" class="headerlink" title="CPUçš„æ€(Model)"></a>CPUçš„æ€(Model)</h4><ul>
<li><p>CPUçš„å·¥ä½œçŠ¶æ€</p>
</li>
<li><p>å¯¹èµ„æºå’ŒæŒ‡ä»¤ä½¿ç”¨æƒé™çš„æè¿°</p>
<p>ç‰¹æƒæŒ‡ä»¤:</p>
<ul>
<li>LGDT/LIDT: è£…è½½ç‰¹æ®Šå¯„å­˜å™¨</li>
<li>CLTS: æ¸…é™¤ä»»åŠ¡å¼€å…³æ ‡å¿—</li>
<li><strong>STI/CTI: å…è®¸å’Œç¦æ­¢ä¸­æ–­</strong></li>
<li>HALT: åœæ­¢CPUçš„å·¥ä½œ</li>
<li>IN/OUT: æ‰§è¡ŒI/Oæ“ä½œ</li>
<li>ä»æ ¸æ€è½¬ä¸ºç”¨æˆ·æ€</li>
</ul>
</li>
</ul>
<h4 id="æ€çš„åˆ†ç±»"><a href="#æ€çš„åˆ†ç±»" class="headerlink" title="æ€çš„åˆ†ç±»"></a>æ€çš„åˆ†ç±»</h4><ul>
<li><p><strong>æ ¸æ€(Kernel mode)</strong></p>
<ul>
<li>èƒ½å¤Ÿè®¿é—®æ‰€æœ‰çš„èµ„æºå’Œæ‰§è¡Œæ‰€æœ‰çš„æŒ‡ä»¤</li>
<li>ç®¡ç†ç¨‹åºå†…æ ¸</li>
</ul>
</li>
<li><p><strong>ç”¨æˆ·æ€(User mode, ç›®æ€)</strong></p>
<ul>
<li>ä»…èƒ½è®¿é—®éƒ¨åˆ†èµ„æºï¼Œ å…¶ä»–èµ„æºå—é™</li>
<li>ä»…èƒ½ç®¡ç†ç”¨æˆ·ç¨‹åº</li>
</ul>
</li>
<li><p><strong>ç®¡æ€(Supervisor mode)</strong></p>
<p>ä»‹äº<strong>æ ¸æ€</strong>å’Œ<strong>ç”¨æˆ·æ€</strong>ä¹‹é—´</p>
</li>
</ul>
<h4 id="ç”¨æˆ·æ€ä¸å†…æ ¸æ€ä¹‹é—´çš„è½¬æ¢"><a href="#ç”¨æˆ·æ€ä¸å†…æ ¸æ€ä¹‹é—´çš„è½¬æ¢" class="headerlink" title="ç”¨æˆ·æ€ä¸å†…æ ¸æ€ä¹‹é—´çš„è½¬æ¢"></a>ç”¨æˆ·æ€ä¸å†…æ ¸æ€ä¹‹é—´çš„è½¬æ¢</h4><ul>
<li><p>ç”¨æˆ·æ€å‘å†…æ ¸æ€è½¬æ¢</p>
<ul>
<li>ç”¨æˆ·è¯·æ±‚OSæœåŠ¡</li>
<li>å‘ç”Ÿä¸­æ–­(åœ¨å†…æ ¸æ€æ‰§è¡Œ)</li>
<li>ç”¨æˆ·è¿›ç¨‹é”™è¯¯(å†…éƒ¨ä¸­æ–­)</li>
<li>ç”¨æˆ·æ€ä¼å›¾æ‰§è¡Œç‰¹æƒå‘½ä»¤</li>
</ul>
</li>
<li><p>æ ¸æ€å‘ç”¨æˆ·æ€è½¬æ¢</p>
<p>ä¸€èˆ¬æ˜¯<strong>å†…æ ¸æ€æ‰§è¡Œå®Œä¸­æ–­æŒ‡ä»¤</strong>åè¿”å›</p>
</li>
</ul>
<h4 id="CPUè¯»å–æŒ‡ä»¤æˆ–æ•°æ®æ—¶çš„è®¿é—®é¡ºåº"><a href="#CPUè¯»å–æŒ‡ä»¤æˆ–æ•°æ®æ—¶çš„è®¿é—®é¡ºåº" class="headerlink" title="CPUè¯»å–æŒ‡ä»¤æˆ–æ•°æ®æ—¶çš„è®¿é—®é¡ºåº"></a>CPUè¯»å–æŒ‡ä»¤æˆ–æ•°æ®æ—¶çš„è®¿é—®é¡ºåº</h4><ol>
<li><p><strong>è®¿é—®ç¼“å­˜(å‘½ä¸­, HIT)</strong></p>
</li>
<li><p><strong>è®¿é—®å†…å­˜(æ²¡æœ‰å‘½ä¸­, MISS)</strong></p>
</li>
<li><p><strong>è®¿é—®è¾…å­˜(ç¼ºé¡µ, PAGE_FAULT)</strong></p>
<p><img src="https://blog-1257300108.cos.ap-beijing.myqcloud.com/OS/os1.png" alt></p>
</li>
</ol>
<h3 id="ä¸­æ–­æœºåˆ¶"><a href="#ä¸­æ–­æœºåˆ¶" class="headerlink" title="ä¸­æ–­æœºåˆ¶"></a>ä¸­æ–­æœºåˆ¶</h3><h4 id="ä¸­æ–­å®šä¹‰"><a href="#ä¸­æ–­å®šä¹‰" class="headerlink" title="ä¸­æ–­å®šä¹‰"></a>ä¸­æ–­å®šä¹‰</h4><ul>
<li>æ˜¯æŒ‡CPUå¯¹çªå‘çš„å¤–éƒ¨äº‹ä»¶çš„ååº”è¿‡ç¨‹æˆ–æœºåˆ¶</li>
<li>CPUæ”¶åˆ°<strong>å¤–éƒ¨ä¿¡å·(ä¸­æ–­ä¿¡å·)</strong>åï¼Œåœæ­¢å½“å‰å·¥ä½œï¼Œè½¬åŒºå¤„ç†è¯¥<strong>å¤–éƒ¨äº‹ä»¶</strong>ï¼Œå¤„ç†å®Œæ¯•åå›åˆ°åŸæ¥å·¥ä½œçš„<strong>ä¸­æ–­å¤„(æ–­ç‚¹)</strong>ç»§ç»­å·¥ä½œ</li>
</ul>
<h4 id="ä¸­æ–­çš„æ¦‚å¿µ"><a href="#ä¸­æ–­çš„æ¦‚å¿µ" class="headerlink" title="ä¸­æ–­çš„æ¦‚å¿µ"></a>ä¸­æ–­çš„æ¦‚å¿µ</h4><ul>
<li><p><strong>æ–­ç‚¹</strong></p>
<ul>
<li><p>ç¨‹åºä¸­æ–­çš„åœ°æ–¹ï¼Œ<strong>å°†è¦æ‰§è¡Œçš„ä¸‹ä¸€æ¡æŒ‡ä»¤çš„åœ°å€</strong></p>
</li>
<li><p><strong>CS:IP</strong> </p>
<p>ç¨‹åºè¦æ‰§è¡Œçš„ä¸‹ä¸€æ¡æŒ‡ä»¤çš„åœ°å€å°±æ˜¯æ”¾åœ¨è¿™ä¸¤ä¸ªå¯„å­˜å™¨ä¸­</p>
</li>
</ul>
</li>
<li><p><strong>ä¸Šä¸‹æ–‡</strong></p>
<p>ç¨‹åºæ­£ç¡®è¿è¡Œæ‰€ä¾èµ–çš„ä¿¡æ¯é›†åˆ</p>
<ul>
<li>ç›¸å…³å¯„å­˜å™¨</li>
</ul>
</li>
<li><p><strong>ä¸Šä¸‹æ–‡çš„ä¸¤ä¸ªå¤„ç†è¿‡ç¨‹</strong></p>
<ul>
<li>ä¸Šä¸‹æ–‡çš„ä¿æŠ¤: è¿›å…¥ä¸­æ–­æœåŠ¡ä¹‹å‰ï¼Œ<strong>å…¥æ ˆ</strong></li>
<li>ä¸Šä¸‹æ–‡çš„æ¢å¤: é€€å‡ºä¸­æ–­æœåŠ¡ç¨‹åºä¹‹åï¼Œ<strong>å‡ºæ ˆ</strong></li>
</ul>
</li>
</ul>
<h4 id="ä¸­æ–­å“åº”çš„è¿‡ç¨‹"><a href="#ä¸­æ–­å“åº”çš„è¿‡ç¨‹" class="headerlink" title="ä¸­æ–­å“åº”çš„è¿‡ç¨‹"></a>ä¸­æ–­å“åº”çš„è¿‡ç¨‹</h4><ol>
<li><p>è¯†åˆ«ä¸­æ–­æº</p>
<p>æ˜¯è°äº§ç”Ÿäº†ä¸­æ–­</p>
</li>
<li><p>ä¿æŠ¤æ–­ç‚¹å’Œä¸Šä¸‹æ–‡ä¿¡æ¯</p>
</li>
<li><p>è£…å…¥<strong>ä¸­æ–­æœåŠ¡ç¨‹åº</strong>çš„å…¥å£åœ°å€(<strong>CS:IP</strong>)</p>
</li>
<li><p>è¿›å…¥ä¸­æ–­æœåŠ¡ç¨‹åº</p>
</li>
<li><p>æ¢å¤ç°åœºå’Œæ–­ç‚¹</p>
</li>
<li><p>ä¸­æ–­è¿”å›: <strong>IRET</strong>æŒ‡ä»¤</p>
<p>ä¼šæŠŠæ–­ç‚¹å¼¹å‡ºåˆ°<strong>CS:IPå¯„å­˜å™¨</strong>å†…ï¼Œåªè¦<strong>æ›´æ–°CS:IPçš„åœ°å€ï¼Œå°†CS:IPçš„åœ°å€æ›´æ–°ä¸ºåŸæ¥æ–­ç‚¹çš„åœ°å€</strong>ï¼Œé‚£ä¹ˆåŸæ¥çš„ç¨‹åºå°±å¯ä»¥ç»§ç»­è¿è¡Œã€‚</p>
</li>
</ol>
<h4 id="ä¸­æ–­å“åº”çš„å®è´¨"><a href="#ä¸­æ–­å“åº”çš„å®è´¨" class="headerlink" title="ä¸­æ–­å“åº”çš„å®è´¨"></a>ä¸­æ–­å“åº”çš„å®è´¨</h4><ul>
<li><p><strong>äº¤æ¢æŒ‡ä»¤æ‰§è¡Œåœ°å€</strong></p>
<p><strong>å®é™…ä¸Šå°±æ˜¯CS:IPåœ°å€çš„æ›´æ–°ï¼Œå³å½“å‰ç¨‹åºçš„æ‰§è¡ŒIPä¸ä¸­æ–­ç¨‹åºçš„æ‰§è¡ŒIPçš„äº¤æ¢</strong></p>
</li>
<li><p><strong>äº¤æ¢CPUçš„æ€</strong></p>
<p>ä¸­æ–­æŒ‡ä»¤æ˜¯åœ¨å†…æ ¸æ€æ‰§è¡Œçš„ï¼Œæ‰€ä»¥ä¼šå‘ç”Ÿç”¨æˆ·æ€å’Œå†…æ ¸æ€çš„è½¬æ¢</p>
</li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/05/18/å°è®°Servletç”Ÿå‘½å‘¨æœŸ/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="liupf">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="liupf's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/05/18/å°è®°Servletç”Ÿå‘½å‘¨æœŸ/" itemprop="url">å°è®°Servletç”Ÿå‘½å‘¨æœŸ</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2019-05-18T17:26:15+08:00">
                2019-05-18
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>Servletæ˜¯è¿è¡Œåœ¨æœåŠ¡ç«¯çš„Javaç¨‹åº</p>
<p>ä»–çš„ç”Ÿå‘½å‘¨æœŸä¸»è¦æœ‰ä»¥ä¸‹ä¸‰ä¸ªæ–¹æ³•ç»´æŠ¤</p>
<ul>
<li><strong>init</strong></li>
<li><strong>service()</strong></li>
<li><strong>destroy()</strong></li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestController</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> <span class="keyword">throws</span> ServletException </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"åˆå§‹åŒ–"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">TestController</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"æ„é€ æ–¹æ³•åœ¨è¿™é‡Œè°ƒç”¨"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doGet</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"doGetæ–¹æ³•"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doPost</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"doPostæ–¹æ³•"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">service</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        <span class="comment">//çˆ¶ç±»çš„serviceæ–¹æ³•ä¼šè°ƒç”¨åˆ°å…·ä½“çš„å¤„ç†æ–¹æ³• doGet()æˆ–è€…doPost()ç­‰ç­‰ã€‚ã€‚ã€‚</span></span><br><span class="line">        <span class="keyword">super</span>.service(req, resp);</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">"serviceåœ¨è¿™é‡Œè°ƒç”¨"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">destroy</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.destroy();</span><br><span class="line">        System.out.println(<span class="string">"é”€æ¯äº†"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>é¦–å…ˆ å½“tomcatè¿è¡Œï¼Œå®¢æˆ·é¦–æ¬¡å‘servletå‘é€è¯·æ±‚æ—¶ä¼šè§¦å‘<strong>init()</strong>æ–¹æ³•ï¼Œå½“ç„¶å¾—å…ˆå®ä¾‹åŒ–ç±»ï¼Œè°ƒç”¨æ„é€ æ–¹æ³•ï¼Œä¹‹åå°±ä¼šè°ƒç”¨<strong>service()</strong>æ–¹æ³•</p>
<p>service():</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">service</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        String method = req.getMethod();</span><br><span class="line">        <span class="keyword">long</span> lastModified;</span><br><span class="line">        <span class="keyword">if</span> (method.equals(<span class="string">"GET"</span>)) &#123;</span><br><span class="line">            lastModified = <span class="keyword">this</span>.getLastModified(req);</span><br><span class="line">            <span class="keyword">if</span> (lastModified == -<span class="number">1L</span>) &#123;</span><br><span class="line">              <span class="comment">//è°ƒç”¨å…·ä½“çš„æ–¹æ³•</span></span><br><span class="line">                <span class="keyword">this</span>.doGet(req, resp);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">long</span> ifModifiedSince = req.getDateHeader(<span class="string">"If-Modified-Since"</span>);</span><br><span class="line">                <span class="keyword">if</span> (ifModifiedSince &lt; lastModified) &#123;</span><br><span class="line">                    <span class="keyword">this</span>.maybeSetLastModified(resp, lastModified);</span><br><span class="line">                    <span class="keyword">this</span>.doGet(req, resp);</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    resp.setStatus(<span class="number">304</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (method.equals(<span class="string">"HEAD"</span>)) &#123;</span><br><span class="line">            lastModified = <span class="keyword">this</span>.getLastModified(req);</span><br><span class="line">            <span class="keyword">this</span>.maybeSetLastModified(resp, lastModified);</span><br><span class="line">            <span class="keyword">this</span>.doHead(req, resp);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (method.equals(<span class="string">"POST"</span>)) &#123;</span><br><span class="line">            <span class="keyword">this</span>.doPost(req, resp);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (method.equals(<span class="string">"PUT"</span>)) &#123;</span><br><span class="line">            <span class="keyword">this</span>.doPut(req, resp);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (method.equals(<span class="string">"DELETE"</span>)) &#123;</span><br><span class="line">            <span class="keyword">this</span>.doDelete(req, resp);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (method.equals(<span class="string">"OPTIONS"</span>)) &#123;</span><br><span class="line">            <span class="keyword">this</span>.doOptions(req, resp);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (method.equals(<span class="string">"TRACE"</span>)) &#123;</span><br><span class="line">            <span class="keyword">this</span>.doTrace(req, resp);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            String errMsg = lStrings.getString(<span class="string">"http.method_not_implemented"</span>);</span><br><span class="line">            Object[] errArgs = <span class="keyword">new</span> Object[]&#123;method&#125;;</span><br><span class="line">            errMsg = MessageFormat.format(errMsg, errArgs);</span><br><span class="line">            resp.sendError(<span class="number">501</span>, errMsg);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>ä»–ä¼šæ ¹æ®å…·ä½“ä»æµè§ˆå™¨ä¼ è¿‡æ¥çš„æ–¹æ³•æ¥é€‰æ‹©è°ƒç”¨<strong>doGet()</strong>æˆ–è€…<strong>doPost()</strong>æˆ–è€…å…¶ä»–æ–¹æ³•</p>
<p>å½“webåº”ç”¨è¢«ç»ˆæ­¢ï¼Œæˆ–è€…Servletå®¹å™¨ç»ˆæ­¢è¿è¡Œï¼Œæˆ–è€…Servleté‡æ–°è£…è½½Servletæ–°å®ä¾‹æ—¶ï¼ŒServletå®¹å™¨ä¼šè°ƒç”¨Servletçš„<strong>destroy()</strong>æ–¹æ³•</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/05/12/NIO/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="liupf">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="liupf's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/05/12/NIO/" itemprop="url">NIO</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2019-05-12T16:41:31+08:00">
                2019-05-12
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">åˆ†ç±»äº</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Java-I-O/" itemprop="url" rel="index">
                    <span itemprop="name">Java I/O</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><a href="https://www.ibm.com/developerworks/cn/java/j-lo-javaio/index.html" target="_blank" rel="noopener">å…¥é—¨æ–‡ç« </a></p>
<h4 id="BIOçš„ç¼ºç‚¹"><a href="#BIOçš„ç¼ºç‚¹" class="headerlink" title="BIOçš„ç¼ºç‚¹"></a>BIOçš„ç¼ºç‚¹</h4><p> BIOå°±æ˜¯é˜»å¡I/Oï¼Œåœ¨InputStream(è¯»æ•°æ®)æˆ–è€…OutputStream(å†™æ•°æ®)æ—¶éƒ½æœ‰å¯èƒ½é˜»å¡ã€‚é˜»å¡åå°±ä¼šå¤±å»CPUçš„ä½¿ç”¨æƒï¼Œè¿™ç§ä¸‹ä¸èƒ½æ‰¿å—å¤§è§„æ¨¡çš„è®¿é—®ã€‚åº”å¯¹è¿™ç§é—®é¢˜è§£å†³çš„æ–¹æ³•å¯ä»¥æ˜¯é€šè¿‡çº¿ç¨‹æ± è¿ç”¨å¤šçº¿ç¨‹ï¼Œå½“ä¸€ä¸ªçº¿ç¨‹å‡ºç°é˜»å¡æ—¶å…¶ä»–çº¿ç¨‹è¿˜å¯ä»¥ç»§ç»­å·¥ä½œã€‚ä½†æ˜¯å½“é¢å¯¹ä¸€äº›éœ€è¦å¤§é‡Httpé•¿è¿æ¥çš„æƒ…å†µï¼ŒæœåŠ¡ç«¯éœ€è¦åŒæ—¶ä¿æŒå‡ ç™¾ä¸‡çš„HTTPè¿æ¥ï¼Œå¦‚æ·˜å®çš„â€æ—ºæ—ºé¡¹ç›®â€ï¼Œçº¿ç¨‹æ± ä¸èƒ½åŒæ—¶ä¿æŒå‡ ç™¾ä¸‡çš„çº¿ç¨‹æˆ–è€…æ— æ³•å‡çº§æŸäº›ç”¨æˆ·çš„ä¼˜å…ˆçº§ï¼Œè¿˜æœ‰<strong>å¤šçº¿ç¨‹ç«äº‰åŒä¸€èµ„æºçš„åŒæ­¥é—®é¢˜</strong>ã€‚</p>
<h4 id="NIOçš„å·¥ä½œæœºåˆ¶"><a href="#NIOçš„å·¥ä½œæœºåˆ¶" class="headerlink" title="NIOçš„å·¥ä½œæœºåˆ¶"></a>NIOçš„å·¥ä½œæœºåˆ¶</h4><h5 id="NIOç±»å›¾"><a href="#NIOç±»å›¾" class="headerlink" title="NIOç±»å›¾"></a>NIOç±»å›¾</h5><p><img src="https://blog-1257300108.cos.ap-beijing.myqcloud.com/IO/nio.png" alt></p>
<h5 id="é‡è¦çš„æ ¸å¿ƒæ¦‚å¿µ"><a href="#é‡è¦çš„æ ¸å¿ƒæ¦‚å¿µ" class="headerlink" title="é‡è¦çš„æ ¸å¿ƒæ¦‚å¿µ"></a>é‡è¦çš„æ ¸å¿ƒæ¦‚å¿µ</h5><ul>
<li><strong>Channel:</strong> å¦‚æœæ‹¿Socketé€šä¿¡æ¥åšç±»æ¯”ï¼Œsocketå°±æ˜¯ä¸¤ä¸ªç‚¹ä¹‹é—´çš„äº¤é€šå·¥å…·ï¼Œè€Œchannelæ›´ä¸ºå…·ä½“ï¼Œä»–è¡¨ç¤ºæ›´ä¸ºå…·ä½“çš„äº¤é€šå·¥å…·å¦‚é«˜é“ã€é£æœºç­‰ç­‰ã€‚</li>
<li><strong>Selector:</strong> selectorå¯ä»¥æ¯”ä½œä¸ºä¸€ä¸ªè½¦ç«™çš„è½¦è¾†è¿è¡Œè°ƒåº¦ç³»ç»Ÿï¼Œå®ƒè´Ÿè´£ç›‘æ§æ¯è¾†è½¦çš„è¿è¡ŒçŠ¶æ€ï¼Œæ˜¯å·²ç»å‡ºç«™è¿˜æ˜¯åœ¨è·¯ä¸Šç­‰ç­‰ï¼Œå³ä»–å¯ä»¥<strong>è½®è¯¢</strong>æ¯ä¸ªchannelçš„çŠ¶æ€ã€‚</li>
<li><strong>Buffer:</strong> Bufferç±»æ¯”Streamç±»æ›´ä¸ºå…·ä½“ï¼Œå®ƒå¯ä»¥ç±»æ¯”ä¸ºè½¦ä¸Šçš„è½¦åï¼Œå¦‚æœï¼Œchannelæ˜¯é«˜é“ï¼Œå®ƒå°±è¡¨ç¤ºé«˜é“ä¸Šçš„åº§ä½ï¼Œå¦‚æœchannelè¡¨ç¤ºé£æœºï¼Œé‚£ä¹ˆä»–å°±æ˜¯é£æœºä¸Šçš„åº§ä½ã€‚è€ŒStreamåªæ˜¯æŠ½è±¡çš„è¡¨ç¤ºä¸€ä¸ªåº§ä½ï¼Œåœ¨ä½ ä¸Šè½¦ä¹‹å‰ä½ å¹¶ä¸çŸ¥é“è¿™ä¸ªè½¦ä¸Šè¿˜æœ‰æ²¡æœ‰åº§ä½äº†ï¼Œä¹Ÿä¸çŸ¥é“ä¸Šçš„æ˜¯ä»€ä¹ˆè½¦ã€‚è¿™äº›ä¿¡æ¯éƒ½è¢«å°è£…åœ¨Socketä¸­ã€‚</li>
</ul>
<p>NIOå¼•å…¥äº†ä»¥ä¸Šçš„æ¦‚å¿µï¼Œå°±æ˜¯æƒ³è®©è¿™äº›ä¿¡æ¯å…·ä½“åŒ–ï¼Œè®©æˆ‘ä»¬æœ‰æœºä¼šå»æ§åˆ¶ä»–ä»¬ï¼Œå¦‚: å½“æˆ‘ä»¬è°ƒç”¨write()å¾€SendQå†™æ•°æ®æ—¶ï¼Œå½“ä¸€æ¬¡å†™çš„æ•°æ®è¶…è¿‡SendQé•¿åº¦ï¼Œåˆ™éœ€è¦æŒ‰ç…§SendQé•¿åº¦è¿›è¡Œåˆ‡å‰²ï¼Œè¿™ä¸ªè¿‡ç¨‹éœ€è¦è¿›è¡Œç”¨æˆ·æ€å’Œå†…æ ¸æ€çš„åˆ‡æ¢ï¼Œè€Œè¿™ä¸ªåˆ‡æ¢æˆ‘ä»¬ä¸å¯ä»¥æ§åˆ¶ã€‚è€Œåœ¨Bufferä¸­æˆ‘ä»¬å¯ä»¥æ§åˆ¶Bufferçš„capacityï¼Œå¹¶ä¸”æ˜¯å¦æ‰©å®¹ä»¥åŠå¦‚ä½•æ‰©å®¹éƒ½å¯ä»¥æ§åˆ¶ã€‚</p>
<h5 id="NIOå·¥ä½œä»£ç ç¤ºä¾‹"><a href="#NIOå·¥ä½œä»£ç ç¤ºä¾‹" class="headerlink" title="NIOå·¥ä½œä»£ç ç¤ºä¾‹"></a>NIOå·¥ä½œä»£ç ç¤ºä¾‹</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">selector</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        ByteBuffer buffer = ByteBuffer.allocate(<span class="number">1024</span>);</span><br><span class="line">  			<span class="comment">//é€šè¿‡è°ƒç”¨Selectorçš„é™æ€å·¥å‚åˆ›å»ºä¸€ä¸ªé€‰æ‹©å™¨</span></span><br><span class="line">        Selector selector = Selector.open();</span><br><span class="line">  			<span class="comment">//åˆ›å»ºä¸€ä¸ªæœåŠ¡ç«¯çš„Channel</span></span><br><span class="line">        ServerSocketChannel ssc = ServerSocketChannel.open();</span><br><span class="line">  			<span class="comment">//è®¾ç½®ä¸ºéé˜»å¡æ–¹å¼</span></span><br><span class="line">        ssc.configureBlocking(<span class="keyword">false</span>);</span><br><span class="line">  			<span class="comment">//æŠŠchannelç»‘å®šåˆ°ä¸€ä¸ªSocketå¯¹è±¡ä¸Šï¼Œ</span></span><br><span class="line">        ssc.socket().bind(<span class="keyword">new</span> InetSocketAddress(<span class="number">8080</span>));</span><br><span class="line">  			<span class="comment">//æ³¨å†Œç›‘å¬çš„äº‹ä»¶</span></span><br><span class="line">        ssc.register(selector, SelectionKey.OP_ACCEPT);</span><br><span class="line">        <span class="keyword">while</span> (<span class="keyword">true</span>) &#123;</span><br><span class="line">          	<span class="comment">//å–å¾—æ‰€æœ‰keyé›†åˆ è½®è¯¢çš„æ¥æ£€æŸ¥å·²ç»æ³¨å†Œåœ¨è¿™ä¸ªé€‰æ‹©å™¨ä¸Šçš„æ‰€æœ‰é€šä¿¡ä¿¡é“æ˜¯å¦æœ‰éœ€è¦çš„äº‹ä»¶å‘ç”Ÿï¼Œå¦‚æœæŸä¸ªäº‹ä»¶å‘ç”Ÿæ—¶ å°†ä¼šè¿”å›æ‰€æœ‰çš„SelectionKeyï¼Œé€šè¿‡è¿™ä¸ªå¯¹è±¡çš„channelæ–¹æ³•å°±å¯ä»¥è·å¾—è¿™ä¸ªé€šä¿¡ä¿¡é“å¯¹è±¡ä»è€Œå¯ä»¥è¯»å–é€šä¿¡çš„æ•°æ®ï¼Œè¿™é‡Œè¯»å–çš„æ•°æ®æ˜¯  Buffer  ï¼Œè¿™ä¸ªBufferæ˜¯æˆ‘ä»¬å¯ä»¥æ§åˆ¶çš„ç¼“å†²å™¨</span></span><br><span class="line">            Set selectedKeys = selector.selectedKeys();</span><br><span class="line">            Iterator it = selectedKeys.iterator();</span><br><span class="line">            <span class="keyword">while</span> (it.hasNext()) &#123;</span><br><span class="line">                SelectionKey key = (SelectionKey) it.next();</span><br><span class="line">                <span class="keyword">if</span> ((key.readyOps() &amp; SelectionKey.OP_ACCEPT) == SelectionKey.OP_ACCEPT) &#123;</span><br><span class="line">                    ServerSocketChannel ssChannel = (ServerSocketChannel) key.channel();</span><br><span class="line">                  	<span class="comment">//æ¥å—åˆ°æœåŠ¡ç«¯çš„è¯·æ±‚</span></span><br><span class="line">                		SocketChannel sc = ssChannel.accept();</span><br><span class="line">                    sc.configureBlocking(<span class="keyword">false</span>);</span><br><span class="line">                    sc.register(selector, SelectionKey.OP_READ);</span><br><span class="line">                    it.remove();</span><br><span class="line">                &#125; <span class="keyword">else</span> <span class="keyword">if</span> </span><br><span class="line">                ((key.readyOps() &amp; SelectionKey.OP_READ) == SelectionKey.OP_READ) &#123;</span><br><span class="line">                    SocketChannel sc = (SocketChannel) key.channel();</span><br><span class="line">                    <span class="keyword">while</span> (<span class="keyword">true</span>) &#123;</span><br><span class="line">                        buffer.clear();</span><br><span class="line">                      	<span class="comment">//è¯»å–æ•°æ®</span></span><br><span class="line">                        <span class="keyword">int</span> n = sc.read(buffer);</span><br><span class="line">                        <span class="keyword">if</span> (n &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">                            <span class="keyword">break</span>;</span><br><span class="line">                        &#125;</span><br><span class="line">                        buffer.flip();</span><br><span class="line">                    &#125;</span><br><span class="line">                    it.remove();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä¸Šé¢çš„ä»£ç ç›‘å¬è¯·æ±‚çš„äº‹ä»¶å’Œå¤„ç†è¯·æ±‚çš„äº‹ä»¶æ”¾åœ¨åŒä¸€ä¸ªçº¿ç¨‹ä¸­æ‰§è¡Œï¼Œä½†æ˜¯åœ¨å®é™…çš„åº”ç”¨ä¸­ï¼Œé€šå¸¸æ˜¯æ”¾åœ¨ä¸¤ä¸ªçº¿ç¨‹ä¸­ï¼Œå³ä¸€ä¸ªçº¿ç¨‹è´Ÿè´£ä¸“é—¨çš„ç›‘å¬å®¢æˆ·ç«¯è¿æ¥è¯·æ±‚ è€Œä¸”æ˜¯ä»¥<strong>é˜»å¡æ–¹å¼</strong>è¿›è¡Œ å¦ä¸€ä¸ªçº¿ç¨‹ä¸“é—¨å¤„ç†è¯·æ±‚ï¼Œè¿™ä¸ª<strong>å¤„ç†è¯·æ±‚çš„çº¿ç¨‹æ‰ä¼šçœŸæ­£çš„é‡‡ç”¨NIOçš„æ–¹å¼</strong>ã€‚</p>
<p><strong>åŸºäºNIOçš„Socketè¯·æ±‚å¤„ç†è¿‡ç¨‹</strong></p>
<p><img src="https://blog-1257300108.cos.ap-beijing.myqcloud.com/IO/niowork.png" alt></p>
<p><strong>Selector</strong>ç›‘å¬ä¸€ç»„é€šä¿¡ä¿¡é“ä¸Šçš„I/OçŠ¶æ€ï¼Œå‰ææ˜¯è¿™ä¸ªSelectorè¦å·²ç»æ³¨å†Œåˆ°è¿™äº›é€šä¿¡ä¿¡é“ä¸­ã€‚é€‰æ‹©å™¨Selectorå¯ä»¥è°ƒç”¨select()æ–¹æ³•æ£€æŸ¥å·²ç»æ³¨å†Œçš„é€šä¿¡ä¿¡é“ä¸Šæ˜¯å¦æœ‰I/Oå·²ç»å‡†å¤‡å¥½ï¼Œå¦‚æœæ²¡æœ‰è‡³å°‘ä¸€ä¸ªä¿¡é“I/Oæœ‰å˜åŒ–ï¼Œé‚£ä¹ˆselectæ–¹æ³•ä¼šé˜»å¡ç­‰å¾…æˆ–åœ¨è¶…æ—¶æ—¶é—´åè¿”å›0ã€‚ä¸Šå›¾ä¸­å¦‚æœå¤šä¸ªä¿¡é“æœ‰æ•°æ® é‚£ä¹ˆä¼šå°†è¿™äº›æ•°æ®åˆ†é…åˆ°å¯¹åº”æ•°æ®çš„Bufferä¸­ã€‚æ‰€ä»¥å…³é”®çš„åœ°æ–¹æ˜¯<strong>æœ‰ä¸€ä¸ªçº¿ç¨‹æ¥å¤„ç†æ‰€æœ‰è¿æ¥çš„æ•°æ®äº¤äº’ï¼Œæ¯ä¸ªè¿æ¥æ•°æ®äº¤äº’éƒ½ä¸æ˜¯é˜»å¡æ–¹å¼ï¼Œæ‰€ä»¥å¯ä»¥åŒæ—¶å¤„ç†å¤§é‡çš„è¿æ¥è¯·æ±‚ã€‚</strong></p>
<p><strong>Bufferä¸­çš„å‚æ•°é¡¹</strong></p>
<table>
<thead>
<tr>
<th style="text-align:left"><strong>ç´¢å¼•</strong></th>
<th style="text-align:left"><strong>è¯´æ˜</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">capacity</td>
<td style="text-align:left">ç¼“å†²åŒºæ•°ç»„çš„æ€»é•¿åº¦</td>
</tr>
<tr>
<td style="text-align:left">position</td>
<td style="text-align:left">ä¸‹ä¸€ä¸ªè¦æ“ä½œçš„æ•°æ®å…ƒç´ çš„ä½ç½®</td>
</tr>
<tr>
<td style="text-align:left">limit</td>
<td style="text-align:left">ç¼“å†²åŒºæ•°ç»„ä¸­ä¸å¯æ“ä½œçš„ä¸‹ä¸€ä¸ªå…ƒç´ çš„ä½ç½®ï¼Œlimit&lt;=capacity</td>
</tr>
<tr>
<td style="text-align:left">mark</td>
<td style="text-align:left">ç”¨äºè®°å½•å½“å‰ position çš„å‰ä¸€ä¸ªä½ç½®æˆ–è€…é»˜è®¤æ˜¯ 0</td>
</tr>
</tbody>
</table>
<p>å®é™…æ“ä½œæ—¶ï¼Œä»¥ä¸Šå‚æ•°æœ‰å¦‚ä¸‹å…³ç³»:</p>
<p><img src="https://blog-1257300108.cos.ap-beijing.myqcloud.com/IO/buffer1.png" alt></p>
<p>é€šè¿‡<strong>ByteBuffer.allocate(11)</strong>æ–¹æ³•åˆ›å»ºä¸€ä¸ª11ä¸ªbyteçš„ç¼“å†²åŒºï¼Œåˆå§‹çŠ¶æ€å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œ<strong>position</strong>çš„ä½ç½®æ˜¯0ï¼Œ<strong>capacity</strong>å’Œ<strong>limit</strong>çš„å¤§å°éƒ½æ˜¯åˆå§‹æ•°ç»„çš„é•¿åº¦ï¼Œå½“å†™å…¥5ä¸ªå­—èŠ‚æ—¶ä½ç½®å˜åŒ–å¦‚ä¸‹:</p>
<p><img src="https://blog-1257300108.cos.ap-beijing.myqcloud.com/IO/buffer2.png" alt></p>
<p>è¿™æ—¶å¦‚æœæˆ‘ä»¬éœ€è¦å°†ç¼“å†²åŒºè¿™5ä¸ªå­—èŠ‚å†™å…¥<strong>channel</strong>é€šä¿¡ä¿¡é“ï¼Œéœ€è¦è°ƒç”¨byteBuffer.filp()æ–¹æ³•ï¼Œæ•°ç»„çš„çŠ¶æ€å‘ç”Ÿå¦‚ä¸‹å˜åŒ–:</p>
<p><img src="https://blog-1257300108.cos.ap-beijing.myqcloud.com/IO/buffer3.png" alt></p>
<p>è¿™æ—¶æ“ä½œç³»ç»Ÿå°±å¯ä»¥å°†è¿™5ä¸ªå­—èŠ‚å†™å‡ºå»ï¼Œå½“ä¸‹ä¸€æ¬¡ä½¿ç”¨ç¼“å†²åŒºçš„æ—¶å€™è°ƒç”¨ä¸€ä¸‹clear()æ–¹æ³•ï¼Œè¿™äº›<strong>æŒ‡é’ˆ</strong>åˆå›åˆ°åˆå§‹çŠ¶æ€ã€‚</p>
<p><strong>mark:</strong> å½“æˆ‘ä»¬ä½¿ç”¨<strong>mark()</strong>æ—¶ï¼Œå®ƒå°†<strong>è®°å½•å½“å‰positionä½ç½®çš„å‰ä¸€ä¸ªä½ç½®ï¼Œå½“è°ƒç”¨resetæ—¶ï¼Œpositionå°†æ¢å¤markè®°å½•ä¸‹çš„å€¼ã€‚</strong></p>
<blockquote>
<p><strong>é€šè¿‡ Channel è·å–çš„ I/O æ•°æ®é¦–å…ˆè¦ç»è¿‡æ“ä½œç³»ç»Ÿçš„ Socket ç¼“å†²åŒºå†å°†æ•°æ®å¤åˆ¶åˆ° Buffer ä¸­ï¼Œè¿™ä¸ªçš„æ“ä½œç³»ç»Ÿç¼“å†²åŒºå°±æ˜¯åº•å±‚çš„ TCP åè®®å…³è”çš„ RecvQ æˆ–è€… SendQ é˜Ÿåˆ—ï¼Œä»æ“ä½œç³»ç»Ÿç¼“å†²åŒºåˆ°ç”¨æˆ·ç¼“å†²åŒºå¤åˆ¶æ•°æ®æ¯”è¾ƒè€—æ€§èƒ½ï¼ŒBuffer æä¾›äº†å¦å¤–ä¸€ç§ç›´æ¥æ“ä½œæ“ä½œç³»ç»Ÿç¼“å†²åŒºçš„çš„æ–¹å¼å³ ByteBuffer.allocateDirector(size)ï¼Œè¿™ä¸ªæ–¹æ³•è¿”å›çš„ byteBuffer å°±æ˜¯ä¸åº•å±‚å­˜å‚¨ç©ºé—´å…³è”çš„ç¼“å†²åŒºï¼Œå®ƒçš„æ“ä½œæ–¹å¼ä¸ linux2.4 å†…æ ¸çš„ sendfile æ“ä½œæ–¹å¼ç±»ä¼¼ã€‚</strong></p>
</blockquote>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/05/06/Java-I-O/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="liupf">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="liupf's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/05/06/Java-I-O/" itemprop="url">Java I/O</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2019-05-06T11:00:39+08:00">
                2019-05-06
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">åˆ†ç±»äº</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Java-I-O/" itemprop="url" rel="index">
                    <span itemprop="name">Java I/O</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="ä¸€ã€UNIXä¸­çš„I-O"><a href="#ä¸€ã€UNIXä¸­çš„I-O" class="headerlink" title="ä¸€ã€UNIXä¸­çš„I/O"></a>ä¸€ã€UNIXä¸­çš„I/O</h3><h4 id="ç®€è¿°"><a href="#ç®€è¿°" class="headerlink" title="ç®€è¿°"></a>ç®€è¿°</h4><p><strong>UNIXç³»ç»Ÿå°†æ‰€æœ‰çš„å¤–éƒ¨è®¾å¤‡éƒ½çœ‹ä½œæ–‡ä»¶</strong>ï¼Œæ‰€æœ‰æ‰“å¼€çš„æ–‡ä»¶éƒ½é€šè¿‡æ–‡ä»¶æè¿°ç¬¦æ¥å¼•ç”¨ã€‚UNIXçš„è¾“å…¥è¾“å‡ºéµå¾ª<strong>Open-Read-Write-Close</strong>è¿™å¥—è§„èŒƒã€‚å½“ä¸€ä¸ªç”¨æˆ·è¿›ç¨‹è¿›è¡ŒI/Oæ“ä½œä¹‹å‰ï¼Œä»–éœ€è¦è°ƒç”¨<strong>(1)</strong>Openæ¥æŒ‡å®šå¹¶è·å–æ“ä½œæ–‡ä»¶æˆ–è®¾å¤‡è¯»å–æˆ–å†™å…¥çš„æƒé™ã€‚ä¸€æ—¦I/Oæ“ä½œå¯¹è±¡è¢«æ‰“å¼€ï¼Œé‚£ä¹ˆè¿™ä¸ªç”¨æˆ·è¿›ç¨‹å°±å¯ä»¥å¯¹è¯¥å¯¹è±¡è¿›è¡Œä¸€æ¬¡æˆ–å¤šæ¬¡çš„è¯»ã€å†™æ“ä½œã€‚<strong>(2)</strong>Readæ“ä½œä»I/Oæ“ä½œè®¾å¤‡è¯»å–æ•°æ®ï¼Œå¹¶å°†æ•°æ®ä¼ é€’ç»™ç”¨æˆ·ã€‚<strong>(2)</strong>Writeæ“ä½œå°†ç”¨æˆ·è¿›ç¨‹ä¸­çš„æ•°æ®ä¼ å†™å…¥åˆ°I/Oæ“ä½œå¯¹è±¡ã€‚å½“æ‰€æœ‰çš„R/Wæ“ä½œç»“æŸåï¼Œç”¨æˆ·è¿›ç¨‹<strong>(3)</strong>è°ƒç”¨Closeæ¥å…³é—­Openæ‰“å¼€çš„æ–‡ä»¶ã€‚è¿™äº›æ“ä½œéƒ½æ˜¯é€šè¿‡<strong>æ–‡ä»¶æè¿°ç¬¦</strong>æ“ä½œã€‚æ–‡ä»¶æè¿°ç¬¦æ˜¯ä¸€ä¸ªéè´Ÿæ•´æ•°ï¼Œå®ƒæŒ‡å‘å†…æ ¸ä¸­çš„ä¸€ä¸ªç»“æ„ä½“ã€‚å½“æ‰“å¼€ä¸€ä¸ªç°æœ‰æ–‡ä»¶æˆ–è€…åˆ›å»ºä¸€ä¸ªæ–°çš„æ–‡ä»¶å¤¹æ—¶ï¼Œå†…æ ¸å‘è¿›ç¨‹è¿”å›ä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦ã€‚socketè¯»å†™çš„æ–‡ä»¶æè¿°ç¬¦ä¸º<strong>socketfd</strong>ã€‚</p>
<h4 id="I-Oæ¨¡å‹çš„åˆ†ç±»"><a href="#I-Oæ¨¡å‹çš„åˆ†ç±»" class="headerlink" title="I/Oæ¨¡å‹çš„åˆ†ç±»"></a>I/Oæ¨¡å‹çš„åˆ†ç±»</h4><p>åœ¨UNIXç³»ç»Ÿä¸­ï¼ŒI/Oæ“ä½œé€šå¸¸åŒ…å«ä»¥ä¸‹ä¸¤ä¸ªä¸åŒçš„é˜¶æ®µ:</p>
<ul>
<li><strong>æ•°æ®å‡†å¤‡</strong></li>
<li><strong>ä»å†…æ ¸å‘è¿›ç¨‹å¤åˆ¶æ•°æ®</strong></li>
</ul>
<p>ä¾‹å¦‚å¯¹äºå¥—æ¥å­—çš„è¾“å…¥ï¼Œç¬¬ä¸€æ­¥æ˜¯ç­‰å¾…æ•°æ®ä»ç½‘ç»œä¸­åˆ°è¾¾ï¼Œå½“æ‰€æœ‰çš„ç­‰å¾…æ•°æ®åˆ°è¾¾æ—¶ï¼Œæ•°æ®è¢«å¤åˆ¶åˆ°å†…æ ¸ä¸­çš„ç¼“å†²åŒºã€‚ç¬¬äºŒæ­¥æŠŠæ•°æ®ä»å†…æ ¸ç¼“å†²åŒºå¤åˆ¶åˆ°åº”ç”¨è¿›ç¨‹çš„ç¼“å†²åŒºã€‚æ ¹æ®åœ¨è¿™ä¸¤ä¸ªä¸åŒé˜¶æ®µå¤„ç†çš„ä¸åŒï¼Œå¯ä»¥å°†I/Oæ¨¡å‹åˆ’åˆ†ä¸ºäº”ç§ç±»å‹:</p>
<ol>
<li><p><strong>é˜»å¡å¼I/Oæ¨¡å‹</strong></p>
<p><img src="https://blog-1257300108.cos.ap-beijing.myqcloud.com/IO/20160609135646100_meitu_1.jpg" alt></p>
<p>åº”ç”¨è¿›ç¨‹è°ƒç”¨recvfromå‡½æ•°ï¼Œç„¶ååˆ‡æ¢åˆ°å†…æ ¸ç©ºé—´ä¸­è¿è¡Œï¼Œç›´åˆ°æ•°æ®åŒ…åˆ°è¾¾ä¸”è¢«å¤åˆ¶åˆ°åº”ç”¨è¿›ç¨‹ç¼“å†²åŒºä¸­æ‰è¿”å›ã€‚<strong>è¿›ç¨‹ä»è°ƒç”¨recvfromå‡½æ•°åˆ°å‡½æ•°è¿”å›çš„æ•´æ®µæ—¶é—´å†…æ˜¯è¢«é˜»å¡çš„ã€‚</strong>recvfromå‡½æ•°æˆåŠŸè¿”å›åï¼Œè¿›ç¨‹æ‰æ¥ç€å¾€ä¸‹æ‰§è¡Œå¤„ç†æ•°æ®ã€‚</p>
</li>
<li><p><strong>éé˜»å¡å¼I/Oæ¨¡å‹</strong></p>
<p>ç­‰å¾…I/Oæ•°æ®çš„<strong>ç¬¬ä¸€é˜¶æ®µ</strong>ï¼Œè¿›ç¨‹å¹¶ä¸é˜»å¡ï¼Œå¦‚æœrecvfromå‡½æ•°æ²¡æœ‰é©¬ä¸Šæ‰§è¡Œå®Œï¼Œåˆ™ç«‹å³è¿”å›ä¸€ä¸ªé”™è¯¯ã€‚</p>
<p><img src="https://blog-1257300108.cos.ap-beijing.myqcloud.com/IO/20160609135720523_meitu_1.jpg" alt></p>
<p>å¦‚æœè°ƒç”¨recvfromå‡½æ•°åå†…æ ¸æ²¡æœ‰ç«‹å³è¿”å›æ•°æ®ï¼Œåˆ™åº”ç”¨è¿›ç¨‹é‡‡ç”¨<strong><em>è½®è¯¢</em></strong>çš„æ–¹å¼ä¸æ–­çš„æ‰§è¡Œå‡½æ•°ã€‚</p>
</li>
<li><p><strong>I/Oå¤ç”¨æ¨¡å‹</strong></p>
<p>select()ã€poll()å‡½æ•°éƒ½ä½¿ç”¨äº†I/Oå¤ç”¨æ¨¡å‹ã€‚</p>
<p><img src="https://blog-1257300108.cos.ap-beijing.myqcloud.com/IO/20160609135743772_meitu_2.jpg" alt></p>
<p>å½“è°ƒç”¨select()å‡½æ•°æ—¶ï¼Œè¿›ç¨‹å°†ä¼šè¢«é˜»å¡ï¼Œç­‰å¾…æ•°æ®æŠ¥å‡†å¤‡å¥½ï¼Œè¿”å›å¯è¯»æç¤ºã€‚å½“ç­‰å¾…çš„å¤šä¸ªå¥—æ¥å­—ä¸­çš„ä¸€ä¸ªæˆ–è€…å¤šä¸ªå˜çš„å¯ç”¨æ—¶ï¼Œè¿›ç¨‹è°ƒç”¨recvfrom()å‡½æ•°ï¼ŒæŠŠæ•°æ®æŠ¥ä»å†…æ ¸ç¼“å†²åŒºå¤åˆ¶åˆ°åº”ç”¨è¿›ç¨‹ç¼“å†²åŒºã€‚è¿™ä¸ªè¿‡ç¨‹ä¸­<strong>ç¬¬ä¸€é˜¶æ®µçš„æ—¶å€™æ˜¯å¯ä»¥æ¥å—å¤šä¸ªè¯·æ±‚çš„ï¼Œå³è°ƒç”¨å¤šæ¬¡select()å‡½æ•°ï¼Œè€Œç¬¬äºŒé˜¶æ®µæ•°æ®å¤åˆ¶åˆ°åº”ç”¨ç¼“å†²åŒºçš„è¿‡ç¨‹æ˜¯é˜»å¡çš„ã€‚</strong>è¿™ç§æ¨¡å‹çš„ä¼˜åŠ¿å°±åœ¨äºåœ¨ç¬¬ä¸€é˜¶æ®µå¯ä»¥<strong>åŒæ—¶</strong>ç­‰å¾…å¤šä¸ªå¥—æ¥å­—æè¿°ç¬¦å°±ç»ªã€‚</p>
</li>
<li><p><strong>ä¿¡å·é©±åŠ¨å¼I/Oæ¨¡å‹</strong></p>
<p><img src="https://blog-1257300108.cos.ap-beijing.myqcloud.com/IO/20160609135826601_meitu_3.jpg" alt></p>
<p>è¿™ç§æ¨¡å‹æ®è¯´åº”ç”¨çš„æ¯”è¾ƒå°‘ã€‚</p>
<blockquote>
<p>ä½¿ç”¨è¿™ç§æ¨¡å‹éœ€è¦å¼€å¯å¥—æ¥å­—çš„ä¿¡å·é©±åŠ¨I/OåŠŸèƒ½ï¼Œå¹¶é€šè¿‡sigactionç³»ç»Ÿè°ƒç”¨å®‰è£…ä¸€ä¸ªä¿¡å·å¤„ç†å‡½æ•°ã€‚sigactionå‡½æ•°ç«‹å³è¿”å›ï¼Œæˆ‘ä»¬çš„è¿›ç¨‹ç»§ç»­å·¥ä½œï¼Œå³è¿›ç¨‹æ²¡æœ‰è¢«é˜»å¡ã€‚å½“æ•°æ®æŠ¥å‡†å¤‡å¥½æ—¶ï¼Œå†…æ ¸ä¼šä¸ºè¯¥è¿›ç¨‹äº§ç”Ÿä¸€ä¸ªSIGIOä¿¡å·ï¼Œè¿™æ ·æˆ‘ä»¬å¯ä»¥åœ¨ä¿¡å·å¤„ç†å‡½æ•°ä¸­è°ƒç”¨recvfromè¯»å–æ•°æ®æŠ¥ï¼Œä¹Ÿå¯ä»¥åœ¨ä¸»å¾ªç¯ä¸­è¯»å–æ•°æ®æŠ¥ã€‚æ— è®ºå¦‚ä½•å¤„ç†SIGIOä¿¡å·ï¼Œè¿™ç§æ¨¡å‹çš„ä¼˜åŠ¿åœ¨äºç­‰å¾…æ•°æ®æŠ¥åˆ°è¾¾æœŸé—´ä¸è¢«é˜»å¡ã€‚</p>
</blockquote>
</li>
<li><p><strong>å¼‚æ­¥I/Oæ¨¡å‹</strong></p>
<p>å¼‚æ­¥I/Oçš„å·¥ä½œæœºåˆ¶æ˜¯è®©æ•´ä¸ªç¬¬ä¸€é˜¶æ®µå’Œç¬¬äºŒé˜¶æ®µçš„æ“ä½œéƒ½äº¤ç»™å†…æ ¸æ¥å®Œæˆï¼Œç­‰æ“ä½œå®Œæˆåå†é€šçŸ¥è¿›ç¨‹ã€‚</p>
<p><img src="https://blog-1257300108.cos.ap-beijing.myqcloud.com/IO/20160609135848507_meitu_4.jpg" alt></p>
<p>ä¸ä¿¡å·é©±åŠ¨å¼I/Oæ¨¡å‹ä¸åŒçš„åœ°æ–¹å°±æ˜¯ï¼Œå¼‚æ­¥I/Oæ¨¡å‹æ•´ä¸ªè¿‡ç¨‹éƒ½æ˜¯äº¤ç»™å†…æ ¸å®Œæˆï¼Œè‡ªå·±åªæ˜¯ç­‰å¾…aio_read()å‡½æ•°å‘é€å®Œæˆä¿¡å·ã€‚ä¿¡å·é©±åŠ¨å¼I/Oæ¨¡å‹åœ¨ç¬¬ä¸€é˜¶æ®µä¼šè¿”å›ä¿¡å·ï¼Œæ ¹æ®ä¿¡å·å†è°ƒç”¨recvfrom()å‡½æ•°ï¼Œç¬¬äºŒé˜¶æ®µæ˜¯é˜»å¡çš„ã€‚</p>
</li>
</ol>
<p>æ³¨: recvfrom()å‡½æ•°æ˜¯UDPå¥—æ¥å­—ä¸­çš„å‡½æ•°ï¼Œç±»ä¼¼äºæ ‡å‡†çš„read()å‡½æ•°ã€‚å®ƒçš„ä½œç”¨æ˜¯ä»æŒ‡å®šçš„å¥—æ¥å­—ä¸­è¯»å–æ•°æ®æŠ¥ï¼Œå®ƒä¼šä»åº”ç”¨è¿›ç¨‹åˆ‡æ¢åˆ°å†…æ ¸ï¼Œå¹¶åœ¨æ‰§è¡Œä¸€æ®µæ—¶é—´åè¿”å›åˆ°åº”ç”¨è¿›ç¨‹ã€‚</p>
<p>æ€»ç»“ï¼šä»¥ä¸Šäº”ç§I/Oæ¨¡å‹ä¸­ï¼Œå‰å››ç§åœ¨ç¬¬äºŒé˜¶æ®µéƒ½ä¼šè°ƒç”¨recvfrom()å‡½æ•°é˜»å¡è¿›ç¨‹ï¼Œåªæœ‰<strong>å¼‚æ­¥I/Oæ¨¡å‹</strong>åœ¨æ•´ä¸ªè¿‡ç¨‹ä¸­éƒ½æ˜¯äº¤ç»™å†…æ ¸å®Œæˆï¼Œæ²¡æœ‰é˜»å¡ã€‚</p>
<h4 id="åŒæ­¥I-Oå’Œå¼‚æ­¥I-Oçš„åŒºåˆ«"><a href="#åŒæ­¥I-Oå’Œå¼‚æ­¥I-Oçš„åŒºåˆ«" class="headerlink" title="åŒæ­¥I/Oå’Œå¼‚æ­¥I/Oçš„åŒºåˆ«"></a>åŒæ­¥I/Oå’Œå¼‚æ­¥I/Oçš„åŒºåˆ«</h4><ul>
<li>åŒæ­¥I/Oï¼šå¯¼è‡´è¯·æ±‚è¿›ç¨‹é˜»å¡ç›´åˆ°I/Oæ“ä½œå®Œæˆ</li>
<li>å¼‚æ­¥I/Oï¼šä¸å¯¼è‡´è¯·æ±‚è¿›ç¨‹é˜»å¡</li>
</ul>
<h3 id="è£…é¥°å™¨æ¨¡å¼ä¸Java-I-O"><a href="#è£…é¥°å™¨æ¨¡å¼ä¸Java-I-O" class="headerlink" title="è£…é¥°å™¨æ¨¡å¼ä¸Java I/O"></a>è£…é¥°å™¨æ¨¡å¼ä¸Java I/O</h3><p>è£…é¥°å™¨æ¨¡å¼çš„åšç”¨å°±æ˜¯åœ¨ä¸ä¿®æ”¹åŸæœ‰æ¥å£çš„æƒ…å†µä¸‹ç»™åŸæ¥å£å¢åŠ æ–°çš„åŠŸèƒ½ã€‚</p>
<p>ä»¥ä¸‹æ˜¯ä¸€ä¸ªç®€å•çš„è£…é¥°å™¨æ¨¡å¼:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> :liupf</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> :å£°éŸ³æ”¾å¤§å™¨  åœ¨ä¸ä¿®æ”¹PersonåŸæœ‰åŠŸèƒ½çš„æƒ…å†µä¸‹ ç»™Personçš„say()æ–¹æ³•å¢åŠ åŠŸèƒ½ã€‚</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> :2019/05/10 23:59</span></span><br><span class="line"><span class="comment"> **/</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SoundIntensifier</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Person person = <span class="keyword">new</span> Person();</span><br><span class="line">        person.setVoice(<span class="number">10</span>);</span><br><span class="line"></span><br><span class="line">        Amplifier amplifier = <span class="keyword">new</span> Amplifier(person);</span><br><span class="line">        amplifier.say();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">Say</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">say</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span> <span class="keyword">implements</span> <span class="title">Say</span></span>&#123;</span><br><span class="line">    <span class="comment">/** å£°éŸ³åˆ†è´*/</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> voice;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getVoice</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> voice;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setVoice</span><span class="params">(<span class="keyword">int</span> voice)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.voice = voice;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">say</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="keyword">this</span>.voice);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Amplifier</span> <span class="keyword">implements</span> <span class="title">Say</span></span>&#123;</span><br><span class="line">    Person person;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Amplifier</span><span class="params">(Person person)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.person = person;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">say</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(person.getVoice() * <span class="number">10</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å…·ä½“çš„è£…é¥°å™¨æ¨¡å¼æœ‰å››ä¸ªç»„æˆéƒ¨åˆ†ï¼Œä¸Šè¾¹åªæ˜¯ç®€è¦çš„ä»£ç æ²¡æœ‰å®Œå…¨ä½“ç°å‡ºã€‚å››éƒ¨åˆ†ä¸ºä»¥ä¸‹å‡ ç‚¹:</p>
<ul>
<li><strong>æŠ½è±¡ç»„ä»¶:</strong> éœ€è¦è¢«è£…é¥°çš„æŠ½è±¡å¯¹è±¡ï¼Œé€šå¸¸æ˜¯æ¥å£</li>
<li><strong>å…·ä½“ç»„ä»¶:</strong> æŠ½è±¡ç»„ä»¶çš„å®ç°ï¼Œåœ¨ä¸Šæ–‡ä¸­æ˜¯<strong>Personç±»</strong></li>
<li><strong>æŠ½è±¡è£…é¥°è€…:</strong> åŒ…å«äº†å¯¹æŠ½è±¡ç»„ä»¶çš„å¼•ç”¨ä»¥åŠæŠ½è±¡ç»„ä»¶éœ€è¦è£…é¥°çš„æ–¹æ³•ï¼Œ<strong>éœ€è¦å®ç°æŠ½è±¡ç»„ä»¶æ¥å£</strong></li>
<li><strong>å…·ä½“è£…é¥°è€…:</strong> æŠ½è±¡è£…é¥°è€…çš„å…·ä½“å®ç°ï¼Œåœ¨ä¸Šæ–‡ä¸­æ˜¯<strong>Amplifierç±»</strong></li>
</ul>
<p>åœ¨Javaçš„I/OåŒ…ä¸‹:</p>
<ul>
<li>æŠ½è±¡ç»„ä»¶: InputStreamã€OutputStreamç­‰</li>
<li>å…·ä½“ç»„ä»¶: FileInputStreamã€FileOutputStreamç­‰(èŠ‚ç‚¹æµ)</li>
<li>æŠ½è±¡è£…é¥°è€…: FilerInputStreamç­‰</li>
<li>å…·ä½“è£…é¥°è€…: BufferInputStreamç­‰(å¤„ç†æµï¼Œå¯¹èŠ‚ç‚¹æµåŠŸèƒ½çš„å¢å¼º)</li>
</ul>
<h3 id="Java-I-O"><a href="#Java-I-O" class="headerlink" title="Java I/O"></a>Java I/O</h3><p><strong>Javaä¸­çš„I/Oä¼ è¾“çš„æ•°æ®å…¨éƒ¨éƒ½æ˜¯ä»¥æµçš„æ–¹å¼ä¿å­˜ï¼Œè€Œæ‰€æœ‰æµçš„æœ¬è´¨å®é™…ä¸Šéƒ½æ˜¯å­—èŠ‚ã€‚</strong></p>
<h4 id="I-Oæµç±»å›¾"><a href="#I-Oæµç±»å›¾" class="headerlink" title="I/Oæµç±»å›¾"></a>I/Oæµç±»å›¾</h4><p>â€‹    (å›¾æºç½‘ç»œä¾µåˆ )</p>
<ul>
<li><p><strong>I/Oæµ</strong></p>
<p><img src="https://blog-1257300108.cos.ap-beijing.myqcloud.com/IO/1345308068_2461.jpg" alt></p>
</li>
<li><p><strong>å­—èŠ‚æµ</strong></p>
<p>å­—èŠ‚æµå¤„ç†çš„å•å…ƒä¸ºä¸€ä¸ªå­—èŠ‚ã€‚æ“ä½œçš„å¯¹è±¡æ˜¯å­—èŠ‚ã€å­—èŠ‚æ•°ç»„ã€‚</p>
<p><img src="https://blog-1257300108.cos.ap-beijing.myqcloud.com/IO/20160526175652807_meitu_1.jpg" alt></p>
<p><img src="https://blog-1257300108.cos.ap-beijing.myqcloud.com/IO/20160526175652807_meitu_1.jpg" alt></p>
</li>
<li><p><strong>å­—ç¬¦æµ(ä¸€ä¸ªå­—ç¬¦ä¸¤ä¸ªå­—èŠ‚)</strong></p>
<p>å­—ç¬¦æµå¤„ç†çš„å•å…ƒä¸ºä¸¤ä¸ªå­—èŠ‚çš„Unicodeå­—ç¬¦ã€‚æ“ä½œçš„å¯¹è±¡æ˜¯å­—ç¬¦ã€å­—ç¬¦æ•°ç»„ã€å­—ç¬¦ä¸²ã€‚</p>
<ul>
<li><strong>è¾“å‡ºæµ(Writer):</strong> ä»–å°†è¦å†™å…¥æ–‡ä»¶åˆ°çš„å­—ç¬¦åºåˆ—æŒ‰ç…§ç¼–ç çš„æ–¹å¼(å¦‚UTF-8ã€GBKç­‰)è½¬æ¢ä¸ºå­—èŠ‚åºåˆ—å†™å…¥æ–‡ä»¶ã€‚</li>
<li><strong>è¾“å…¥æµ(Reader):</strong> ä»–å°†ä»æ–‡ä»¶ä¸­è¯»å–çš„å­—èŠ‚åºåˆ—æŒ‰ç…§æŒ‡å®šç¼–ç æ ¼å¼è½¬æ¢æˆå­—ç¬¦è¾“å‡ºåˆ°å†…å­˜ä¸­ã€‚</li>
</ul>
<p><img src="https://blog-1257300108.cos.ap-beijing.myqcloud.com/IO/20160526175730259_meitu_3.jpg" alt></p>
<p><img src="https://blog-1257300108.cos.ap-beijing.myqcloud.com/IO/20160526175716649_meitu_4.jpg" alt></p>
</li>
</ul>
<h4 id="åŒºåˆ«ä¸è”ç³»"><a href="#åŒºåˆ«ä¸è”ç³»" class="headerlink" title="åŒºåˆ«ä¸è”ç³»"></a>åŒºåˆ«ä¸è”ç³»</h4><p>è¿™ä¸€å°èŠ‚å†™çš„å¾ˆä¹± æœ‰äº›åœ°æ–¹æ²¡æœ‰å½»åº•ç†è§£ å…ˆå†™ä¸‹ å¾…è€ƒè¯ã€‚</p>
<hr>
<ul>
<li><p>å½“ç³»ç»Ÿç»™ä½ çš„æ–‡ä»¶æ˜¯å­—èŠ‚æµï¼Œä½†æ˜¯æ–‡ä»¶ç¡®å®å…¨æ–‡æœ¬æ—¶ å°±å¯ä»¥é€šè¿‡InputStreamReaderæ¥è¿›è¡ŒæŒ‡å®šå­—ç¬¦é›†çš„è½¬æ¢</p>
</li>
<li><p>è€ŒOutputStreamæ˜¯å°†å­—ç¬¦æµæŒ‰ç…§æŒ‡å®šçš„å­—ç¬¦é›†è¿›è¡Œ<strong>ç¼–ç </strong> è¾“å‡ºä¸ºå­—èŠ‚æµã€‚</p>
</li>
</ul>
<p>å®é™…ä¸Šåœ¨è®¡ç®—æœºåº•å±‚å¤„ç†çš„å…¨éƒ¨æ˜¯å­—èŠ‚ã€‚å¯¹å­—ç¬¦æµçš„å¤„ç†å®é™…ä¸Šæ˜¯æ ¹æ®ç¼–ç è§„åˆ™æ¯”å¦‚UTF-8æˆ–è€…Unicodeç­‰å­—ç¬¦é›†ç¿»è¯‘æˆå­—èŠ‚ã€‚è¿™ä¸¤è€…ä¹‹é—´çš„è½¬åŒ–åœ¨Javaä¸­æ˜¯é€šè¿‡<strong>InputStreamReader</strong>ï¼Œ<strong>OutputStreamWriter</strong>æ¥å®Œæˆçš„ã€‚<u>InputStreamReaderå°†è¾“å…¥çš„å­—èŠ‚æµå˜ä¸ºå­—ç¬¦æµã€‚OutputStreamWriterå°†è¾“å‡ºçš„å­—èŠ‚æµè½¬ä¸ºå­—ç¬¦æµ</u>ã€‚</p>
<p><strong>å­—èŠ‚æµå¯ä»¥è¯»å­—ç¬¦ï¼Œä½†æ˜¯å­—ç¬¦æµä¸å¯ä»¥è¯»å­—èŠ‚ã€‚åŸå› ï¼šå­—èŠ‚æµè¯»å–æ•°æ®çš„æ—¶å€™è¯»åˆ°çš„å…¨æ˜¯æ–‡ä»¶æ•°æ®çš„å­—èŠ‚å½¢å¼ ç­‰åˆ°å†™å…¥åˆ°æ–‡ä»¶æ—¶ä¹Ÿæ˜¯å­—èŠ‚ï¼Œè¿™ä¸ªè¿‡ç¨‹ä¸­æ²¡æœ‰è¿›è¡Œå­—ç¬¦é›†è§£ç ã€‚ä½†æ˜¯å­—ç¬¦æµè¯»å–å­—èŠ‚æ•°æ®çš„æ—¶å€™ä¼šæ ¹æ®å­—ç¬¦æµçš„æŒ‡å®šå­—ç¬¦é›†è¿›è¡Œè§£ç ï¼Œå†™å…¥åˆ°å¦ä¸€ä¸ªæ–‡ä»¶æ—¶å…¶å®æ˜¯ä¹±ç çš„å­—ç¬¦ã€‚</strong></p>
<p>ä½†æ˜¯ä½¿ç”¨å­—èŠ‚æµè¯»å–å­—ç¬¦æ–‡æœ¬æ—¶å­˜åœ¨å¦ä¸€ä¸ªé—®é¢˜:å¦‚æœæ¯æ¬¡è¯»åˆ°çš„å­—èŠ‚æ•°ä¸æ˜¯å­—ç¬¦æ–‡æœ¬ä¸­å­—ç¬¦çš„å­—èŠ‚æ•°ï¼Œé‚£ä¹ˆè¯»å‡ºæ¥çš„æ•°æ®å°±å¯èƒ½æ˜¯ä¹±ç ã€‚æ‰€ä»¥è¦ä½¿ç”¨å­—ç¬¦æµã€‚</p>
<p><strong>å­—èŠ‚æ•°ç»„æµä¸éœ€è¦é‡Šæ”¾(ByteArrayInput/OutputStream)ã€‚</strong>å¸¸è§„æ“ä½œæ–‡ä»¶çš„æµå¦‚InputStreamã€OutputStreamæ“ä½œæ–‡ä»¶æ—¶ï¼Œéƒ½æ˜¯åœ¨ç¡¬ç›˜ä¸Šè¿›è¡Œä¿®æ”¹ã€‚è¿™æ—¶å°±éœ€è¦ç”¨åˆ°æ“ä½œç³»ç»Ÿæ¥ä»£ç†æ“ä½œã€‚ç»“æŸåè¦é€šçŸ¥æ“ä½œç³»ç»Ÿå…³é—­ã€‚è€Œæ“ä½œå­—èŠ‚æ•°ç»„æ—¶ï¼Œæ˜¯åœ¨å†…å­˜ä¸Šè¿›è¡Œæ“ä½œï¼Œè¿™æ—¶å®Œå…¨ç”±Javaè™šæ‹Ÿæœºæ¥æŒæ¡ã€‚ä¸éœ€è¦æ˜¾ç¤ºçš„å…³é—­I/Oæµã€‚</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/04/21/æ·±å…¥ç†è§£ThreadPoolExecutor/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="liupf">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="liupf's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/04/21/æ·±å…¥ç†è§£ThreadPoolExecutor/" itemprop="url">æ·±å…¥ç†è§£ThreadPoolExecutor</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2019-04-21T15:56:45+08:00">
                2019-04-21
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">åˆ†ç±»äº</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/å¹¶å‘ç¼–ç¨‹/" itemprop="url" rel="index">
                    <span itemprop="name">å¹¶å‘ç¼–ç¨‹</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="ä¸€ã€ThreadPoolExecutorçš„ç»§æ‰¿å…³ç³»"><a href="#ä¸€ã€ThreadPoolExecutorçš„ç»§æ‰¿å…³ç³»" class="headerlink" title="ä¸€ã€ThreadPoolExecutorçš„ç»§æ‰¿å…³ç³»"></a>ä¸€ã€ThreadPoolExecutorçš„ç»§æ‰¿å…³ç³»</h3><p><img src="http://pqghh5se3.bkt.clouddn.com//%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3ThreadPoolExecutor/006tNc79ly1g2abfyz4ulj311q0oktaj.jpg" alt="006tNc79ly1g2abfyz4ulj311q0oktaj"></p>
<p>å‘ä¸Šç»§æ‰¿è‡ªAbstractExecutorServiceï¼Œå‘ä¸‹è¢«ScheduledThreadPoolExecutorç»§æ‰¿</p>
<p><strong><em>å·¥ä½œçº¿ç¨‹çš„å­˜æ”¾ä½ç½®:</em></strong> <strong><code>private final HashSet&lt;Worker&gt; workers = new HashSet&lt;Worker&gt;();</code></strong></p>
<p><strong><em>é˜»å¡é˜Ÿåˆ—:</em></strong> <strong><code>private final BlockingQueue&lt;Runnable&gt; workQueue;</code></strong></p>
<h3 id="äºŒã€é‡è¦çš„å˜é‡"><a href="#äºŒã€é‡è¦çš„å˜é‡" class="headerlink" title="äºŒã€é‡è¦çš„å˜é‡"></a>äºŒã€é‡è¦çš„å˜é‡</h3><ul>
<li><p><strong>ctl</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> AtomicInteger ctl = <span class="keyword">new</span> AtomicInteger(ctlOf(RUNNING, <span class="number">0</span>));</span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">ctlOf</span><span class="params">(<span class="keyword">int</span> rs, <span class="keyword">int</span> wc)</span> </span>&#123; <span class="keyword">return</span> rs | wc; &#125;</span><br></pre></td></tr></table></figure>
<p>ctlæ˜¯ä¸€ä¸ªAtomicIntegeråŸå­ç±»å¯¹è±¡ã€‚ä¸€ä¸ªctlå˜é‡åŒ…å«ä¸¤éƒ¨åˆ†ä¿¡æ¯:<strong><em>çº¿ç¨‹æ± çš„è¿è¡ŒçŠ¶æ€(rs)</em></strong>å’Œ<strong><em>çº¿ç¨‹æ± å†…æœ‰æ•ˆçº¿ç¨‹çš„æ•°é‡(wc)</em></strong>ã€‚ç”±äºä¸€ä¸ªintå‹çš„å˜é‡æ˜¯ç”±32ä½äºŒè¿›åˆ¶æ•°ç»„æˆï¼Œæ‰€ä»¥ctlçš„é«˜3ä½è¡¨ç¤ºçº¿ç¨‹æ± çš„è¿è¡ŒçŠ¶æ€ï¼Œç”¨ä½29ä½æ¥è¡¨ç¤ºçº¿ç¨‹æ± å†…æœ‰æ•ˆçº¿ç¨‹çš„æ•°é‡(æ‰€ä»¥çº¿ç¨‹æ± çš„çº¿ç¨‹æ•°é‡çš„ä¸Šé™å°±æ˜¯29ä¸ª1è¡¨ç¤ºçš„æ•°å­—ï¼‰ã€‚è€Œctlçš„æ•°å€¼å°±æ˜¯ç”±è¿™ä¸¤ä¸ªå˜é‡è®¡ç®—å¾—å‡ºã€‚(ctlOf(int rs, int wc)å‡½æ•°)</p>
<p>åŒæ ·çš„å¦‚æœçŸ¥é“äº†ctlå€¼ä¹Ÿå¯ä»¥é€šè¿‡ä»¥ä¸‹ä¸¤ä¸ªæ–¹æ³•è®¡ç®—å¾—å‡ºçº¿ç¨‹æ± çš„è¿è¡ŒçŠ¶æ€å’Œçº¿ç¨‹æ± å†…æœ‰æ•ˆçº¿ç¨‹çš„æ•°é‡ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">runStateOf</span><span class="params">(<span class="keyword">int</span> c)</span>     </span>&#123; <span class="keyword">return</span> c &amp; ~CAPACITY; &#125;</span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">workerCountOf</span><span class="params">(<span class="keyword">int</span> c)</span>  </span>&#123; <span class="keyword">return</span> c &amp; CAPACITY; &#125;</span><br></pre></td></tr></table></figure>
<p>å…¶ä¸­<strong>CAPACITY</strong>è¡¨ç¤ºé«˜ä¸‰ä½æ˜¯0ï¼Œä½29ä½æ˜¯1çš„ä¸€ä¸ªintå‹çš„æ•°ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> COUNT_BITS = Integer.SIZE - <span class="number">3</span>;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> CAPACITY   = (<span class="number">1</span> &lt;&lt; COUNT_BITS) - <span class="number">1</span>;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>çº¿ç¨‹æ± çš„è¿è¡ŒçŠ¶æ€(5ç§)</strong></p>
<ol>
<li><strong>RUNNING(è¿è¡ŒçŠ¶æ€)ï¼š</strong>èƒ½æ¥å—æ–°æäº¤çš„ä»»åŠ¡å¹¶ä¸”ä¹Ÿèƒ½å¤„ç†é˜»å¡é˜Ÿåˆ—ä¸­çš„ä»»åŠ¡ã€‚</li>
<li><strong>SHUTDOWN(å…³é—­çŠ¶æ€)ï¼š</strong>ä¸å†æ¥å—æ–°æäº¤çš„ä»»åŠ¡ä½†æ˜¯å¯ä»¥ç»§ç»­å¤„ç†é˜»å¡é˜Ÿåˆ—ä¸­ä¿å­˜çš„ä»»åŠ¡ã€‚åœ¨çº¿ç¨‹æ± å¤„äºRUNNINGçŠ¶æ€æ—¶è°ƒç”¨shutdown()æ–¹æ³•å¯ä»¥è¿›å…¥è¯¥çŠ¶æ€ã€‚</li>
<li><strong>STOPï¼š</strong>ä¸èƒ½æ¥å—æ–°æäº¤çš„ä»»åŠ¡ä¹Ÿä¸èƒ½å¤„ç†é˜»å¡é˜Ÿåˆ—ä¸­å·²ä¿å­˜çš„ä»»åŠ¡ï¼Œå¹¶ä¸”ä¼šä¸­æ–­æ­£åœ¨å¤„ç†ä¸­çš„ä»»åŠ¡ã€‚åœ¨çº¿ç¨‹æ± å¤„äºRUNNINGæˆ–è€…SHUTDOWNçŠ¶æ€æ—¶è°ƒç”¨showdownNow()æ–¹æ³•å¯ä»¥è¿›å…¥æ­¤çŠ¶æ€ã€‚</li>
<li><strong>TIDYING(æ¸…ç†çŠ¶æ€)ï¼š</strong>æ‰€æœ‰çš„ä»»åŠ¡éƒ½å·²ç»ˆæ­¢äº†ï¼ŒworkCount(æœ‰æ•ˆçº¿ç¨‹æ•°)ä¸º0ï¼Œçº¿ç¨‹è¿›å…¥è¯¥çŠ¶æ€åä¼šè°ƒç”¨<strong>terminated()</strong>æ–¹æ³•ä»¥è®©è¯¥çº¿ç¨‹æ± è¿›å…¥TERMINATEDçŠ¶æ€ã€‚å½“çº¿ç¨‹æ± å¤„äºSHUTDOWNçŠ¶æ€æ—¶ï¼Œå¦‚æœæ­¤åçº¿ç¨‹æ± å†…æ²¡æœ‰çº¿ç¨‹äº†å¹¶ä¸”é˜»å¡é˜Ÿåˆ—å†…ä¹Ÿæ²¡æœ‰å¾…æ‰§è¡Œçš„ä»»åŠ¡äº†ï¼Œçº¿ç¨‹å°±ä¼šè¿›å…¥è¯¥çŠ¶æ€ï¼›å½“çº¿ç¨‹å¤„äºSTOPçŠ¶æ€æ—¶ï¼Œå¦‚æœæ­¤åçº¿ç¨‹æ± å†…æ²¡æœ‰çº¿ç¨‹å°±ä¼šè¿›å…¥åˆ°è¯¥çŠ¶æ€ã€‚</li>
<li><strong>TERMINATEDï¼š</strong>terminated()æ–¹æ³•æ‰§è¡Œå®Œå°±è¿›å…¥è¯¥çŠ¶æ€ã€‚</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// runState is stored in the high-order bits</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> RUNNING    = -<span class="number">1</span> &lt;&lt; COUNT_BITS;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> SHUTDOWN   =  <span class="number">0</span> &lt;&lt; COUNT_BITS;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> STOP       =  <span class="number">1</span> &lt;&lt; COUNT_BITS;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> TIDYING    =  <span class="number">2</span> &lt;&lt; COUNT_BITS;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> TERMINATED =  <span class="number">3</span> &lt;&lt; COUNT_BITS;</span><br></pre></td></tr></table></figure>
<p>ä¸Šå›¾æ˜¯äº”ç§çŠ¶æ€çš„æ•°å€¼ã€‚ä¾‹å¦‚ å½“rs &lt; SHUTDOWNï¼Œé‚£ä¹ˆè¡¨ç¤ºçº¿ç¨‹æ± å¤„äºRUNNINGçŠ¶æ€ã€‚</p>
</li>
</ul>
<h3 id="ä¸‰ã€æ„é€ æ–¹æ³•ä¸­çš„é‡è¦å‚æ•°"><a href="#ä¸‰ã€æ„é€ æ–¹æ³•ä¸­çš„é‡è¦å‚æ•°" class="headerlink" title="ä¸‰ã€æ„é€ æ–¹æ³•ä¸­çš„é‡è¦å‚æ•°"></a>ä¸‰ã€æ„é€ æ–¹æ³•ä¸­çš„é‡è¦å‚æ•°</h3><p>æ ¹æœ¬çš„æ„é€ æ–¹æ³•(æ‰€æœ‰çš„æ„é€ æ–¹æ³•æœ€ç»ˆéƒ½ä¼šè°ƒç”¨åˆ°è¿™ä¸€ä¸ª)ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">ThreadPoolExecutor</span><span class="params">(<span class="keyword">int</span> corePoolSize,</span></span></span><br><span class="line"><span class="function"><span class="params">                          <span class="keyword">int</span> maximumPoolSize,</span></span></span><br><span class="line"><span class="function"><span class="params">                          <span class="keyword">long</span> keepAliveTime,</span></span></span><br><span class="line"><span class="function"><span class="params">                          TimeUnit unit,</span></span></span><br><span class="line"><span class="function"><span class="params">                          BlockingQueue&lt;Runnable&gt; workQueue,</span></span></span><br><span class="line"><span class="function"><span class="params">                          ThreadFactory threadFactory,</span></span></span><br><span class="line"><span class="function"><span class="params">                          RejectedExecutionHandler handler)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (corePoolSize &lt; <span class="number">0</span> ||</span><br><span class="line">        maximumPoolSize &lt;= <span class="number">0</span> ||</span><br><span class="line">        maximumPoolSize &lt; corePoolSize ||</span><br><span class="line">        keepAliveTime &lt; <span class="number">0</span>)</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException();</span><br><span class="line">    <span class="keyword">if</span> (workQueue == <span class="keyword">null</span> || threadFactory == <span class="keyword">null</span> || handler == <span class="keyword">null</span>)</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> NullPointerException();</span><br><span class="line">    <span class="keyword">this</span>.acc = System.getSecurityManager() == <span class="keyword">null</span> ?</span><br><span class="line">            <span class="keyword">null</span> :</span><br><span class="line">            AccessController.getContext();</span><br><span class="line">    <span class="keyword">this</span>.corePoolSize = corePoolSize;</span><br><span class="line">    <span class="keyword">this</span>.maximumPoolSize = maximumPoolSize;</span><br><span class="line">    <span class="keyword">this</span>.workQueue = workQueue;</span><br><span class="line">    <span class="keyword">this</span>.keepAliveTime = unit.toNanos(keepAliveTime);</span><br><span class="line">    <span class="keyword">this</span>.threadFactory = threadFactory;</span><br><span class="line">    <span class="keyword">this</span>.handler = handler;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol>
<li><p><strong>corePoolSize</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">volatile</span> <span class="keyword">int</span> corePoolSize;</span><br></pre></td></tr></table></figure>
<p>è¡¨ç¤ºçº¿ç¨‹æ± ä¸­ä¸€ç›´å­˜æ´»ç€çš„çº¿ç¨‹çš„æœ€å°æ•°é‡ï¼Œä¹Ÿè¢«ç§°ä½œæ ¸å¿ƒçº¿ç¨‹ã€‚<strong>é»˜è®¤æƒ…å†µ</strong>ä¸‹ï¼Œæ ¸å¿ƒçº¿ç¨‹æ˜¯æŒ‰ç…§éœ€è¦åˆ›å»ºå¹¶å¯åŠ¨çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œ<strong>åªæœ‰å½“çº¿ç¨‹æ± æ¥æ”¶åˆ°æˆ‘ä»¬æäº¤ç»™ä»–çš„ä»»åŠ¡åï¼Œä»–æ‰ä¼šåˆ›å»ºå¹¶å¯åŠ¨ä¸€å®šæ•°é‡çš„æ ¸å¿ƒçº¿ç¨‹æ¥æ‰§è¡Œè¿™äº›ä»»åŠ¡ã€‚</strong>ä¹Ÿå¯ä»¥é€šè¿‡prestartCoreThread()æˆ–è€…prestartAllCoreThreads()æ–¹æ³•æ˜¯çš„æ–°ä»»åŠ¡è¿˜æœªæäº¤æ—¶çº¿ç¨‹æ± å°±å·²ç»åˆ›å»ºå¹¶å¯åŠ¨è¯¾ä¸€ä¸ªæˆ–æ‰€æœ‰çš„æ ¸å¿ƒçº¿ç¨‹ã€‚</p>
</li>
<li><p><strong>maximumPoolSize</strong></p>
<p>maximumPoolSize è¡¨ç¤ºçº¿ç¨‹æ± å†…èƒ½å¤Ÿå®¹çº³çº¿ç¨‹æ•°é‡çš„æœ€å¤§å€¼ã€‚ä½†æ˜¯ä¸èƒ½è¶…è¿‡å¸¸é‡CAPACITYçš„æ•°å€¼å¤§å°ã€‚</p>
<p>å½“é€šè¿‡execute(Runnable)æ–¹æ³•æäº¤ä¸€ä¸ªä»»åŠ¡åˆ°çº¿ç¨‹æ± æ—¶ï¼Œå¦‚æœçº¿ç¨‹æ± å¤„äºè¿è¡ŒçŠ¶æ€(RUNNING)çš„çº¿ç¨‹æ•°é‡å°‘äºæ ¸å¿ƒçº¿ç¨‹æ•°(corePoolSize)ï¼Œ<strong>é‚£ä¹ˆå³ä½¿æœ‰ä¸€äº›éæ ¸å¿ƒçº¿ç¨‹å¤„äºç©ºç°çŠ¶æ€ï¼Œç³»ç»Ÿä¹Ÿä¼šå€¾å‘äºåˆ›å»ºä¸€ä¸ªæ–°çš„çº¿ç¨‹æ¥æ‰§è¡Œä»»åŠ¡</strong>ã€‚å¦‚æœæ­¤æ—¶å¤„äºè¿è¡ŒçŠ¶æ€(RUNNING)çš„çº¿ç¨‹æ•°é‡å¤§äºæ ¸å¿ƒçº¿ç¨‹æ•°(corePoolSize), ä½†åˆå°äºæœ€å¤§çº¿ç¨‹æ•°(maximumPoolSize), é‚£ä¹ˆç³»ç»Ÿå°†ä¼šå»åˆ¤æ–­çº¿ç¨‹æ± å†…éƒ¨çš„é˜»å¡é˜Ÿåˆ— workQueue ä¸­æ˜¯å¦è¿˜æœ‰ç©ºä½å­. å¦‚æœå‘ç°æœ‰ç©ºä½å­, ç³»ç»Ÿå°±ä¼šå°†è¯¥ä»»åŠ¡å…ˆå­˜å…¥è¯¥é˜»å¡é˜Ÿåˆ—ï¼› å¦‚æœå‘ç°é˜Ÿåˆ—ä¸­å·²æ²¡æœ‰ç©ºä½å­(å³: é˜Ÿåˆ—å·²æ»¡), ç³»ç»Ÿå°±ä¼šæ–°åˆ›å»ºä¸€ä¸ªçº¿ç¨‹æ¥æ‰§è¡Œè¯¥ä»»åŠ¡ï¼›å¦‚æœcorePoolSize ==  maximumPoolSizeï¼Œåˆ™è¯¥çº¿ç¨‹æ± å®¹é‡æ˜¯å›ºå®šçš„ã€‚</p>
</li>
<li><p><strong>keepAliveTime</strong></p>
<p>keepAliveTimeè¡¨ç¤ºç©ºé—²çº¿ç¨‹å¤„äºç­‰å¾…çŠ¶æ€çš„è¶…å¸‚æ—¶é—´(è¶…è¿‡è¯¥æ—¶é—´çº¿ç¨‹åœæ­¢å·¥ä½œ)ã€‚å½“æ€»çº¿ç¨‹æ•°å¤§äºcorePoolSizeä¸”<strong>allowCoreThreadTimeOutä¸ºfalse</strong>æ—¶ï¼Œè¿™äº›å¤šå‡ºæ¥çš„éæ ¸å¿ƒçº¿ç¨‹ä¸€æ—¦è¿›å…¥ç©ºé—²çŠ¶æ€å°±å¼€å§‹è®¡ç®—å„è‡ªçš„ç­‰å¾…æ—¶é—´ï¼Œä¸€æ—¦ç­‰å¾…æ—¶é—´è¶…è¿‡keepAliveTimeï¼Œè¯¥çº¿ç¨‹å°±ä¼šåœæ­¢å·¥ä½œ(terminated)ï¼Œ<strong>è€Œæ ¸å¿ƒçº¿ç¨‹ä¸ä¼šå—è¶…æ—¶æ—¶é—´çš„é™åˆ¶ã€‚</strong>ä½†æ˜¯å¦‚æœ<strong>allowCoreThreadTimeOutä¸ºtrueï¼Œåˆ™æ ¸å¿ƒçº¿ç¨‹ä¹Ÿä¼šæ”¶åˆ°é™åˆ¶ã€‚</strong></p>
</li>
<li><p><strong>workQueue</strong></p>
<p>é˜»å¡é˜Ÿåˆ—<strong>(<code>BlockingQueue&lt;Runnable&gt;</code>)</strong>ã€‚åŸºäºâ€ç”Ÿäº§è€…-æ¶ˆè´¹è€…â€æ¨¡å‹ã€‚é˜Ÿåˆ—å¯¹æ–°æäº¤çš„ä»»åŠ¡çš„ä¸‰ç§å¤„ç†ç­–ç•¥ï¼š</p>
<ul>
<li><p><strong>ç›´æ¥åˆ‡æ¢</strong></p>
<p>å¸¸ç”¨çš„é˜Ÿåˆ—æ˜¯<strong>SynchronousQueue(åŒæ­¥é˜Ÿåˆ—)</strong>ã€‚è¿™ç§é˜Ÿåˆ—å†…éƒ¨ä¸ä¼šå­˜å‚¨å…ƒç´ ï¼Œæ¯ä¸€æ¬¡æ’å…¥æ“ä½œéƒ½ä¼šå…ˆè¿›å…¥é˜»å¡çŠ¶æ€ï¼Œç›´åˆ°å¦ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œäº†åˆ é™¤æ“ä½œï¼Œç„¶åæ’å…¥æ“ä½œæ‰ä¼šæ‰§è¡Œã€‚åŒæ ·çš„æ¯ä¸€æ¬¡åˆ é™¤æ“ä½œä¹Ÿä¼šç­‰å¾…æ’å…¥æ“ä½œçš„æ‰§è¡Œå®Œæ¯•ã€‚å½“æäº¤ä¸€ä¸ªä»»åŠ¡åˆ°ä½¿ç”¨è¿™ç§é˜»å¡é˜Ÿåˆ—çš„çº¿ç¨‹æ± åï¼Œçº¿ç¨‹æ± ä¼šæ£€æµ‹æ˜¯å¦æœ‰å¯ç”¨çš„ç©ºé—´çº¿ç¨‹æ¥æ‰§è¡Œè¯¥ä»»åŠ¡ï¼Œå¦‚æœæ²¡æœ‰å°±ç›´æ¥åˆ›å»ºä¸€ä¸ªçº¿ç¨‹è€Œä¸æ˜¯å°†è¯¥ä»»åŠ¡æ”¾åˆ°é˜»å¡é˜Ÿåˆ—ä¸­ã€‚<strong>è¿™ç§ç­–ç•¥çš„ç›®çš„æ˜¯è®©æ¯ä¸€ä¸ªæäº¤çš„ä»»åŠ¡éƒ½èƒ½å¾—åˆ°ç«‹å³æ‰§è¡Œã€‚è¿™è¦æ±‚çº¿ç¨‹æ± çš„æœ€å¤§å€¼æ˜¯çº¿ç¨‹æ± å…è®¸çš„æœ€å¤§å€¼Integer.MAX_VALUEã€‚</strong>é™æ€å·¥å‚æ–¹æ³•<strong>Executors.newCachedThreadPool()</strong>ä½¿ç”¨è¿™ç§é˜Ÿåˆ—ã€‚</p>
</li>
<li><p><strong>æ— ç•Œé˜Ÿåˆ—</strong></p>
<p>å¦‚åŸºäºé“¾è¡¨çš„é˜»å¡é˜Ÿåˆ—<strong>LinkedBlockingQueue</strong>ã€‚è¿™ç§æƒ…å†µä¸‹<strong>maximumPoolSize</strong>èµ·ä¸åˆ°ä½œç”¨ï¼Œå› ä¸ºå½“çº¿ç¨‹æ•°å¤§äºcorePoolSizeæ—¶æ€»ä¼šå‘æ— ç•Œé˜Ÿåˆ—ä¸­æ·»åŠ æ–°çš„çº¿ç¨‹ï¼Œç›´åˆ°è¾¾åˆ°çº¿ç¨‹æ± æ‰€å…è®¸çš„æœ€å¤§å€¼ã€‚é™æ€å·¥å‚æ–¹æ³•<strong>Executors.newFixedThreadPool()</strong>ä½¿ç”¨è¿™ç§é˜Ÿåˆ—</p>
</li>
<li><p><strong>æœ‰ç•Œé˜Ÿåˆ—</strong></p>
<p>å¦‚<strong>ArrayBlockingQueue</strong>ã€‚å¯ä»¥å°†çº¿ç¨‹æ± æœ€å¤§çš„çº¿ç¨‹æ•°maximumPoolSizeé™å®šåœ¨æŸä¸ªå€¼ä»¥å†…ï¼Œå¹¶é€šè¿‡é˜Ÿåˆ—æ¥é™ä½èµ„æºçš„æ¶ˆè€—ã€‚</p>
</li>
</ul>
</li>
<li><p><strong>threadFactory</strong></p>
<p>çº¿ç¨‹å·¥å‚ï¼Œç”¨äºåˆ›å»ºçº¿ç¨‹ã€‚å¦‚æœåœ¨åˆ›å»ºçº¿ç¨‹æ± çš„æ—¶å€™æ²¡æœ‰æŒ‡å®šthreadFactoryå‚æ•°ï¼Œåˆ™é»˜è®¤ä½¿ç”¨<strong>Executors.defaultThreadFactory()</strong>æ–¹æ³•åˆ›å»ºçº¿ç¨‹å·¥å‚ã€‚å¦‚æœæƒ³ä¸ºçº¿ç¨‹å·¥å‚è®¾ç½®å‚æ•°å¦‚åå­—ã€ä¼˜å…ˆçº§é‚£ä¹ˆå°±éœ€è¦è‡ªå·±å»å®ç°ThreadFactoryæ¥å£ï¼Œå¹¶å®ç°å…¶æŠ½è±¡æ–¹æ³•<strong>newThread()</strong>ã€‚</p>
</li>
<li><p><strong>handler</strong></p>
<p>çº¿ç¨‹æ± æ‹’ç»ç­–ç•¥ã€‚ä»¥ä¸‹æ¡ä»¶æ»¡è¶³å…¶ä¸­ä¸€ä¸ªå°±ä¼šè§¦å‘æ‹’ç»ç­–ç•¥ã€‚</p>
<ul>
<li>çº¿ç¨‹æ± å¤„äºSHUTDOWNçŠ¶æ€(ä¸è®ºçº¿ç¨‹æ± å’Œé˜»å¡é˜Ÿåˆ—æ˜¯å¦å·²æ»¡)ã€‚</li>
<li>çº¿ç¨‹æ± æ‰€æœ‰çš„çº¿ç¨‹å¤„äºè¿è¡ŒçŠ¶æ€ä¸”çº¿ç¨‹æ± ä¸­çš„é˜»å¡é˜Ÿåˆ—å·²æ»¡ã€‚</li>
</ul>
<p>æ‹’ç»ç­–ç•¥çš„æ–¹å¼:</p>
<ol>
<li><p><strong>AbortPolicy</strong></p>
<p>æŠ›å‡ºå¼‚å¸¸</p>
</li>
<li><p><strong>CallerRunsPolicy</strong></p>
<p>å°†æ–°æäº¤çš„ä»»åŠ¡æ”¾åˆ°ThreadPoolExecutor.execute()æ–¹æ³•æ‰€åœ¨çš„çº¿ç¨‹ä¸­æ‰§è¡Œ</p>
</li>
<li><p><strong>DiscardPolicy</strong></p>
<p>ä¸æ‰§è¡Œæ–°æäº¤çš„ä»»åŠ¡</p>
</li>
<li><p><strong>DiscardOldestPolicy</strong></p>
<ul>
<li>å½“çº¿ç¨‹å·²å…³é—­å°±ä¸æ‰§è¡Œè¿™ä¸ªä»»åŠ¡ï¼Œå’ŒDiscardPolicyç­–ç•¥ä¸€æ ·</li>
<li>å½“çº¿ç¨‹æœªå…³é—­ï¼Œä¼šå°†é˜»å¡é˜Ÿåˆ—ä¸­å¤„äºé˜Ÿé¦–(head)çš„é‚£ä¸ªä»»åŠ¡ä»é˜Ÿåˆ—ä¸­ç§»é™¤ï¼Œç„¶åå†å°†è¿™ä¸ªæ–°æäº¤çš„ä»»åŠ¡åŠ å…¥åˆ°è¯¥é˜»å¡é˜Ÿåˆ—çš„é˜Ÿå°¾(tail)æ‰§è¡Œã€‚</li>
</ul>
</li>
</ol>
</li>
</ol>
<h3 id="å››ã€çº¿ç¨‹æ± è¿›è¡Œä»»åŠ¡è°ƒåº¦çš„åŸç†"><a href="#å››ã€çº¿ç¨‹æ± è¿›è¡Œä»»åŠ¡è°ƒåº¦çš„åŸç†" class="headerlink" title="å››ã€çº¿ç¨‹æ± è¿›è¡Œä»»åŠ¡è°ƒåº¦çš„åŸç†"></a>å››ã€çº¿ç¨‹æ± è¿›è¡Œä»»åŠ¡è°ƒåº¦çš„åŸç†</h3><p>å‘çº¿ç¨‹æ± æäº¤ä¸€ä¸ªä»»åŠ¡ï¼Œå¯ä»¥é€šè¿‡è°ƒç”¨ <strong>execute()</strong> æˆ– <strong>submit()</strong>æ–¹æ³•æ¥å®ç°ï¼Œ è€ŒäºŒè€…çš„åŒºåˆ«æ˜¯ï¼Œ execute()æ–¹æ³•åªèƒ½è¿›è¡Œä»»åŠ¡çš„æäº¤è€Œä¸èƒ½è·å–è¯¥ä»»åŠ¡æ‰§è¡Œçš„ç»“æœ,ï¼Œä½† submit()æ–¹æ³•åˆ™æ—¢èƒ½è¿›è¡Œä»»åŠ¡çš„æäº¤ï¼Œåˆèƒ½è·å–è¯¥ä»»åŠ¡æ‰§è¡Œçš„ç»“æœã€‚submitçš„åº•å±‚å®é™…ä¸Šå°è£…äº†execute()ï¼Œsubmit()çš„è¿”å›å€¼ç±»å‹æ˜¯<strong>Future</strong>ã€‚</p>
<ul>
<li><p><strong>execute()</strong>æºç </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">execute</span><span class="params">(Runnable command)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (command == <span class="keyword">null</span>)</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> NullPointerException();</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">     *æ•´ä¸ªè¿‡ç¨‹åˆ†ä¸‰ç§æƒ…å†µ</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="comment">// è·å–ctlçš„å€¼</span></span><br><span class="line">    <span class="keyword">int</span> c = ctl.get();</span><br><span class="line">  	<span class="comment">/** ç¬¬ä¸€ç§æƒ…å†µ */</span></span><br><span class="line">  	<span class="comment">//æ ¹æ®ctlçš„å€¼å¾—åˆ°å½“å‰çº¿ç¨‹æ± æœ‰æ•ˆçš„çº¿ç¨‹æ•°workerCountOf(c)</span></span><br><span class="line">    <span class="keyword">if</span> (workerCountOf(c) &lt; corePoolSize) &#123;</span><br><span class="line">      	</span><br><span class="line">        <span class="comment">//å¦‚æœå½“å‰çº¿ç¨‹æ± æœ‰æ•ˆçº¿ç¨‹æ•°å°äºæ ¸å¿ƒçº¿ç¨‹æ±  è°ƒç”¨addWorkæ–¹æ³• å°†å½“å‰çš„çº¿ç¨‹ä¼ å…¥</span></span><br><span class="line">      	<span class="comment">//å¹¶åˆ›å»ºä¸€ä¸ªçº¿ç¨‹æ¥æ‰§è¡Œä»»åŠ¡</span></span><br><span class="line">        <span class="keyword">if</span> (addWorker(command, <span class="keyword">true</span>))</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">      	<span class="comment">//é‡æ–°å¾—åˆ°ctlçš„å€¼</span></span><br><span class="line">        c = ctl.get();</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">  	<span class="comment">/** ä¸æ»¡è¶³ä¸Šè¿°æ¡ä»¶çš„æƒ…å†µ:</span></span><br><span class="line"><span class="comment">  	 * 1ã€çº¿ç¨‹æ± çš„æ ¸å¿ƒçº¿ç¨‹æ•°å¤§äºå·²è®¾å®šæ ¸å¿ƒçº¿ç¨‹æ•°çš„ä¸Šé™</span></span><br><span class="line"><span class="comment">  	 * 2ã€addWorker(command, true)æ–¹æ³•æ‰§è¡Œä¸ºfalse</span></span><br><span class="line"><span class="comment">  	 * åˆ¤æ–­æ˜¯å¦è¿›å…¥ç¬¬äºŒç§æƒ…å†µ</span></span><br><span class="line"><span class="comment">  	 */</span></span><br><span class="line">  </span><br><span class="line">  	<span class="comment">//å¦‚æœçº¿ç¨‹æ± å¤„äºRUNNINGçŠ¶æ€ï¼Œçº¿ç¨‹æ± é˜»å¡é˜Ÿåˆ—workQueueæœªæ»¡ å°†æäº¤çš„ä»»åŠ¡åŠ å…¥åˆ°é˜»å¡é˜Ÿåˆ—		    workQueue.offer(command) å¦åˆ™è¿›å…¥æœ€åä¸€ç§æƒ…å†µ</span></span><br><span class="line">    <span class="keyword">if</span> (isRunning(c) &amp;&amp; workQueue.offer(command)) &#123;</span><br><span class="line">      	<span class="comment">//å†æ¬¡è·å–ctlçš„å€¼  å› ä¸ºæ•´ä¸ªè¿‡ç¨‹æ˜¯å¹¶å‘æ‰§è¡Œ æ‰€ä»¥éœ€è¦ç»å¸¸è·å–å½“å‰çš„ctlå€¼</span></span><br><span class="line">        <span class="keyword">int</span> recheck = ctl.get();</span><br><span class="line">      	<span class="comment">//å†æ¬¡åˆ¤æ–­çº¿ç¨‹æ± æ˜¯å¦å¤„äºè¿è¡ŒçŠ¶æ€ï¼Œå¦‚æœä¸æ˜¯åˆ™å°†å…ˆå‰æ·»åŠ çš„ä»»åŠ¡å–å‡º</span></span><br><span class="line">        <span class="keyword">if</span> (! isRunning(recheck) &amp;&amp; remove(command))</span><br><span class="line">          	<span class="comment">//ä¸€æ—¦ç§»é™¤æˆåŠŸåˆ™è°ƒç”¨æ‹’ç»æ–¹æ³•</span></span><br><span class="line">            reject(command);</span><br><span class="line">      	<span class="comment">//è®¡ç®—çº¿ç¨‹æ± å†…çš„æœ‰æ•ˆçº¿ç¨‹æ•°æ˜¯å¦ç­‰äº0</span></span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (workerCountOf(recheck) == <span class="number">0</span>)</span><br><span class="line">          	<span class="comment">//å¦‚æœæ˜¯åˆ™åˆ›å»ºä¸€ä¸ªçº¿ç¨‹ä½†ä¸å»å¯åŠ¨å®ƒï¼Œå¹¶ç»“æŸæ•´ä¸ªexecute()æ–¹æ³•çš„æ‰§è¡Œã€‚æœ¬è´¨æ˜¯æœ€ååœ¨runWorkerç±»ä¸­æ‰§è¡Œçš„nullå€¼æœ€åè¢«ä¼ åˆ°äº†runWorkerç±»ä¸­ è€Œfalseåœ¨addWorkerç±»ä¸­è¢«å¤„ç†  è¡¨ç¤ºå°†å½“å‰çš„çº¿ç¨‹æ± çš„æœ‰æ•ˆçº¿ç¨‹æ˜¯coreè¿˜æ˜¯max</span></span><br><span class="line">            addWorker(<span class="keyword">null</span>, <span class="keyword">false</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">  	<span class="comment">/**</span></span><br><span class="line"><span class="comment">  	 * æœ€ååˆ¤æ–­æ˜¯å¦æ‰§è¡Œç¬¬ä¸‰ç§æƒ…å†µ</span></span><br><span class="line"><span class="comment">     * æ¡ä»¶:</span></span><br><span class="line"><span class="comment">     * 1ã€çº¿ç¨‹æ± ä¸å¤„äºRUNNINGçŠ¶æ€</span></span><br><span class="line"><span class="comment">     * 2ã€çº¿ç¨‹æ± å¤„äºRUNNINGçŠ¶æ€ä½†æ˜¯çº¿ç¨‹æ± å†…çš„æœ‰æ•ˆçº¿ç¨‹æ•°å·²ç»è¾¾åˆ°corePoolSizeå¹¶ä¸”é˜»å¡é˜Ÿåˆ—å·²æ»¡</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">  	<span class="comment">//å°è¯•åˆ›å»ºä¸€ä¸ªæ–°çš„çº¿ç¨‹æ¥æ‰§è¡Œä»»åŠ¡ å¦‚æœå¤±è´¥äº†é‚£ä¹ˆå°±æ‰§è¡Œreject(command)æ–¹æ³•æ‹’ç»</span></span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (!addWorker(command, <span class="keyword">false</span>))</span><br><span class="line">        reject(command);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>  å…¶ä¸­æ·»åŠ åˆ°é˜»å¡é˜Ÿåˆ—çš„æ–¹æ³•<strong>workQueue.offer(command)</strong>åº•å±‚è°ƒç”¨çš„æ˜¯ä¸€ä¸ªBlockingQueueçš„æ•°æ®ç»“æ„ï¼Œå°†ä»»åŠ¡æ·»åŠ åˆ°é˜Ÿåˆ—çš„å°¾éƒ¨ã€‚è¿™é‡Œä»¥ArrayBlockingQueueå®ç°çš„ä»£ç ä¸ºä¾‹ã€‚æœ€ç»ˆçš„è°ƒç”¨ğŸ‘‡</p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">enqueue</span><span class="params">(E x)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// assert lock.getHoldCount() == 1;</span></span><br><span class="line">    <span class="comment">// assert items[putIndex] == null;</span></span><br><span class="line">    <span class="keyword">final</span> Object[] items = <span class="keyword">this</span>.items;</span><br><span class="line">    items[putIndex] = x;</span><br><span class="line">    <span class="keyword">if</span> (++putIndex == items.length)</span><br><span class="line">        putIndex = <span class="number">0</span>;</span><br><span class="line">    count++;</span><br><span class="line">    notEmpty.signal();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li><p>æ ¸å¿ƒæ–¹æ³•<strong><code>addWorker(Runnable firstTask, boolean core)</code></strong>åˆ†æ</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">boolean</span> <span class="title">addWorker</span><span class="params">(Runnable firstTask, <span class="keyword">boolean</span> core)</span> </span>&#123;</span><br><span class="line">  	<span class="comment">/**</span></span><br><span class="line"><span class="comment">  	 * æ— é™å¾ªç¯ã€‚å½“çº¿ç¨‹æ± å¤„äºRUNNINGçŠ¶æ€æ—¶ï¼Œåªæœ‰çº¿ç¨‹æ± ä¸­çš„æœ‰æ•ˆçº¿ç¨‹æ•°æˆåŠŸ åŠ 1 å</span></span><br><span class="line"><span class="comment">  	 * æ‰ä¼šé€€å‡ºå¾ªç¯æ‰§è¡Œåè¾¹çš„ä»£ç ã€‚å³:å½“å‰çº¿ç¨‹æ± çš„æœ‰æ•ˆçº¿ç¨‹æ•°ä¸€å®š</span></span><br><span class="line"><span class="comment">  	 * å°äºcorePoolSizeæˆ–maximumPoolSize</span></span><br><span class="line"><span class="comment">  	 */</span></span><br><span class="line">    retry:</span><br><span class="line">    <span class="keyword">for</span> (;;) &#123;</span><br><span class="line">        <span class="keyword">int</span> c = ctl.get();</span><br><span class="line">        <span class="keyword">int</span> rs = runStateOf(c);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Check if queue empty only if necessary.</span></span><br><span class="line">        <span class="comment">//çº¿ç¨‹æ± å¤„äºSTOPæˆ–è€…TERMINATDæˆ–è€…TYDINGçŠ¶æ€ å¹¶ä¸”è¦æ»¡è¶³ä»¥ä¸‹ä¸‰ç§æ¡ä»¶ä¹‹ä¸€:</span></span><br><span class="line">        <span class="comment">//1ã€rsä¸æ˜¯SHUTDOWNçŠ¶æ€æˆ–è€…</span></span><br><span class="line">        <span class="comment">//2ã€firstTaskä¸æ˜¯nullæˆ–è€…</span></span><br><span class="line">        <span class="comment">//3ã€é˜»å¡é˜Ÿåˆ—workQueueä¸ºç©º  é‚£ä¹ˆç›´æ¥ç»“æŸè¯¥æ–¹æ³•</span></span><br><span class="line">        <span class="keyword">if</span> (rs &gt;= SHUTDOWN &amp;&amp;</span><br><span class="line">            ! (rs == SHUTDOWN &amp;&amp;</span><br><span class="line">               firstTask == <span class="keyword">null</span> &amp;&amp;</span><br><span class="line">               ! workQueue.isEmpty()))</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (;;) &#123;</span><br><span class="line">            <span class="keyword">int</span> wc = workerCountOf(c);</span><br><span class="line">          	<span class="comment">//å¦‚æœçº¿ç¨‹æ± çš„æœ‰æ•ˆå®¹é‡å¤§äºç­‰äºç†è®ºæœ€å¤§å®¹é‡æˆ–è€…å¤§äºè®¾å®šçš„æœ€å¤§å®¹é‡ </span></span><br><span class="line">            <span class="comment">//é‚£ä¹ˆä¹Ÿä¼šç›´æ¥é€€å‡ºæ–¹æ³•</span></span><br><span class="line">            <span class="keyword">if</span> (wc &gt;= CAPACITY ||</span><br><span class="line">                <span class="comment">//æ ¹æ®ä¼ å…¥çš„coreæ˜¯trueè¿˜æ˜¯falseæ¥ç»™åˆ¤æ–­æœ€å¤§å®¹é‡æ˜¯coreè¿˜æ˜¯maximum</span></span><br><span class="line">                wc &gt;= (core ? corePoolSize : maximumPoolSize))</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">          	<span class="comment">//æœ‰æ•ˆçº¿ç¨‹æ•°åŠ 1 é€€å‡ºå¾ªç¯</span></span><br><span class="line">            <span class="keyword">if</span> (compareAndIncrementWorkerCount(c))</span><br><span class="line">                <span class="keyword">break</span> retry;</span><br><span class="line">            c = ctl.get();  <span class="comment">// Re-read ctl</span></span><br><span class="line">            <span class="keyword">if</span> (runStateOf(c) != rs)</span><br><span class="line">                <span class="keyword">continue</span> retry;</span><br><span class="line">            <span class="comment">// else CAS failed due to workerCount change; retry inner loop</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">boolean</span> workerStarted = <span class="keyword">false</span>;</span><br><span class="line">    <span class="keyword">boolean</span> workerAdded = <span class="keyword">false</span>;</span><br><span class="line">    Worker w = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">//æ ¹æ®ä¼ å…¥çš„ä»»åŠ¡åˆ›å»ºçº¿ç¨‹Workerå¯¹è±¡w</span></span><br><span class="line">        w = <span class="keyword">new</span> Worker(firstTask);</span><br><span class="line">        <span class="keyword">final</span> Thread t = w.thread;</span><br><span class="line">        <span class="keyword">if</span> (t != <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">final</span> ReentrantLock mainLock = <span class="keyword">this</span>.mainLock;</span><br><span class="line">            <span class="comment">//åŠ é”</span></span><br><span class="line">            mainLock.lock();</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="comment">// Recheck while holding lock.</span></span><br><span class="line">                <span class="comment">// Back out on ThreadFactory failure or if</span></span><br><span class="line">                <span class="comment">// shut down before lock acquired.</span></span><br><span class="line">                <span class="keyword">int</span> rs = runStateOf(ctl.get());</span><br><span class="line">								<span class="comment">//åˆ¤æ–­å½“å‰çº¿ç¨‹æ± çŠ¶æ€ å¦‚æœæ˜¯è¿è¡Œçš„æˆ–è€…æ˜¯å…³é—­çš„å¹¶ä¸”firstTaskä¸ºnull</span></span><br><span class="line">                <span class="keyword">if</span> (rs &lt; SHUTDOWN ||</span><br><span class="line">                    (rs == SHUTDOWN &amp;&amp; firstTask == <span class="keyword">null</span>)) &#123;</span><br><span class="line">                    <span class="keyword">if</span> (t.isAlive()) <span class="comment">// precheck that t is startable</span></span><br><span class="line">                        <span class="keyword">throw</span> <span class="keyword">new</span> IllegalThreadStateException();</span><br><span class="line">                    <span class="comment">//å°†Workerå¯¹è±¡æ”¾å…¥ä¸€ä¸ªHashSetå¯¹è±¡workersä¸­ workersä¸­åŒ…å«äº†å½“å‰çº¿ç¨‹æ± çš„æ‰€æœ‰å·¥ä½œçº¿ç¨‹</span></span><br><span class="line">                    workers.add(w);</span><br><span class="line">                    <span class="keyword">int</span> s = workers.size();</span><br><span class="line">                    <span class="keyword">if</span> (s &gt; largestPoolSize)</span><br><span class="line">                        <span class="comment">//çº¿ç¨‹æ± çš„æœ€å¤§å®¹é‡</span></span><br><span class="line">                        largestPoolSize = s;</span><br><span class="line">                    workerAdded = <span class="keyword">true</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">                mainLock.unlock();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (workerAdded) &#123;</span><br><span class="line">              <span class="comment">//çº¿ç¨‹æ·»åŠ æˆåŠŸåå°±ä¼šå¯åŠ¨  ä¼šè°ƒç”¨åˆ°Workerå¯¹è±¡ä¸­çš„run()æ–¹æ³•</span></span><br><span class="line">                t.start();</span><br><span class="line">                workerStarted = <span class="keyword">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (! workerStarted)</span><br><span class="line">            addWorkerFailed(w);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> workerStarted;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>  å…¶ä¸­Workerç±»æ˜¯ThreadPoolExecutorçš„ä¸€ä¸ªå†…éƒ¨ç±»ï¼Œå®ç°äº†Runnableæ¥å£ã€‚æºç å¦‚ä¸‹:</p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">Worker</span></span></span><br><span class="line"><span class="class">    <span class="keyword">extends</span> <span class="title">AbstractQueuedSynchronizer</span></span></span><br><span class="line"><span class="class">    <span class="keyword">implements</span> <span class="title">Runnable</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å£°æ˜åºåˆ—åŒ–IDåªæ˜¯ä¸ºäº†ä¸å‡ºç°javacè­¦å‘Š å…¶å®æ²¡ä»€ä¹ˆç”¨</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">6138294804551838833L</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** Thread this worker is running in.  Null if factory fails. */</span></span><br><span class="line">    <span class="keyword">final</span> Thread thread;</span><br><span class="line">    <span class="comment">/** Initial task to run.  Possibly null. */</span></span><br><span class="line">    Runnable firstTask;</span><br><span class="line">    <span class="comment">/** Per-thread task counter */</span></span><br><span class="line">    <span class="keyword">volatile</span> <span class="keyword">long</span> completedTasks;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Creates with given first task and thread from ThreadFactory.</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> firstTask the first task (null if none)</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    Worker(Runnable firstTask) &#123;</span><br><span class="line">        setState(-<span class="number">1</span>); <span class="comment">// inhibit interrupts until runWorker</span></span><br><span class="line">        <span class="keyword">this</span>.firstTask = firstTask;</span><br><span class="line">        <span class="keyword">this</span>.thread = getThreadFactory().newThread(<span class="keyword">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** å°†ä¸»è¦çš„è¿è¡Œå·¥ä½œäº¤ç»™å¤–éƒ¨æ–¹æ³•runWorker(Worker w)  */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        runWorker(<span class="keyword">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Lock methods</span></span><br><span class="line">    <span class="comment">// è·å–å½“å‰é”çš„çŠ¶æ€</span></span><br><span class="line">    <span class="comment">// The value 0 represents the unlocked state.</span></span><br><span class="line">    <span class="comment">// The value 1 represents the locked state.</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">boolean</span> <span class="title">isHeldExclusively</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> getState() != <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">boolean</span> <span class="title">tryAcquire</span><span class="params">(<span class="keyword">int</span> unused)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (compareAndSetState(<span class="number">0</span>, <span class="number">1</span>)) &#123;</span><br><span class="line">            setExclusiveOwnerThread(Thread.currentThread());</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">boolean</span> <span class="title">tryRelease</span><span class="params">(<span class="keyword">int</span> unused)</span> </span>&#123;</span><br><span class="line">        setExclusiveOwnerThread(<span class="keyword">null</span>);</span><br><span class="line">        setState(<span class="number">0</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">lock</span><span class="params">()</span>        </span>&#123; acquire(<span class="number">1</span>); &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">tryLock</span><span class="params">()</span>  </span>&#123; <span class="keyword">return</span> tryAcquire(<span class="number">1</span>); &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">unlock</span><span class="params">()</span>      </span>&#123; release(<span class="number">1</span>); &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isLocked</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> isHeldExclusively(); &#125;</span><br><span class="line">    ... ...</span><br><span class="line">    ... ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>  çœŸæ­£æ‰§è¡Œçº¿ç¨‹æ–¹æ³•çš„runWorker(Worker w)æ–¹æ³•:</p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">final</span> <span class="keyword">void</span> <span class="title">runWorker</span><span class="params">(Worker w)</span> </span>&#123;</span><br><span class="line">    Thread wt = Thread.currentThread();</span><br><span class="line">    <span class="comment">//å°†firstTaskèµ‹å€¼ç»™task  firstTaskå°±æ˜¯æœ€å¼€å§‹executeæ–¹æ³•æ‰§è¡Œçš„å·¥ä½œ</span></span><br><span class="line">    Runnable task = w.firstTask;</span><br><span class="line">    w.firstTask = <span class="keyword">null</span>;</span><br><span class="line">    w.unlock(); <span class="comment">// allow interrupts</span></span><br><span class="line">    <span class="keyword">boolean</span> completedAbruptly = <span class="keyword">true</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      	<span class="comment">//å¦‚æœtaskä¸ä¸ºnull å°±ä¼šæˆ–è€…getTask()æ–¹æ³•ä¸­å–å‡ºçš„çº¿ç¨‹ä¸æ˜¯null</span></span><br><span class="line">      	<span class="comment">//getTask()æ–¹æ³•æ˜¯ä¸€ä¸ªä¸æ–­ä»workQueueä¸­å–å‡ºçº¿ç¨‹çš„æ–¹æ³•</span></span><br><span class="line">        <span class="keyword">while</span> (task != <span class="keyword">null</span> || (task = getTask()) != <span class="keyword">null</span>) &#123;</span><br><span class="line">            w.lock();</span><br><span class="line">            <span class="comment">// If pool is stopping, ensure thread is interrupted;</span></span><br><span class="line">            <span class="comment">// if not, ensure thread is not interrupted.  This</span></span><br><span class="line">            <span class="comment">// requires a recheck in second case to deal with</span></span><br><span class="line">            <span class="comment">// shutdownNow race while clearing interrupt</span></span><br><span class="line">            <span class="keyword">if</span> ((runStateAtLeast(ctl.get(), STOP) ||</span><br><span class="line">                 (Thread.interrupted() &amp;&amp;</span><br><span class="line">                  runStateAtLeast(ctl.get(), STOP))) &amp;&amp;</span><br><span class="line">                !wt.isInterrupted())</span><br><span class="line">                wt.interrupt();</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                beforeExecute(wt, task);</span><br><span class="line">                Throwable thrown = <span class="keyword">null</span>;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                  	<span class="comment">//æ‰§è¡Œä»»åŠ¡</span></span><br><span class="line">                    task.run();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (RuntimeException x) &#123;</span><br><span class="line">                    thrown = x; <span class="keyword">throw</span> x;</span><br><span class="line">                &#125; <span class="keyword">catch</span> (Error x) &#123;</span><br><span class="line">                    thrown = x; <span class="keyword">throw</span> x;</span><br><span class="line">                &#125; <span class="keyword">catch</span> (Throwable x) &#123;</span><br><span class="line">                    thrown = x; <span class="keyword">throw</span> <span class="keyword">new</span> Error(x);</span><br><span class="line">                &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">                    afterExecute(task, thrown);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">              	<span class="comment">//æ‰§è¡Œå®Œä¸€æ¬¡taskåè®¾ç½®ä¸ºnull  è¿™æ ·å†æ‰§è¡Œtaskå°±åªèƒ½æ ¹æ®ç¬¬äºŒä¸ªæ¡ä»¶task = getTask()åˆ¤æ–­ å³åªèƒ½ä»é˜»å¡é˜Ÿåˆ—ä¸­å–å‡º</span></span><br><span class="line">                task = <span class="keyword">null</span>;</span><br><span class="line">                w.completedTasks++;</span><br><span class="line">                w.unlock();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        completedAbruptly = <span class="keyword">false</span>;</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        processWorkerExit(w, completedAbruptly);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>  åˆ†æä¸Šå›¾ç¬¬11è¡Œä»£ç : å½“executeæ–¹æ³•æ‰§è¡Œç¬¬ä¸‰ç§ç­–ç•¥æ—¶ï¼Œå³åªåˆ›å»ºä¸€ä¸ªçº¿ç¨‹å¹¶ä¸æ‰§è¡Œã€‚åœ¨è¿™é‡Œå°±è¢«å¤„ç†ï¼Œå› ä¸ºåœ¨ç¬¬ä¸‰ç§æƒ…å†µä¸‹ä¼ å…¥çš„nullå€¼ï¼Œè¿™æ˜¯åªèƒ½å°±ä¼šèµ°ç¬¬äºŒç§åˆ¤æ–­æ¡ä»¶<strong>task = getTask()</strong> ä»é˜»å¡é˜Ÿåˆ—ä¸­å–å‡ºä»»åŠ¡æ¥æ‰§è¡Œã€‚ </p>
<p>  getTaskçš„æºç å¦‚ä¸‹:</p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> Runnable <span class="title">getTask</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">boolean</span> timedOut = <span class="keyword">false</span>; <span class="comment">// Did the last poll() time out?</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (;;) &#123;</span><br><span class="line">        <span class="keyword">int</span> c = ctl.get();</span><br><span class="line">        <span class="keyword">int</span> rs = runStateOf(c);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Check if queue empty only if necessary.</span></span><br><span class="line">      	<span class="comment">//çº¿ç¨‹æ± æ˜¯å¦è¢«å…³é—­        							é˜Ÿåˆ—æ˜¯å¦ä¸ºç©º</span></span><br><span class="line">        <span class="keyword">if</span> (rs &gt;= SHUTDOWN &amp;&amp; (rs &gt;= STOP || workQueue.isEmpty())) &#123;</span><br><span class="line">            decrementWorkerCount();</span><br><span class="line">          	<span class="comment">//å¦‚æœæ˜¯è¿”å›null</span></span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">int</span> wc = workerCountOf(c);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Are workers subject to culling?</span></span><br><span class="line">      <span class="comment">//allowCoreThreadTimeOutè¡¨ç¤ºæ ¸å¿ƒçº¿ç¨‹æ˜¯å¦ä¹Ÿå—è¶…æ—¶æœºåˆ¶é™åˆ¶ å¦‚æœæ²¡æœ‰å¼€å¯åˆ™å†åˆ¤æ–­æ­£åœ¨è¿è¡Œçš„çº¿ç¨‹æ•°æ˜¯å¦è¶…è¿‡äº†æœ€å¤§æ ¸å¿ƒçº¿ç¨‹æ•° å¦‚æœè¶…è¿‡äº† timedä¹Ÿè¦è¢«è®¾ä¸ºfalse</span></span><br><span class="line">        <span class="keyword">boolean</span> timed = allowCoreThreadTimeOut || wc &gt; corePoolSize;</span><br><span class="line"></span><br><span class="line">      	<span class="comment">//å¦‚æœå½“å‰çš„å·¥ä½œçº¿ç¨‹æ•°å·²ç»å¤§äºæœ€å¤§çº¿ç¨‹æ•° æ ¸å¿ƒçº¿ç¨‹æ”¶åˆ°è¶…æ—¶æœºåˆ¶çš„é™åˆ¶</span></span><br><span class="line">        <span class="keyword">if</span> ((wc &gt; maximumPoolSize || (timed &amp;&amp; timedOut))</span><br><span class="line">            &amp;&amp; (wc &gt; <span class="number">1</span> || workQueue.isEmpty())) &#123;</span><br><span class="line">            <span class="keyword">if</span> (compareAndDecrementWorkerCount(c))</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">          <span class="comment">//ä»é˜»å¡é˜Ÿåˆ—å–å‡ºä»»åŠ¡</span></span><br><span class="line">            Runnable r = timed ?</span><br><span class="line">                workQueue.poll(keepAliveTime, TimeUnit.NANOSECONDS) :</span><br><span class="line">                workQueue.take();</span><br><span class="line">            <span class="keyword">if</span> (r != <span class="keyword">null</span>)</span><br><span class="line">              <span class="comment">//å¦‚æœé˜»å¡é˜Ÿåˆ—ä¸ä¸ºç©ºæˆ–è€…æœªè¶…æ—¶ è¿”å›r</span></span><br><span class="line">                <span class="keyword">return</span> r;</span><br><span class="line">            timedOut = <span class="keyword">true</span>;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException retry) &#123;</span><br><span class="line">            timedOut = <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="äº”ã€çº¿ç¨‹æ± çš„å…³é—­"><a href="#äº”ã€çº¿ç¨‹æ± çš„å…³é—­" class="headerlink" title="äº”ã€çº¿ç¨‹æ± çš„å…³é—­"></a>äº”ã€çº¿ç¨‹æ± çš„å…³é—­</h3><p>çº¿ç¨‹æ± æœ‰ä¸¤ç§å…³é—­æ–¹å¼:shutdownå’ŒshutdownNow</p>
<ul>
<li><p><strong>shutdown()</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">shutdown</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">final</span> ReentrantLock mainLock = <span class="keyword">this</span>.mainLock;</span><br><span class="line">    mainLock.lock();</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        checkShutdownAccess();</span><br><span class="line">      <span class="comment">//å°†çº¿ç¨‹æ± çš„çŠ¶æ€å˜ä¸ºSHUTDOWNçŠ¶æ€</span></span><br><span class="line">        advanceRunState(SHUTDOWN);</span><br><span class="line">        interruptIdleWorkers();</span><br><span class="line">        onShutdown(); <span class="comment">// hook for ScheduledThreadPoolExecutor</span></span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        mainLock.unlock();</span><br><span class="line">    &#125;</span><br><span class="line">    tryTerminate();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è°ƒç”¨è¯¥æ–¹æ³•ä¼šå°†çº¿ç¨‹æ± çš„çŠ¶æ€å˜ä¸ºSHUTDOWNçŠ¶æ€ï¼Œæ­¤æ—¶ä¸èƒ½å†å‘çº¿ç¨‹æ± ä¸­æ·»åŠ ä»»åŠ¡ï¼Œå¦åˆ™å°†ä¼šæŠ›å‡º<strong>RejectedExecutionException</strong>å¼‚å¸¸ã€‚ä½†æ˜¯<strong>çº¿ç¨‹æ± è¦ç­‰å¾…æ± å†…æ‰€æœ‰ä»»åŠ¡ç»“æŸä¹‹å</strong>æ‰ä¼šé€€å‡ºã€‚</p>
</li>
<li><p><strong>shutdownNow</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> List&lt;Runnable&gt; <span class="title">shutdownNow</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    List&lt;Runnable&gt; tasks;</span><br><span class="line">    <span class="keyword">final</span> ReentrantLock mainLock = <span class="keyword">this</span>.mainLock;</span><br><span class="line">    mainLock.lock();</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        checkShutdownAccess();</span><br><span class="line">      <span class="comment">//å°†çº¿ç¨‹æ± çš„çŠ¶æ€è®¾ç½®ä¸ºSTOP</span></span><br><span class="line">        advanceRunState(STOP);</span><br><span class="line">        interruptWorkers();</span><br><span class="line">        tasks = drainQueue();</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        mainLock.unlock();</span><br><span class="line">    &#125;</span><br><span class="line">    tryTerminate();</span><br><span class="line">    <span class="keyword">return</span> tasks;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è°ƒç”¨è¯¥æ–¹æ³•åçº¿ç¨‹æ± ç«‹å³ç»“æŸï¼Œå¹¶ä¸”åœæ­¢æ­£åœ¨æ‰§è¡Œçš„ä»»åŠ¡ï¼Œä¸å†æ‰§è¡Œçº¿ç¨‹æ± ä¸­çš„è¿˜åœ¨ç­‰å¾…çš„ä»»åŠ¡ã€‚</p>
<p>å…¶ä¸­<code>interruptWorkers()</code>æ–¹æ³•çš„å®ç°å¦‚ä¸‹:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">interruptWorkers</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">final</span> ReentrantLock mainLock = <span class="keyword">this</span>.mainLock;</span><br><span class="line">    mainLock.lock();</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> (Worker w : workers)</span><br><span class="line">          <span class="comment">//æ¯ä¸€ä¸ªä»»åŠ¡æœ€ä¸­ä¼šè°ƒç”¨interrupt()æ–¹æ³•ä¸­æ–­çº¿ç¨‹</span></span><br><span class="line">            w.interruptIfStarted();</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        mainLock.unlock();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">liupf</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">14</span>
                  <span class="site-state-item-name">æ—¥å¿—</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">4</span>
                  <span class="site-state-item-name">åˆ†ç±»</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">9</span>
                  <span class="site-state-item-name">æ ‡ç­¾</span>
                </a>
              </div>
            

          </nav>

          

          

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">liupf</span>

  
</div>


  <div class="powered-by">ç”± <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> å¼ºåŠ›é©±åŠ¨</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">ä¸»é¢˜ &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Mist</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>
